define("Viva.Controls/Controls/Base/Viva.ItemList",["require","exports","MsPortalImpl/Base/Base.KeyboardHelper","Viva.Controls/Util/Viva.TemplateEngine","Viva.Controls/Util/Viva.Util","Viva.Controls/Controls/Base/Viva.ValidatableControl","WeaveDOM/DirectRender/DataAttribute"],(function(e,t,s,i,a,l,r){"use strict";var n;return function(e){const t="azc-itemList";let n=0;e.ItemValue=class{constructor(e,t,s,i){this._destroyIds=[],this._ltm=new FxImpl.TriggerableLifetimeManager,this.text=ko.observable(),this.value=ko.observable(),this.selected=ko.observable(s||!1),this.disabled=ko.observable(i||!1),this.ariaLabel=ko.observable(),this._tabindex=ko.observable(-1),this.text(e),this.value(t)}_checkExistsOrRegisterDestroyId(e){return a.existsOrRegisterId(this._destroyIds,e)}isDestroyed(){return this._destroyIds.length>0}dispose(){this._checkExistsOrRegisterDestroyId(null)||this._ltm.dispose()}populateFromObject(e){!function(e,t,s){const i=e,a=t;(s||Object.keys(a)||[]).forEach((function(e){let t;a.hasOwnProperty(e)&&(t=a[e],void 0!==t&&(i[e]=ko.isObservable(t)?t:ko.observable(t)))}))}(this,e,["text","value","description","selected","disabled","ariaLabel"])}};class o extends l.ViewModel{constructor(e){super(e),this.label=e.label||null,this.values=ko.observableArray()}}e.ViewModel=o;class d extends l.Widget{constructor(e,s,a){(a=a||{}).viewModelType=a.viewModelType||o,super(e,s,a),this.weaveContext||(this.templateEngine=new i.StringTemplateEngine,this._setName(),this._setRole(),this.templateEngine.setTemplate("itemTemplate",this._attachItemTemplate())),this.element.addClass(t),this.weaveContext||this.element.html('<ul class=\'azc-input azc-optionPicker-list\' data-bind=\'foreach: data.values, css: { "azc-no-border": !data.values || !data.values().length }, attr: { "aria-disabled": $disabled, role: $ctl._roleGroup, "aria-labelledby": data.label }\'>\x3c!-- ko template: { name: "itemTemplate", context: { $disabled: disabled, $tabIndex: _tabindex } } --\x3e\x3c!-- /ko --\x3e</ul>'),this._attachEvents(),this.weaveContext||this._bindDescendants(),this.options.values.map(this.ltm,((e,t)=>{e.registerForDispose(t)}))}dispose(){this._checkExistsOrRegisterDestroyId(super.dispose)||(this._cleanElement(t),super.dispose())}get options(){return this._options}_getElementToFocus(){return this.widget().find("li[tabindex=0]")[0]||null}_setName(){const e=this.options;e.name||(e.name="__azc-itemList"+n++)}_setRole(){this._role="item",this._roleGroup="itemList"}_attachItemTemplate(){return'<li data-bind=\'text: text, attr: { role: $ctl._role, "aria-checked": $ctl._ariaSelected($data), "aria-disabled": $disabled, disabled: $disabled, tabindex: $tabIndex }, css: { "azc-itemlist-selected": selected()}\' />'}_set(e){e.selected(!0)}_isSameValue(e,t){return e===t||null!=e&&null!=t&&e.text===t.text&&e.value===t.value}_initializeSubscriptions(e){super._initializeSubscriptions(e),e.values.subscribe(this.ltm,(()=>{this._valueChangedSubscriber(e.value())})),this._createPerItemSubscriptions(this.options.values()),this.options.values.subscribe(this.ltm,(e=>{this._createPerItemSubscriptions(e)})),e.value.subscribeAndRun(this.ltm,(e=>{this._valueChangedSubscriber(e)}));let t=!0;e.disabled.subscribeAndRun(this.ltm,(e=>{this._widgetDisabledSubscriber(e,t),t=!1}))}_valueChangedSubscriber(e){e&&(e.selected()||e.selected(!0)),this.options.values().forEach((t=>{t!==e&&this._unselectItemValue(t)})),e?e._tabindex(0):this._setUnselectedTabIndex()}_widgetDisabledSubscriber(e,t){const s=this.options.value(),i=this.element;e?(i.attr("aria-disabled",!0),s&&s._tabindex(-1)):(i.removeAttr("aria-disabled"),!t&&this.options.value.notifySubscribers(s))}_createPerItemSubscriptions(e){this._itemltm&&this._itemltm.dispose(),this._itemltm=this.ltm.createChildLifetime(),e.forEach((e=>{e.selected.subscribeAndRun(this._itemltm,this._itemSelectedSubscriber(e),this),e.disabled.subscribeAndRun(this._itemltm,this._itemDisabledSubscriber(e),this)}))}_itemSelectedSubscriber(e){return function(t){t?this.options.value(e):e===this.options.value()&&this.options.value(null)}}_itemDisabledSubscriber(e){return function(t){let s;t?(e._tabindex(-1),e===this.options.value()&&this.options.value(null)):(s=e.selected(),s&&e.selected.notifySubscribers(s))}}_attachEvents(){const e=this;this.ltm.registerForDispose(this.element.setEvents(["click.itemList","li",function(t){const s=e.weaveContext?(0,r.getElementData)(this):ko.dataFor(this);e.$disabled()||s.disabled()||s.selected()||(e._clicked(s),t.stopPropagation())}],["focusin.itemList","li",function(){let t,s;e.element.find("[aria-checked=true]").length||(t=e.options.values(),s=e.weaveContext?(0,r.getElementData)(this):ko.dataFor(this),t.forEach((e=>{s!==e&&e._tabindex(-1)})))}],["focusout.itemList","li",function(){e.element.find("[aria-checked=true]").length||e._setUnselectedTabIndex()}],["keydown.itemList","li",function(t){const i=$(this);let a,l;const r=i.parent().find("li");let n=!1;if(0===s.getModifierKeys(t))switch(t.which){case 13:case 32:i.click(),n=!0;break;case 37:case 38:for(a=i.index()-1;a>=0;a--)if(l=r.eq(a),!e._isItemDisabled(l)){l.click().focus();break}n=!0;break;case 39:case 40:for(a=i.index()+1;a<=e.options.values().length;a++)if(l=r.eq(a),!e._isItemDisabled(l)){l.click().focus();break}n=!0}return!n}]))}_clicked(e){this._set(e)}_isItemDisabled(e){return"true"===e.attr("aria-disabled")}_setUnselectedTabIndex(){let e=0;let t=this.options.values().length-1,s=!1,i=!1;const a=this.options.values();if(!this.$disabled())for(e=0;e<=t&&(s||a[e].disabled()||(a[e]._tabindex(0),s=!0),i||a[t].disabled()||(a[t]._tabindex(0),i=!0),!s||!i);e++,t--);}_unselectItemValue(e){e.selected(!1),e._tabindex(-1)}_ariaSelected(e){return e.selected().toString()}_ariaLabel(e){return(e.ariaLabel()||"").trim()||void 0}}e.Widget=d}(n||(n={})),n}));