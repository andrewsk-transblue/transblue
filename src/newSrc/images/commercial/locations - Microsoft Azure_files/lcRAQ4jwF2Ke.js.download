define("MsPortalImpl.Controls/Controls/SearchBox.Component",["require","exports","Weave/DirectMode","Weave","_generated/MsPortalImpl/Svg/Startup/Search.svg","_generated/MsPortalImpl/Svg/Startup/Close.svg","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl.Controls/Fields/TextField.Component","FxInternal/Weave/Util","MsPortalImpl/Weave/Util","FxInternal/Weave"],(function(t,e,s,i,a,o,r,n,l,c,d){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SearchBoxInner=e.listClass=e.iconDiscardClass=e.comboBoxClass=void 0,e.comboBoxClass="fxc-searchbox-container",e.iconDiscardClass="fxc-search-discard-icon",e.listClass="fxc-search-list",e.SearchBoxInner=function(t){const{vm:h,state:p}=t,u=(0,n.TextFieldInner)({vm:p.textFieldViewModel,state:p.textFieldState});return s(i.GetContext,{fn:t=>{const{disabled:n,tabIndex:x}=(0,c.aggregateContext)(t,h,p);return s(i.SetContext,{disabled:n,tabIndex:x},s("div",{className:"fxc-search-icon fxs-portal-svg-secondary",image:a}),s("div",{className:[e.comboBoxClass,u.parentClassName],"aria-disabled":n},u.weaveNode),s("div",{className:[e.iconDiscardClass,"fxs-portal-svg-secondary"],role:"button","aria-hidden":"true",title:r.Controls.SearchBox.deleteButtonLabel,tabindex:-1,image:MsPortalFx.Base.Images.CustomImageWithOptions(o,{customClass:"msportalfx-search-discard-icon"})}),s("ul",{role:"listbox",className:["azc-bg-default","fxs-portal-border",e.listClass,{"fxs-display-none":(0,i.composeComputation)([p.popupOpen,(0,d.toComputation)(h.hideSuggestions)],((t,e)=>!t||e))}],tabindex:"-1","aria-label":MsPortalFx.encodeAttribute(r.DropDown.optionContainer),"aria-disabled":n},s(i.ForEach,{collection:(0,d.toComputation)(p.currentItems),fn:({item:t})=>s("li",{role:"option",className:"fxs-portal-hover",title:t},t)}),s(i.If,{condition:(0,d.toComputation)(p.currentItems).compose(l.isEmptyArray),concealmentBehavior:"remove",trueFn:()=>s("li",{role:"option",className:"fxc-search-no-result","aria-disabled":"true",title:r.Search.noResults},r.Search.noResults)})))}})}})),
define("_generated/Less/MsPortalImpl.Controls/Controls/SearchBox.css",["module"],(function(t){"use strict";return{css:".fxc-search{display:block;position:relative}.fxc-search .azc-form-labelcontainer{display:none !important}.fxc-search-icon{top:4px;left:6px}.fxc-search-discard-icon{height:8px;width:8px;position:absolute;top:2px;right:7px;cursor:pointer;display:none}.fxc-search-populated .fxc-search-discard-icon{display:block}.fxc-search .azc-textBox{display:block}.fxc-search .azc-textBox .azc-textBox-wrapper input{padding-left:29px;padding-right:24px}.fxc-search ul{padding:0;margin:0;position:absolute;width:100%;z-index:150}.fxc-search li{border-left:1px solid;border-left-color:inherit;border-right:1px solid;border-right-color:inherit;list-style-type:none;border-top-width:0;border-bottom-width:0;padding:9px 32px;cursor:pointer;overflow-x:hidden;white-space:nowrap;text-overflow:ellipsis}.fxc-search li:last-child{border-bottom:1px solid;border-bottom-color:inherit}.fxc-search.azc-fabric .fxc-search-discard-icon{top:2px;right:2px;padding:6px}.fxc-search.azc-fabric .msportalfx-search-discard-icon{padding-bottom:6px}.fxc-search.azc-fabric .azc-textBox .azc-textBox-wrapper .azc-input{padding-left:24px}.fxc-searchbox-container[aria-disabled=true]+.fxc-search-discard-icon{display:none}.fxc-search-no-result{pointer-events:none}",moduleId:t.id}})),
define("MsPortalImpl.Controls/Controls/SearchBox",["require","exports","MsPortalImpl.Controls/Controls/Base/OptionsBase","MsPortalImpl.Controls/Controls/Base/Base","MsPortalImpl/Base/Base.KeyboardHelper","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl.Controls/Controls/SearchBox.Component","MsPortalImpl.Controls/Fields/TextField","MsPortalImpl/Weave/Util","MsPortalImpl/Interactions/Interactions.PortalReader","FxInternal/Css","_generated/Less/MsPortalImpl.Controls/Controls/SearchBox.css","Weave"],(function(t,e,s,i,a,o,r,n,l,c,d,h,p){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SearchBox=e.Widget=e.WidgetUIState=e.InnerTsxComponent=void 0,(0,d.injectCss)(h);var u=MsPortalFx.ViewModels,x=u.Controls,m=u.Forms.TextBox.ViewModel;const b=MsPortalFx.isNullOrUndefined,f="fxs-portal-selected",g="fxc-search-populated",_="fxc-search",C=o.Controls.searchBox,v=MsPortalFx.encodeAttribute(C);function B(t,e){return t.update?t.update(e||""):Q([])}e.InnerTsxComponent=r.SearchBoxInner;class I extends i.WidgetUIState{constructor(t){super(),this.popupOpen=(0,p.makeWritableComputation)(!1),this.currentItems=ko.observableArray();const e=t.vm;this.textFieldViewModel=new m(this._ltm,{disabled:e.disabled,label:ko.observable(C),emptyValueText:e.placeholder,valueUpdateTrigger:x.ValueUpdateTrigger.Input}),this.textFieldState=new n.WidgetUIState({diContainer:t.diContainer,vm:this.textFieldViewModel})}}e.WidgetUIState=I;class y extends s.Widget{constructor(t,e,s,i){super(t,e,s,i),this._clickedInsideWidget=!1,this._events=[],this._ignoreTextBoxValueUpdate=!1,this._busy=ko.observable(!1),this._dirty=!1,this._forceDismiss=!1,this._announce=new c.PortalReader(this.ltm,{idPrefix:"searchbox"});const a=this.ltm,o=this.state.textFieldViewModel.value;t.addClass(_),t.toggleClass("azc-fabric",function(t){return t.hasOwnProperty("valueUpdateTimeout")}(this.options)),this._attachEventHandlers();const l=this.options.defaultText;b(l)||(o(l),this._originalText=l,l&&this.element.addClass(g));const d=this.options._msPortalFxValue;let h=!1;d&&(d.subscribeAndRun(a,o),h=!!d());const p=t=>{this._ignoreTextBoxValueUpdate||(this._originalText=t,clearTimeout(this._typingTimer),t?this._typingTimer=setTimeout((()=>{this.isDisposed()||this._updateDropdown(t)}),this.options.updateFrequency):(this.element.removeClass(g),this.state.currentItems([]),B(this.options)))};h?o.subscribeAndRun(a,p):o.subscribe(a,p),this.options._msPortalFxresetTrigger((()=>this._reset()));const u=this.options.resultLimit;b(u)?this._unchangingResultLimit=5:ko.isObservable(u)?u.subscribe(a,(t=>{const e=this.state.currentItems();t<e.length&&this.state.currentItems(e.slice(0,t))})):this._unchangingResultLimit=u,this.ltm.registerForDispose(new n.Widget(t.findByClassName(r.comboBoxClass),this.state.textFieldViewModel,{weaveContext:this.weaveContext},this.state.textFieldState)),this._accessibility(),this.state.currentItems.subscribeAndRun(a,(t=>{this._forceDismiss?(this._dirty=!1,this._forceDismiss=!1):!this._dirty&&o()&&this.element.findByClassName("azc-input")[0]===document.activeElement?this._dirty=!0:o()||(this._dirty=!1);const e=!(!t.length&&!this._dirty);this.state.popupOpen(e),this._searchBoxElement.removeAttr("aria-activedescendant")}))}dispose(){this.element.removeClass(_),MsPortalFx.disposeDisposable(this._events),this._events=[],super.dispose()}_accessibility(){const t=this.element.find("label").attr("id"),e=`${t}-for`,s=`${t}-listbox`;this._activeItemId=`${t}-active`,this._comboBoxElement=this.element.findByClassName(r.comboBoxClass),this._searchBoxElement=this._comboBoxElement.find(`#${e}`),this._listBoxElement=this.element.find("> ul"),this._listBoxElement.attr("id",s),this._searchBoxElement.attr({role:"searchbox","aria-haspopup":"listbox","aria-controls":s,"aria-autocomplete":"list",placeholder:this.options.placeholder(),"aria-multiline":null,"aria-readonly":null}),this._busy.subscribeAndRun(this.ltm,(t=>{this._searchBoxElement.attr("aria-busy",t),this._listBoxElement.attr("aria-busy",t)})),this.options.ariaLabel.subscribeAndRun(this.ltm,(e=>{const s=(e||"").trim();s?(this._comboBoxElement.attr({"aria-labelledby":null,"aria-label":s}),this._searchBoxElement.attr({"aria-labelledby":null,"aria-label":s})):(this._comboBoxElement.attr("aria-label",v),this._comboBoxElement.attr("aria-labelledby",t),this._searchBoxElement.attr("aria-label",v),this._searchBoxElement.attr("aria-labelledby",t))})),this.options.hideSuggestions.subscribeAndRun(this.ltm,(t=>{this._searchBoxElement.attr("autocomplete",t?null:"off")}))}_reset(){return this._updateTextBoxWithOutOpeningDropDown(""),this._dirty=!1,this.state.currentItems([]),this.element.removeClass(g),clearTimeout(this._typingTimer),Q()}_attachEventHandlers(){const t=()=>{if(this.options&&this.options.submit){const t=this.state.textFieldViewModel.value();this._busy(!0),this.options.submit(t,this._originalText).finally((()=>{this._busy(!1)})),this._originalText=t,this.state.popupOpen(!1)}};this._events.push(this.element.setEvents(["mousedown",t=>{const e=$(t.target);e.is("li")&&(this._clickedInsideWidget=!0,$(e).click())}],["keydown",t=>{(38===t.which&&this.state.popupOpen.value||40===t.which)&&t.preventDefault()}],["keyup",e=>{const s=this.element.findByClassName(f);let i,o;const n=t=>{t.addClass(f).attr({id:this._activeItemId,"aria-selected":!0}),this._searchBoxElement.attr("aria-activedescendant",this._activeItemId)},l=(t,e,s)=>{t.length?(t.removeClass(f).removeAttr("id aria-selected"),e&&e.length?(this._updateTextBoxWithOutOpeningDropDown(e.text()),n(e)):this._updateTextBoxWithOutOpeningDropDown(this._originalText)):(this._updateTextBoxWithOutOpeningDropDown(s.text()),n(s))};if(0===a.getModifierKeys(e))switch(e.which){case 13:e.stopPropagation(),clearTimeout(this._typingTimer),this.state.currentItems([]),t();break;case 27:this.state.currentItems([]),this.state.textFieldViewModel.value("");case 9:this.state.popupOpen(!1);break;case 8:case 46:""===this.state.textFieldViewModel.value()&&(this._dirty=!1,this.state.popupOpen(!1));break;case 40:{const t=this.state.textFieldViewModel.value();if(t){if(!this.state.popupOpen.value){this._updateDropdown(t);break}if(i=s.next("li"),o=this.element.find("."+r.listClass+" li").first(),"disabled"===o.attr("disabled"))break;l(s,i,o)}break}case 38:if(this.state.popupOpen.value){if(i=s.prev("li"),o=this.element.find("."+r.listClass+" li").last(),"disabled"===o.attr("disabled"))break;l(s,i,o)}}}],["focusout",t=>{this._forceDismiss=!0,this.state.popupOpen(!1),this._clickedInsideWidget||this.state.currentItems([])}],["click",e=>{const s=$(e.target);s.is("li")&&(this._updateTextBoxWithOutOpeningDropDown(s.text()),this.state.currentItems([]),t()),this._clickedInsideWidget=!1}])),this._events.push(this.element.findByClassName(r.iconDiscardClass).setEvents(["click",()=>{this._busy(!0),B(this.options).finally((()=>{this._busy(!1)})),this._originalText="",this._reset(),t(),this.element.findByClassName("azc-input").focus()}]))}_updateTextBoxWithOutOpeningDropDown(t){this._ignoreTextBoxValueUpdate=!0,this.state.textFieldViewModel.value(t),this._ignoreTextBoxValueUpdate=!1}_updateDropdown(t){this.element.addClass(g),this._busy(!0),MsPortalFx.Base.Promises.cancelOnDispose(this.ltm,(()=>B(this.options,t))).then((e=>{const s=(e=e||[]).length;let i=this._unchangingResultLimit;b(i)&&(i=this.options.resultLimit()),i&&e.length>i&&(e=e.slice(0,i)),this.state.currentItems(e),this._announce.read(o.DropDown.filterResult.format(s,t))})).finally((()=>{this._busy(!1)}))}}e.Widget=y,e.SearchBox=(0,l.createControlComponent)({widgetCtor:y,widgetUIStateCtor:I,innerComponent:r.SearchBoxInner})}));