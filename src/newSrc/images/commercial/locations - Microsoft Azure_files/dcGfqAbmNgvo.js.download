define("MsPortalImpl/Base/Base.Selectable2.Pipeline",["require","exports","Fx/DependencyInjection","MsPortalImpl/Base/Base.Pipeline","MsPortalImpl/Base/Base.Selectable2.Common"],(function(e,t,a,n,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OpenBladeRequestHandler=void 0;var o=FxImpl.shellInterface;let l=class{constructor(e){this._resources=e}createSelection(e,t){var a;if(!this._resources.selectable.isSelected())return void e.indicateTaskComplete();let n;const s=t.bladeRequest.bladeReference,{operationId:l}=t.bladeRequest,d=s&&s.options&&s.options.onClosed;if(d&&l){const e=this._resources.callbacks;e.push({id:l,fn:d}),n=(t,a)=>{FxImpl.toPromise(d(t,a)).finally((()=>{e.remove((e=>e.id===l))}))}}let i;(null===(a=s.options)||void 0===a?void 0:a.callbacks)&&(i=e=>{FxImpl.invokeCallback(s,"onOutputsChanged",[e])}),t.selection=function(e,t,a,n){var s;const l=e.bladeReference,{flags:d,operationId:i}=e,r=l.parameters,p=l.metadata||{},c=3===e.reason,u=function(e,t){if(t){const t=e.options||{},a=(e.metadata||{}).outputParameters||[];return!t.onClosed&&!a.length&&!function(e){const t=o(e);return t&&20560===t.type}(e)}return!0}(l,c);let m=0;return!u&&(m|=2),c&&(m|=4),2&d&&(m|=8),4&d&&(m|=128),32&d&&(m|=256),l.disableRebind&&(m|=64),8&d&&(m|=64),256&d&&(m|=512),512&d&&(m|=1024),{timestamp:e.timestamp,detailBlade:l.bladeName,extension:l.extensionName,detailBladeInputs:r||{},openInContextPane:!!(1&d)||p.isContextBlade,persistentContextPane:p.persistentContextPane,flags:m,operationId:i,onClosed:a,telemetryName:e.telemetryName,context:l.context||e.context,defaultMenuItemId:l.menuId,contentBladeReference:l.contentBladeReference,notifyBladeOpenCompleted:t,outputs:null===(s=l.metadata)||void 0===s?void 0:s.outputParameters,outputsChanged:n}}(t.bladeRequest,t.notifyBladeOpenCompleted,n,i)}postSelection(e,t){this._resources.selectedValue(t.selection)}};__decorate([__metadata("fx:diagnostics",[e,"OpenBladeRequestHandler.prototype"]),n.Step(3),__metadata("design:type",Function),__metadata("design:paramtypes",[n.Task,s.OpenBladeTaskArgs]),__metadata("design:returntype",void 0)],l.prototype,"createSelection",null),__decorate([__metadata("fx:diagnostics",[e,"OpenBladeRequestHandler.prototype"]),n.Step(5),__metadata("design:type",Function),__metadata("design:paramtypes",[n.Task,s.OpenBladeTaskArgs]),__metadata("design:returntype",void 0)],l.prototype,"postSelection",null),l=__decorate([__metadata("fx:diagnostics",[e,"OpenBladeRequestHandler"]),a.Class("pipeline"),__metadata("design:paramtypes",[s.OpenBladeResources])],l),t.OpenBladeRequestHandler=l}));