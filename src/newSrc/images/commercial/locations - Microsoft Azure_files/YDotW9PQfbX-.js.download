define("MsPortalImpl/Widgets/ResourceHoverCard",["require","exports","MsPortalImpl/TsxStringMode/Tsx","MsPortalImpl/TsxStringMode/Tsx","Fx/Controls/Toolbar","Fx/Controls/Pill","Fx/Controls/PillCollection","MsPortalImpl/UI/UI.DialogManager","MsPortalImpl/UI/UI.BladeOpener","MsPortalImpl/Widgets/Widgets.HoverCard","MsPortalImpl/Resources/ImplScriptResources","Fx/ResourceManagement","Fx/Composition/Selectable","FxHubs/ResourceCommands/BrowseCommanding","FxHubs/ArtHelpers/ArgBrowseHelpers","MsPortalImpl/UI/Commands/UI.CommandManager","FxHubs/ArtHelpers/ResourceHoverCardHelpers","FxHubs/RpcEndPoints","MsPortalImpl/Extension/Extension.Definition.Locator","MsPortalImpl/UI/Hubs/UI.ResourceMapManager"],(function(e,a,s,o,t,r,n,i,l,c,d,u,m,p,h,v,g,b,f,x){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.ViewModel=a.HoverCardSource=void 0;var R=t.ToolbarItems.createBasicButton,I=FxImpl.TriggerableLifetimeManager,y=MsPortalFx.Base.Images;!function(e){e.AzureHomeRecent="AzureHomeRecent",e.AzureHomeFavorite="AzureHomeFavorite",e.Grid="Grid"}(a.HoverCardSource||(a.HoverCardSource={}));class C extends c.ViewModel{constructor(e,a,s,o,C){super(),this.isResourceFavorite=ko.observable(!1),this.favoriteIcon=y.Star({palette:99}),this.notFavoriteIcon=y.Favorite({palette:99}),this.resourceIcon=ko.observable(),this.resourceName=ko.observable(),this.viewIcon=y.View({palette:3}),this.toolbar=ko.observable(),this.resourceProperties=ko.observableArray(),this.tagCollection=ko.observable(),this._extensionName=ko.observable(),this._argBrowseItem=ko.observableArray(),this.openBlade=e=>{const a=new m.PdlBladeReference(e.bladeReference.blade,e.bladeReference.extension,{parameters:e.bladeReference.parameters});e.bladeReference.inContextPane?this._bladeManagement.openContextPane(a):this._bladeManagement.openBlade(a)},this.openResourceBlade=e=>{MsPortalFx.Assets.mapResourceIdToBladeReference(e.resourceId).then((e=>{this._bladeManagement.openBlade(e)}))},this._setNavigationManagement=(e,a)=>{this._dialogManagement={openDialog:a=>(Promise.all([this._diContainer.getAsync(i.DialogManager),this._diContainer.getAsync(v.AsyncPortalFormTarget)]).then((([s,o])=>{const t=new MsPortalFx.ViewModels.Dialogs.MessageBox(a.title,a.content,4);return s.showDialog(t,o,e[0],{locator:f.hubsLocator})})).then((e=>{6===e&&a.onClosed({button:6})})),Q(!0))},this._bladeManagement=null!=a?a:{openBlade:e=>this._diContainer.get(l.BladeOpener).openBlade(e,{flags:8,telemetryName:"ResourceHoverCard"}),openContextPane:e=>this._diContainer.get(l.BladeOpener).openBlade(e,{flags:9,telemetryName:"ResourceHoverCard"}),openBladeAsync:()=>Q(!1),openContextPaneAsync:()=>Q(!1)}},this._setToolbar=(e,a,s)=>{const o=[];if(o.push(R(this.lifetime,{label:d.ActionBarButtons.view,icon:this.viewIcon,onClick:()=>{(0,c.logTelemetry)("ViewResourceLinkClicked",this._resourceId),MsPortalFx.Assets.mapResourceIdToBladeReference(this._resourceId).then((e=>this._bladeManagement.openBlade(e))).catch((()=>{this._bladeManagement.openBlade(new m.PdlBladeReference("ResourceMenuBlade","HubsExtension",{parameters:{id:this._resourceId}}))}))}})),e.browseQueryManifest){const t=(0,p.createSelectionCommands)("ResourceHoverCard",e.browseQueryManifest,a,this.lifetime,(()=>this._extensionName()),s,this._argBrowseItem,this._dialogManagement,this._bladeManagement,8)||[];o.push(...t)}this.toolbar(t.create(this.lifetime,{items:o,showLabels:!0}))},this._setTags=e=>{const a=ko.observableArray();for(const s in e)a.push(r.create(this.lifetime,{value:{key:s,value:e[s]},getKeyText:e=>e.key,getOperatorText:()=>":",getValueText:e=>e.value,createEditor:()=>(this._bladeManagement.openContextPane(new m.PdlBladeReference("ResourceTagsBlade","HubsExtension",{parameters:{resourceId:this._resourceId}})),null),showRemoveButton:!1}));this.tagCollection(n.create(this.lifetime,{items:a,theme:2,multipleRows:!0,maxVisibleItems:2}))},this._setResourceProperties=(e,a,s,o)=>{var t;const r=[];for(const a of g.defaultProperties)a.isMetadata||r.push({name:a.name,value:(0,g.getValueFromArgResponse)(e,a.columnId)});r.push({name:d.ResourceProperties.subscription,value:(0,g.getValueFromArgResponse)(e,"subscriptionDisplayName"),resourceId:u.ArmId.stringify(a,1)}),r.push({name:d.ResourceProperties.resourceGroup,value:(0,g.getValueFromArgResponse)(e,"resourceGroup"),resourceId:u.ArmId.stringify(a,4)});const n={},i={},l=(null===(t=s.browseQueryManifest)||void 0===t?void 0:t.columns)||[];for(const a of l)if(!r.some((e=>e.name===a.displayName)))switch(a.format){case 2:{const s=(0,g.getValueFromArgResponse)(e,a.name);r.push({name:a.displayName,value:u.ArmId.parse(s).resourceName,resourceId:s});break}case 5:case 7:r.push({name:a.displayName,value:(0,g.getValueFromArgResponse)(e,`${a.name}DisplayName`)});break;case 6:{let s=null;const o=(0,h.getColumnName)(a.bladeParameterColumn),t=(0,g.getValueFromArgResponse)(e,o);s="string"==typeof t||"number"==typeof t?{[o]:t}:t,r.push({name:a.displayName,value:(0,g.getValueFromArgResponse)(e,a.name),bladeReference:{extension:a.bladeExtensionName||this._extensionName(),blade:a.bladeName,parameters:s},shouldOpenContextPane:a.openBladeAsContextPane});break}case 9:{const s=(0,g.getValueFromArgResponse)(e,a.name)||{};r.push({name:a.displayName,value:s.text,deepLink:s.link});break}case 10:{const s=(0,g.getValueFromArgResponse)(e,a.name)||{};r.push({name:a.displayName,value:s.text,bladeReference:{extension:s.extension||this._extensionName(),blade:s.blade,parameters:s.parameters},shouldOpenContextPane:a.openBladeAsContextPane});break}case 8:{const s=(0,h.getColumnName)(a.iconColumn);r.push({name:a.displayName,value:(0,g.getValueFromArgResponse)(e,a.name),icon:{type:(0,g.getValueFromArgResponse)(e,s)}});break}case 3:n[a.name]=h.dateFormatter,i[a.name]=a,r.push({name:a.displayName,value:(0,h.dateFormatter)((0,g.getValueFromArgResponse)(e,a.name),null)});break;case 4:n[a.name]=h.numberFormatter,i[a.name]=a,r.push({name:a.displayName,value:(0,h.numberFormatter)((0,g.getValueFromArgResponse)(e,a.name),a)});break;default:r.push({name:a.displayName,value:(0,g.getValueFromArgResponse)(e,a.name)})}this._argBrowseItem((0,h.mapArgResponseToArgBrowseItems)(e,!0,o,n,i)),this.resourceProperties(r)},this.lifetime=new I,this.template=F,this.dockingElement=a,this.focusContent=this.toolbar,this._diContainer=s,this._resourceId=e,s.get(x.ResourceMapManager).getResourceAssetInformation([e],"ResourceHoverCard").then((e=>{(null==e?void 0:e.length)?(this.resourceIcon(e[0].icon||y.Polychromatic.ResourceDefault()),this._extensionName(e[0].extensionName)):this.resourceIcon(y.Polychromatic.ResourceDefault())})),this._setNavigationManagement(a,o);const M=u.ArmId.parse(e),P=M.resourceType.toLowerCase();this.resourceName(u.ResourceName.getDisplayName({id:e,armId:M})),this.setFavorite=()=>{this.isResourceFavorite()?b.AssetTypes.removeFavoriteResourceEndPoint.invoke(FxImpl.Rpc.client,"HubsExtension",{resourceId:e,telemetrySource:"ResourceHoverCard"}).then((()=>{this.isResourceFavorite(!1),C&&C()})):b.AssetTypes.addFavoriteResourceEndPoint.invoke(FxImpl.Rpc.client,"HubsExtension",{resourceId:e,name:this.resourceName(),telemetrySource:"ResourceHoverCard"}).then((e=>{e&&(this.isResourceFavorite(!0),C&&C())}))},b.ArtBrowse.getBrowsePrereqsEndpoint.invoke(FxImpl.Rpc.client,"fxw",{resourceType:P,includeColumnsVersion:2}).then((async a=>{var s,o,t;const r=a.assetTypes||Object.create(null),n=r[P];this._setToolbar(a,n,M.resourceType);const i=[];i.push(...g.defaultProperties.map((e=>e.columnId))),i.push("id","name","type","subscriptionId","subscriptionDisplayName","resourceGroup","tags");const l=await(0,g.getResourceFromArg)((null===(s=a.browseQueryManifest)||void 0===s?void 0:s.columns)||[],i,null===(o=a.browseQueryManifest)||void 0===o?void 0:o.browseQuery,M,this._resourceId,a.assetTypes,a.locations,a.directoriesMap,this.lifetime),c=(0,g.getValueFromArgResponse)(l,"tags");this._setTags(c),this.resourceName(u.ResourceName.getDisplayName({id:e,name:(0,g.getValueFromArgResponse)(l,"name"),armId:M,tags:c}));const d=null===(t=(0,g.getValueFromArgResponse)(l,"kind"))||void 0===t?void 0:t.toLowerCase();if(d){const e=n.kindMap&&n.kindMap[d]||n.defaultKind;(null==e?void 0:e.icon)&&this.resourceIcon(e.icon)}this._setResourceProperties(l,M,a,r)})),b.AssetTypes.isResourceFavoriteEndPoint.invoke(FxImpl.Rpc.client,"HubsExtension",{resourceId:e}).then((e=>this.isResourceFavorite(e)))}dispose(){this.lifetime.dispose()}}a.ViewModel=C;const F=s(o.Root,null,s("div",{class:"fxs-hover-card-container fxs-portal-background fxs-portal-text"},s("div",{class:"fxs-hide-accessible-label",id:"hoverCardDescriptionId",title:d.ServicesInfo.showResourceCard,"aria-hidden":"true"},d.ServicesInfo.showResourceCard),s("div",{class:"fxs-hover-card-initial"},s("div",{class:"fxs-hover-card-header"},s("div",{class:"fxs-hover-card-icon","data-bind":{image:"resourceIcon"}}),s("header",{class:"fxs-hover-card-title","data-bind":{text:"resourceName",attr:{title:"resourceName"}}}),s("div",{class:"fxs-hover-card-favoriteicon",role:"button","aria-pressed":"false","aria-label":d.KeyboardShortcuts.Toggle.toggleFavoriteService,"data-bind":{fxclick:"setFavorite",image:"isResourceFavorite() ? favoriteIcon : notFavoriteIcon"}})),s("div",{class:"fxs-hover-card-commands"},s("div",{"data-bind":{pcControl:"toolbar"},style:"max-width: 280px"}))),s(o.KoIf,{condition:"resourceProperties()&&resourceProperties().length"},s("div",{class:"fxs-hover-card-border"}),s("div",{class:"fxs-hover-card"},s("div",{class:"fxs-hover-card-additional"},s(o.KoIf,{condition:"tagCollection()&&tagCollection().items()&&tagCollection().items().length"},s("div",{class:"fxs-hover-card-padleftright","data-bind":{pcControl:"tagCollection"}})),s("div",{class:"fxs-hover-card-padless-header fxs-hover-card-no-border"},s("header",{class:"fxs-hover-card-heading"},d.ServicesInfo.HoverCard.Header.resourceDetails)),s("div",{class:"fxs-hover-card-padbottom fxs-hover-card-padleftright"},s("ul",{class:"fxs-hover-card-list","data-bind":{foreach:"resourceProperties"}},s(o.KoIf,{condition:"$data.value"},s("li",{class:"fxs-hover-card-list-item"},s("div",{class:"fxs-hover-card-resource-property"},s("div",{class:"fxs-hover-card-property-name","data-bind":{text:"$data.name"}}),s("div",{class:"fxs-hover-card-property-value"},s(o.KoIf,{condition:"$data.icon&&$data.icon.type"},s("div",{"data-bind":{image:"$data.icon"}})),s(o.KoIf,{condition:"$data.bladeReference"},s("a",{href:"","data-bind":{click:"$parent.openBlade",text:"$data.value",attr:{title:"$data.value"}}})),s(o.KoIf,{condition:"$data.deepLink"},s("a",{href:"",target:"_self","data-bind":{text:"$data.value",attr:{href:"$data.deepLink",title:"$data.value"}}})),s(o.KoIf,{condition:"$data.resourceId"},s("a",{href:"","data-bind":{click:"$parent.openResourceBlade",text:"$data.value",attr:{title:"$data.value"}}})),s(o.KoIfNot,{condition:"$data.resourceId || $data.bladeReference || $data.deepLink"},s("div",{"data-bind":{text:"$data.value"}})))))))))))))}));