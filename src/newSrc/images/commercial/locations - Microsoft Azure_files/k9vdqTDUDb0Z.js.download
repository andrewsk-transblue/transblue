define("MsPortalImpl/Base/Base.HierarchyMap",["require","exports"],(function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HierarchyMap=void 0;const o="##-##";t.HierarchyMap=class{constructor(){this._observable=ko.observableArray()}addItem(e,t){if(!e||!e.length)throw new Error("Invalid path");if(e.some((e=>!e)))throw new Error("Invalid path segment");if(this._getItemIndex(e)>=0)throw new Error(`Duplicate path '${JSON.stringify(e)}'.`);this._observable.push({path:e,_pathKey:e.join(o),value:t})}removeItem(e){const t=this._getItemIndex(e);t>=0&&this._observable.splice(t,1)}removeItemsInPath(e){const t=[];this._getItemsWithPath(e,!0,((e,o)=>!e&&t.push(o))),this._observable(t)}_getItemIndex(e){const t=e.join(o);return MsPortalFx.findIndex(this._observable.peek(),(e=>e._pathKey===t))}getItem(e){const t=this._getItemIndex(e);return t>=0?this._observable.peek()[t]:null}getItemsInPath(e){return this._getItemsWithPath(e,!0)}getItemsUnderPath(e){return this._getItemsWithPath(e,!1)}getObservable(){return this._observable}_getItemsWithPath(e,t,n){const i=e.join(o);return this._observable.peek().filter((o=>{const s=o._pathKey.startsWith(i)&&(t||o.path.length>e.length);return n&&n(s,o),s}))}}})),
define("MsPortalImpl/UI/Compositions/UI.Composition.Journey",["require","exports","MsPortalImpl/Base/Base.HierarchyMap","MsPortalImpl/Services/Services.EditScopeManagement","MsPortalImpl/UI/Compositions/UI.Composition","MsPortalImpl/UI/Compositions/UI.Composition.Base","MsPortalImpl/UI/Compositions/UI.Composition.Finder","MsPortalImpl/Widgets/Widgets.Journey","Fx/ResourceManagement","MsPortalImpl/Widgets/Widgets.Portal.init","MsPortalImpl/UI/Compositions/UI.Composition.Blade"],(function(e,t,o,n,i,s,a,r,l,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.create=t.Instance=void 0;var c=i.CompositionType;function p(e,t){return e.id===t.id}class u extends s.Instance{constructor(e,t,n,i,s,a){super("Journey",e,null,n,i,s),this.journeyBlades=ko.observableArray(),this.lastModifiedTime=ko.observable(Date.now()),this.originTile=t,this._updateBladesMetadata(),this._ambientSettings=a||new o.HierarchyMap,this._setupEditScopeReactor(this.originTile)}get ambientSettings(){return this._ambientSettings}getCompositionType(){return c.Journey}getDeepLink(){return Q(this.await(7).then((()=>{const e=this.children,t=e.length;return t?e[t-1].getDeepLink():this.diContainer.get(a.Finder).findPartsContainer(this.originTile).getDeepLink()})))}isStartedWithContextBlade(){const e=this.children;return e.length>0&&!!(1&e[0].flags)}observeEditScopeChanges(e,t){this._observeEditScopeChanges(e,t,!0)}_observeEditScopeChanges(e,t,o){ko.computed(e,(()=>{const e=t.editScopeId&&t.editScopeId();if(e){const i=this.diContainer.get(n.EditScopeManager).getStateObservable(e)(),s=2===i,a=1===i||s,r=t.ownerLocatable.journeyPath,l=this._ambientSettings;if(a){let n;const i=l.getItem(r);if(i){const e=i.value;if(e){const t=e.editScope;!t||t.dirty===a&&t.saving===s||(l.removeItem(r),n=!0)}}else n=!0;n&&l.addItem(r,{type:t.ownerType,editScope:{editScopeId:e,dirty:a,saving:s,disposeOnSelectionChange:t.disposeOnSelectionChange,disposeOnJourneyDiscard:o}})}else l.removeItem(r)}}))}removeChildAt(e,t){super.removeChildAt(e,t),this._updateBladesMetadata()}_addChildrenInternal(e,t){super._addChildrenInternal(e,t),this._updateBladesMetadata()}_setupEditScopeReactor(e){e&&e.await(7).then((()=>{if(!this.isDisposed()&&e.partDefinition.editScopeType){const t=e,o={editScopeId:e.editScopeId,ownerType:e.locator.type,ownerLocatable:e,disposeOnSelectionChange:!1};this._observeEditScopeChanges(t,o,!1)}}))}_updateBladesMetadata(){const e=this.journeyBlades;if(e){const t=e(),o=MsPortalFx.unique(this.children,p);let n=[];t.forEach((e=>{const t=MsPortalFx.find(o,(t=>p(e,t)));t&&(n.push(e),e.subtitle(t.subtitle()),e.title(t.title()))})),n=MsPortalFx.pushUnique(n,o,p),e(n)}}_compose(e,t){if(!e.options.getJourneyWidget()){const t=new r.ViewModel(this.id,(()=>(0,d.getPortalViewModel)(this.diContainer).getRootPageDisplayType()),this.diContainer);this.widget=new r.Widget(e.options.getJourneyArea(),t)}t.resolve()}getCurrentResourceId(){const e=this.children;for(let t=e.length-1;t>=0;t--){const o=e[t].assetId();if(o&&0!==l.ArmId.parse(o,!0).kind)return o}}}t.Instance=u,t.create=function(e,t){return new u(e,t)}})),
define("MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.Handler",["require","exports","Fx/DependencyInjection","MsPortalImpl/Base/Telemetry","MsPortalImpl/Base/Base.Pipeline","MsPortalImpl/Extension/Extension.Definition.Locator","MsPortalImpl/UI/UI.ContextPane","MsPortalImpl/UI/UI.JourneyManager","MsPortalImpl/UI/Compositions/UI.Composition","MsPortalImpl/UI/Compositions/UI.Composition","MsPortalImpl/UI/Compositions/UI.Composition.Blade","MsPortalImpl/UI/Compositions/UI.Composition.BladeOpenerBase","MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener.Helpers","MsPortalImpl/UI/Compositions/UI.Composition.Finder","MsPortalImpl/UI/Compositions/UI.Composition.PropertyBinding","MsPortalImpl/Extension/ViewModelManager","MsPortalImpl/UI/Compositions/UI.Composition.Journey","MsPortalImpl/UI/Compositions/UI.Composition.Blade"],(function(e,t,o,n,i,s,a,r,l,d,c,p,u,m,g,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.shouldSkipPromptForBladesWithEdits=t.OpenBladeHandler=void 0;var h=MsPortalFx.Base.Diagnostics,I=u.mapMasterModelToBladeModel;const y=h.createLog(e),v=MsPortalFx.noop,b=g.getModelValue;let C=class{constructor(e,t,o,n){this._diContainer=e,this._options=t,this._resources=o,this._bladeRedirector=n}createDescriptor(e,t){const o=t.value;if(void 0!==o&&(!Array.isArray(o)||o.length)){let e=t.timestamp;const n=t.invocationInput.selectableSetV1?o[0]:o,i=!!this._resources.selectable2,{registrationInfo:{invocationInput:a,detailsDefinition:r,additionalInputs:l}}=this._resources,d=I(this._options.masterModelId,n,a);let u=a.opensDynamicBlades?function(e,t,o){const n=t.referenceExtension;return(0,p.mapDynamicSelectionToBladeLocator)(e,o,s.Locator.forExtension(n.name),t.masterModelId)}(this._diContainer,this._options,n):this._resources.detailsBladeLocator;const{container:m}=this._resources;let g,f;u=this._bladeRedirector.applyRedirects(u,d,m instanceof c.Instance&&{bladeDefinition:m.bladeDefinition,locator:m.locator,model:m.getViewModel(1)});let h=!1,y=!!r.asSubJourney,v=!1,b=!1,C=!1,M=!1,B=!1,_="";a.opensDynamicBlades&&n&&(g=n.openInContextPane,f=n.persistentContextPane,i&&(e=n.timestamp,h=!!(2&n.flags),y=!!(8&n.flags),v=!!(128&n.flags),b=!!(256&n.flags),C=!!(512&n.flags),M=!!(64&n.flags),B=!!(1024&n.flags),_=n.telemetryName)),void 0===g&&(g=r.openInContextPane,f=r.persistentContextPane);let P=g?1:0;f&&(P|=2),!h&&(P|=4),y&&(P|=8),v&&(P|=16),b&&(P|=32),C&&(P|=128),M&&(P|=64),B&&(P|=256);const S={timestamp:e,locator:u,masterInvocationProperty:a.source.property,bindings:l.slice(0),model:d,masterInputKeys:Object.keys(d),masterDetailsDefinition:r,flags:P};l.forEach((e=>{S.model[e.targetProperty]=e.source.constantValue})),this._options.configureBindings&&S.bindings&&S.bindings.length&&this._options.configureBindings(S.bindings),this._options.configureBladeDescriptor(S),n&&(S.openedByContext=n.context,n.defaultMenuItemId&&(S.defaultMenuItemId=n.defaultMenuItemId,S.contentBladeReference=n.contentBladeReference,n.flags|=64)),S.telemetryName=_;const x=this._options.referenceComposition&&this._options.referenceComposition.partDefinition;n&&(n.assetType&&n.detailBladeInputs?S.originAssetType=n.assetType:n.originAssetType&&n.detailBladeInputs&&n.detailBlade?(S.originAssetType=n.originAssetType,S.originAssetTypeExtension=n.originExtension):x&&(S.originAssetType=x&&x.assetType,S.originAssetTypeExtension=this._options.referenceExtension&&this._options.referenceExtension.name)),t.descriptor=S}}openBlade(e,t){const o=this._options,i=this._resources,s=t.invocationInput,c=i.container,u=t.value;(0,p.traceInvocationChange)(y,"Executing invocation property change",this._diContainer,o,s,u),c&&c.onInvocationStarted();const h=function(e,t,o,i,s,c,p){const u=p.invocationInput;let h=!0;const v=u.selectableSetV1&&s;if(!(void 0===s||v&&0===v.length))return function(e,t,o,i,s,c,p){const u=e.get(m.Finder),h=p.invocationInput,v=p.additionalInputs,C=p.detailsDefinition,B=Q.defer(),_=()=>{B.resolve([])},P=s;let S=!0;const x=o.getCloseOtherDetailBladesHandler(h,C)||((t,n)=>function(e,t,o,n,i,s,a){const l=e.get(r.JourneyManager),c=e.get(m.Finder),p=c.findSiblingBlades(t.referenceComposition,!!(32&s.flags)),u=e=>t.isBladeOpenedByMaster(e)&&e.masterInvocationProperty===n.source.property;let g,f,h=!0,I=!1,v=a&&a.getContent();v&&v.id&&p.some((e=>e.id===v.id))&&(v=null);g=p.filter((e=>{let t=!1;const o=e.bladeDefinition,n=!!(2&(null==s?void 0:s.flags)),a=!!(2&e.flags);if(!(e.isDisposed()||256&e.flags||n!==a))if(!u(e)||1&(null==o?void 0:o.attributes)||64&(null==s?void 0:s.flags))t=!0;else{if(e.locator.equals(s.locator)){const o=function(e,t){let o=e;if(e&&t&&t.length){const n={};t.forEach((e=>{n[e.targetProperty]=!0})),o=MsPortalFx.forEachKey(e,((e,t,o)=>{n[e]||(o[e]=t)}),{})}return o}(s.model,i);t=!(0,d.deepSubset)(e.getBindableContainer().getViewModel(),o),f=e}else t=!0}return t}));let b=M(e,g);if(g.length===p.length&&f&&function(e,t){var o;let n=[];const i=e.widget;i&&(n=i.options.commandBar.menuItems(),e.children.forEach((e=>{e.children.forEach((e=>{const t=e.widget;t&&(n=n.concat(t.options.commands))}))})));const s=t.masterDetailsDefinition,a=s&&!!s.parameterCollector,r=1&(null===(o=e.bladeDefinition)||void 0===o?void 0:o.attributes)||64&t.flags,l=!e.isDisabled&&e.bladeDefinition&&!e.bladeDefinition.waitForInputsSet&&!r&&!a&&n.every((e=>e.canRebind));l||r||a||y.warning(`Unable to rebind Blade '${e.id}', it was either disabled, cleared, or one of its commands was executing. Will close and reopen blade instead.`);return l}(f,s)){MsPortalFx.remove(g,f),g=g.concat(c.findBlades(f));const e=l.discardEditsOfBlade(f,{includeSelf:!1,includeDescendants:!0,force:b});h=e.successful,I=h&&e.confirmationRequired}const C=!(21===(null==s?void 0:s.flags));if(h&&!I&&C){let e=!0;const t=g.length>0,o=t;v&&v.id&&!t&&(e=l.confirmBladesCanClose([v])),t&&(b=!1),h=b?e:l.confirmBladesCanClose(g,null,o)}if(h)for(let e=g.length-1;e>=0;e--){const n=g[e];u(n)&&(t.removeOutputBindings(n),o.bladesClosedByPart.set(n,!0)),l.forceCloseBlade(n,1,{openBlade:!0})}return h}(e,o,i,h,v,t,n)),D=e=>o.onBladesOpening(e),O=e.get(r.JourneyManager);let w;if(!Array.isArray(s)||P.length){const r=!!(2&(null==t?void 0:t.flags)),d=e.get(a.RightContextPane);if(S=!!(256&t.flags)||x(t,d)){"getCompositionType"in(d.getContent()||{})||1&t.flags||c.menu||d.close();const a=u.findBlades(i.container,!!(32&(null==t?void 0:t.flags)));let p;const v=a[0];if(256&~t.flags&&1===a.length&&v.widget&&64&~t.flags&&!r==!(2&v.flags)){p=!0;const e=h.selectableSetV1?s[0]:s,t=I(o.referenceComposition?o.referenceComposition.locator.toString():o.masterModelId,e,h);n.isDesktopTraceEnabled&&y.verbose(`[BladeOpener] Rebinding blade.\n  ${v}.\n  New Model: ${ko.toJSON(t)}`),w=v;const a=v.rebindAsync(t);i.selectable2?a.finally(_):_()}if(!p){let n;if(D([t]),"##NOT_SPECIFIED##"!==t.locator.name){e.get(f.ViewModelManager).tryEarlyGetViewModel(t.locator.getExtensionName(),t.locator.name,t.model,{isPrefetch:!0,menuId:t.defaultMenuItemId,inContextPane:!!(1&t.flags),isMenuBladeContent:(()=>{const t=e.get(m.Finder).findPartsContainer(o.referenceComposition),n=t&&t.getCompositionType()===l.CompositionType.Blade&&t.bladeDefinition;return!(!n||!n.menuBlade&&!n.tabMenuBlade)})(),menuContentOverride:t.contentBladeReference,inSideBar:!!(256&t.flags)}),n=!0}MsPortalFx.tryImmediateResolve(n?Q.delay(0):Q(),(()=>{e.isDisposed()?B.reject(new MsPortalFx.Errors.DisposedCanceledError):O.openBlade(c,t).then((e=>{e&&e.onDispose((()=>{!function(e,t,o,n,i,s){const a=e.referenceComposition&&e.referenceComposition.id;if(a&&a!==o.masterPartId)return;const r=t.get(o);e.removeOutputBindings(o),r||function(e,t,o,n){const i=b(e.masterModel,t.source.property).value,s=ko.toJS(i);if(Array.isArray(s))i.splice(0,s.length);else{!!(o&&64&n.flags)&&ko.unwrap(i)!==n||g.setModelValue(e.masterModel,t.source.property,void 0)}}(e,n,i,s)}(o,i.bladesClosedByPart,e,h,!!i.selectable2,s)})),B.resolve([e])}))})),i.previousInvocationPromise=B.promise.finally((()=>{i.previousInvocationPromise=void 0}))}}else _()}return B.promise.then((e=>{const t=i.selectable2,n=p.invocationOutputs,s=(e=e||[]).filter((e=>t||!(2&(null==e?void 0:e.flags)))),a=1===s.length?s[0]:void 0;if(e.filter((e=>!!e)).forEach(i.bladeOpenedCallbacks.fire),!t&&s.length>0&&Array.isArray(n)&&n.length>0)if(a)a.await(7).then((()=>{o.addOutputBindings(a,n)}));else{const t=e.map((e=>e.getDiagnosticsData())),i=`Unable to create output binding with detail blade, multiple detail blades found.\nMaster Model Debug Id: ${o.masterModelId}.\nOutput Arguments: ${ko.toJSON(n,null,2)}\nDetail Blades: ${ko.toJSON(t,null,2)}`;y.error(i)}})),{succeeded:S,bladeOpenPromise:B.promise,reboundBlade:w}}(e,t,o,i,s,c,p);{const t=o.getCloseOwnedDetailBladesHandler(u)||(()=>function(e,t,o,n){const i=e.get(r.JourneyManager);if(!i.activeJourney())return!0;const s=e.get(m.Finder).findBlades(t.referenceComposition).filter((e=>!e.isDisposed()&&e.masterInvocationProperty===n.source.property&&t.isBladeOpenedByMaster(e))),a=M(e,s)||i.confirmBladesCanClose(s);if(a){const e=B(t,n)||{};for(let n=s.length-1;n>=0;n--){const a=s[n],r=e._msPortalFxDelayedBladeSelection;o.set(a,!0),t.removeOutputBindings(a),i.forceCloseBlade(a,1,{openBlade:r})}}return a}(e,o,i.bladesClosedByPart,u));h=t()}return{succeeded:h,bladeOpenPromise:void 0,reboundBlade:void 0}}(this._diContainer,t.descriptor,o,i,u,c,i.registrationInfo);h.succeeded?(i.resettingMasterArrayValue=!1,i.prevValue=u):i.resettingMasterArrayValue?(y.error("Resetting value of master '{0}' also caused a prompt".format(o.masterModelId),0,i.prevValue),i.resettingMasterArrayValue=!1):(i.resettingMasterArrayValue=s.selectableSetV1,function(e,t,o){const n=e.referenceExtension,i=()=>n.processMessages();i().then((()=>{const n=`Set invocation property '${t.source.property}' of master '${e.masterModelId}' to value.`;y.verbose("START: "+n,o);const s=t.source.property,a=B(e,t),r=a&&a.isSelected;if(a&&r&&void 0!==o){const t=function(e,t){let o=e;if(!e)return;o.lock&&o.setInternalSelectedValue&&o.isLocked||(y.error(`selectable is not a framework implementation, view model = '${t}'`),o={lock:v,setInternalSelectedValue:function(t){e.selectedValue(t)},isLocked:v});return o}(a,e.masterModelId);t.setInternalSelectedValue(o),r()||r(!0)}else g.setModelValue(e.masterModel,s,o);if(s.indexOf("activatedItems")>=0){const t=s.replace("activatedItems","selectedItems"),n=b(e.masterModel,t),a=n.exists&&n.value;ko.isObservable(a)&&Array.isArray(a())&&i().then((()=>{a.splice.apply(a,[0,a().length].concat(o))}))}y.verbose("END: "+n,o)}))}(o,s,i.prevValue)),t.reboundBlade=h.reboundBlade;const C=h.bladeOpenPromise;return C?C.then((e=>{t.openedBlades=e})):null}};function M(e,t){const o=e.get(r.JourneyManager).activeJourney();return t.every((e=>{if(!e.isInitialized)return!0;const t=!!e.bladeDefinition.actionBar;if(e.shouldAlertOnClose({legacyMode:t})){if(!t)return!1;{const t=e.getViewModel(2),o=t&&t.content(),n=o&&o.output&&o.output();if(3!==(n&&n.status))return!1}}return o.ambientSettings.getItemsInPath(e.journeyPath).every((e=>!(!e||!e.value||1!==e.value.type)&&(!e.value.editScope||e.value.editScope.disposeOnSelectionChange)))}))}function B(e,t){const o=t.source.property.lastIndexOf("."),n=o>0?t.source.property.substring(0,o):"";return b(e.masterModel,n).value}__decorate([__metadata("fx:diagnostics",[e,"OpenBladeHandler.prototype"]),i.Step(4),__metadata("design:type",Function),__metadata("design:paramtypes",[i.Task,Object]),__metadata("design:returntype",void 0)],C.prototype,"createDescriptor",null),__decorate([__metadata("fx:diagnostics",[e,"OpenBladeHandler.prototype"]),i.Step(5),__metadata("design:type",Function),__metadata("design:paramtypes",[i.Task,Object]),__metadata("design:returntype",void 0)],C.prototype,"openBlade",null),C=__decorate([__metadata("fx:diagnostics",[e,"OpenBladeHandler"]),o.Class("pipeline"),__metadata("design:paramtypes",[o.Container,p.Configuration,p.Resources,u.BladeRedirector])],C),t.OpenBladeHandler=C,t.shouldSkipPromptForBladesWithEdits=M}));