define("MsPortalImpl/UI/Compositions/UI.Composition.Selectable2Registrar",["require","exports","Fx/DependencyInjection","MsPortalImpl/Base/Base.Selectable2","MsPortalImpl/UI/UI.BladeOpener","MsPortalImpl/UI/Compositions/UI.Composition.BladeOpener","MsPortalImpl/Base/Base.ImplUtils","MsPortalImpl/Base/Base.Events","MsPortalImpl/UI/UI.LinkHandler"],(function(e,t,n,r,a,o,l,i,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.discoverSelectables=t.attachFxClickHandler=t.getListSelectableWithClickHandler=t.getSelectableWithClickHandler=t.createFxColumnSelectable=t.registerOpenBladeCommands=t.registerSelectables=void 0;var c=FxImpl,d=MsPortalFx.Base.Diagnostics,u=o.createOrGetInternalSelectionState,p=r.getFxClickSelectable,f=r.getOrCreate,b=r.findExtensionViewModel,m=r.getOrCreateOpenBladeSelectable;const h=d.createLog(e),g="fxclick",C="href",k="fxs-fxclick",x=["_msPortalFxShell","_msPortalFxOpenBladeSelectable","_msPortalFxSelectable","_msPortalFxSelectable2"],v=["selectable","activeOpenBladeCommand"];t.registerSelectables=function(e,t,n,r){const a=new Map,o=()=>{!function(e,t,n){const r=O(t);ko.ignoreDependencies((()=>{const t=[];e.forEach(((e,n)=>{r.has(n)||t.push(e)})),t.forEach((t=>{e.delete(t.selectable)})),r.forEach(((t,r)=>{e.has(r)||(!function(e,t,n){const r=n.getBladeOpener(),a={invocationInputArguments:[{valuesFrom:[{referenceType:0,property:t.path}]}]},o=f(n.diContainer,t.selectable);r.registerInvocationProperty(a,void 0,o)}(n.diContainer,t,n),e.set(r,t))}))}))}(a,t,n)};r?ko.computed(e,o).extend({rateLimit:{timeout:100,method:"notifyWhenChangesStop"}}):o()},t.registerOpenBladeCommands=function(e,t,n,r,a){const o=e.filter((e=>10===e.type));if(0===o.length)return!0;if(!function(e,t){e=e||[];const n="Found {0} OpenBladeCommmand2 items with a null or undefined '{1}' property. Source: '{2}'";function r(r){const a=e.filter((e=>!e[r]));return a.length&&h.error(n.format(a.length,r,t)),!!a.length}if(["id","selectable"].some(r))return!1;const a=function(e){const t={},n=[];return(e||[]).forEach((e=>{t[e]&&n.push(e),t[e]=!0})),n}(e.map((e=>e.id)));if(a.length)return h.error("Found multiple OpenBladeCommand2 items have the same id. Ids must be unique. Duplicate Id(s): '{0}', Source: '{1}'".format(JSON.stringify(a),t)),!1;return!0}(o,n.locator))return!1;const l=u(t)[r],i={};return o.forEach((e=>{const r=e.selectable,a=f(n.diContainer,r);i[a.id]=r,a.registerForDispose({dispose:()=>{const e=MsPortalFx.clone(l(),!1);delete e[a.id],l(e)}}),ko.reactor(a,(()=>{a.isSelected()&&t.internal.activeOpenBladeCommand(e)}))})),l(i),!0};const I="msportalfx-activated",F=`${I} ext-${I}`;let y=0;function A(e){let t=MsPortalFx.Base.ProxiedObservables.data(e,g);return t||(t=g+y++,MsPortalFx.Base.ProxiedObservables.data(e,g,t)),t}function P(e,t,n,r){const a=b(n);if(a){const n=A(t),o=m(e,n,a);return o.onClick=()=>{o.invokeClickCallback(1,a,t,r)},o}}function B(e,t){try{let n=ko.unwrap(e[t]);return(Array.isArray(n)||"object"!=typeof n)&&(n=void 0),n}catch(e){return}}function S(e,t){return e?e+"."+t:t}function O(e){const t=new Map;return E(e,"content",t),E(e,"container",t,x),E(e,"internal",t,v),t}function E(e,t,n,r){const a=B(e,t),o=[{path:t,value:a,unprocessedChildProperties:r?r.slice():M(a)}];for(;o.length;){const e=o[o.length-1];if(e.unprocessedChildProperties.length){const t=e.unprocessedChildProperties.shift(),r=B(e.value,t);if(r)if(c.isSelectable2(r))n.set(r,{path:S(e.path,t),selectable:r});else if(o.length<15){const n={path:S(e.path,t),value:r,unprocessedChildProperties:M(r)};o.push(n)}}else o.pop()}}function M(e){return Object.keys(e).filter((e=>{return!(95===(t=e).charCodeAt(0)&&(109!==t.charCodeAt(1)||115!==t.charCodeAt(2)||80!==t.charCodeAt(3)||111!==t.charCodeAt(4)||114!==t.charCodeAt(5)||116!==t.charCodeAt(6)||97!==t.charCodeAt(7)||108!==t.charCodeAt(8)||70!==t.charCodeAt(9)||120!==t.charCodeAt(10)));var t}))}t.createFxColumnSelectable=function(e,t,n,r,o){const l=b(r);let s,c;const d=ko.observable(),u=m(e,"FxGrid_"+o,l,(e=>{const n=e;ko.reactor(t,(()=>{const t=n.activationState();if(t){const n=t.current&&t.current.item;n!==c&&(d(e.value()),c=n,c&&s&&(s.trigger($.Event("fxselectableactivated",{activated:d})),s=null))}}))}));return{activated:d,invokeClick:(e,t,r)=>{const a=l&&l.internal&&l.internal.elements||ko.observableArray(),o=(0,i.getOrCreateFxElement)(t[0],a);u?(s=t,u.invokeClickCallback(3,l,n,e,o,{row:r,element:o})):e({row:r,element:o})},openBlade:async(t,n,r)=>{u&&(s=n,e.get(a.BladeOpener).openBlade(t,{selectable:u,flags:0,selectedItem:r}))},openContextPane:async(t,n,r)=>{u&&(s=n,e.get(a.BladeOpener).openBlade(t,{selectable:u,flags:1,selectedItem:r}))}}},t.getSelectableWithClickHandler=P,t.getListSelectableWithClickHandler=function(e,t,n,r){const a=P(e,t,n,$.noop),o=a,l=b(n);return o.onClick=e=>{a.invokeClickCallback(3,l,t,r,void 0,e.item,e.metadata)},o},t.attachFxClickHandler=function(t,r,a,o){const i=o||new FxImpl.TriggerableLifetimeManager;o||ko.utils.domNodeDisposal.addDisposeCallback(t,(()=>{i.dispose()}));const c=$(t),d=r.$data,u=r.$dicontainer||n.container,f=p(u,i,c,g,A(d)),b="A"===t.tagName;let m=!0,h=!0;const x=e=>{e=h||!!e,t.setAttribute("aria-disabled",`${e}`),c.toggleClass("azc-text-disabled",e);const n=ko.unwrap(r.$tabIndex),a=e?-1:n||0;t.setAttribute("tabindex",`${a}`)};let v,y=(e,t,n)=>!0;const P=ko.observable(""),B=(0,s.getLinkTelemetryLogger)(c,P,"LinkRightClicked");t.addEventListener("contextmenu",(e=>{B()})),ko.reactor(i,(()=>{try{v&&v.dispose(),v=i.createChildLifetime();const n=ko.unwrap(a);P((null==n?void 0:n.telemetryName)||""),ko.ignoreDependencies((()=>{let a;if("function"==typeof n){const r=n;a=n=>{n.stopPropagation();const a=b&&t.getAttribute(C)||"";if(s.defaultHref===a)n.preventDefault();else if(b&&"keydown"===n.type&&(13===n.which||32===n.which&&"button"===t.getAttribute("role"))||"BUTTON"===t.tagName&&(32===n.which||13===n.which))return;Q.isPromiseAlike(r)&&l.logToExtension(e,t,2,FxImpl.createError("fxclick binding argument is not a callback function. The click handler is "+r)),f.invokeClick(d,r,n)}}else a=n;const o=(0,s.getUriAndHandler)(v,u,a,!b);let i=h;o.uri.subscribeAndRun(v,(e=>{if(h=!e,(r.$disabled||i!==h)&&(i=h,x(r.$disabled&&r.$disabled())),b){let n=!1;m&&(n=!!t.getAttribute(C)),n&&e===s.defaultHref||(e?(t.setAttribute(C,e),m=!1):(t.removeAttribute(C),m=!1))}})),o.errorMessage.subscribeAndRun(v,(n=>{n&&l.logToExtension(e,t,1,FxImpl.createError(`fxclick failure: ${MsPortalFx.getLogFriendlyMessage(n)}`))})),y=o.handler}))}catch(n){l.logToExtension(e,t,2,FxImpl.createError(`fxclick failed to read value: ${MsPortalFx.getLogFriendlyMessage(n)}`))}})),ko.reactor(i,[r.$disabled,r.$tabIndex],x),t.classList.add(k);const S=n=>{if(ko.unwrap(r.$disabled)||"true"===t.getAttribute("aria-disabled")){if("click"===n.type||"keydown"===n.type&&(13===n.which||32===n.which&&("BUTTON"===t.tagName||"button"===t.getAttribute("role"))))return!1}else try{return y(n,f,P())}catch(n){l.logToExtension(e,t,2,FxImpl.createError("fxclick failed to execute click handler",{innerErrors:n,data:{databind:$(t).attr("data-bind")}}))}};i.registerForDispose([()=>t.classList.remove(k),c.setEvents(["click",S],["keydown",S])]),f.activated.subscribeAndRun(i,(e=>{const t=!!e;!function(e,t){t?(e.closest(".fxs-part-content").find("."+I).removeClass(F),e.addClass(F)):e.removeClass(F)}(c,t),t&&c.trigger($.Event("fxselectableactivated",{activated:f.activated}))}))},t.discoverSelectables=O}));