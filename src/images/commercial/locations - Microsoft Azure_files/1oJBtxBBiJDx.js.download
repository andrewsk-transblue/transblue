define("MsPortalImpl/Widgets/ServiceHoverCard",["require","exports","MsPortalImpl/TsxStringMode/Tsx","MsPortalImpl/TsxStringMode/Tsx","Fx/Controls/Toolbar","MsPortalImpl/Resources/ImplScriptResources","FxHubs/RpcEndPoints","MsPortalImpl/Services/Services.BrowseCuration","FxHubs/ResourceCommands/BrowseCommanding","MsPortalImpl/UI/UI.BladeOpener","Fx/Experimentation","MsPortalImpl/UI/Hubs/UI.FavoritesManagerDeferred","MsPortalImpl/UI/Hubs/UI.FavoritesManager","FxHubs/RpcEndPoints","MsPortalImpl/Services/Services.AssetTypes","Fx/Composition/Selectable","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Widgets/Widgets.HoverCard"],(function(e,i,a,t,s,r,o,n,d,l,c,v,f,h,p,u,x,g){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.ViewModel=void 0;var b=s.ToolbarItems.createBasicButton,m=MsPortalFx.Base.Images,k=FxImpl.TriggerableLifetimeManager;function I(e){MsPortalFx.require("MsPortalImpl/Widgets/Widgets.SideBarFlyout").then((i=>{const a=e.diContainer.get(f.FavoritesManager);i.toggleFavorite({clickedFavorite:e.favorite,favoritesManager:e.diContainer.get(f.FavoritesManager),favoritesManagerDeferred:e.diContainer.get(v.FavoritesManagerDeferred),telemetrySource:"ServiceHoverCard"}),a.loadFavorites()}))}class C extends g.ViewModel{constructor(e,i,a,t){super(),this.onClickToggleExpandedState=()=>{this.isDescriptionExpanded(!this.isDescriptionExpanded())},this.additionalInfo=ko.observable(),this.possibleFavorite=ko.observable(),this.favoriteInitial=null,this.addIcon=m.Add({palette:3}),this.viewIcon=m.View({palette:3}),this.favoriteIcon=m.Star({palette:99}),this.notFavoriteIcon=m.Favorite({palette:99}),this.isDescriptionExpanded=ko.observable(!1),this.seeMoreString=ko.pureComputed((()=>this.isDescriptionExpanded()?r.ServicesInfo.HoverCard.seeLess:r.ServicesInfo.HoverCard.seeMore)),this.expandIcon=m.CaretDown(),this.toolbar=ko.observable(),this.tweakHoverCard=ko.observable(!1),this.lifetime=new k,this.template=F,this.dockingElement=i,this.focusContent=this.toolbar,this._hoverCardSource=t,this.possibleFavorite(e),this.onFavoritesChange=e=>{const i=MsPortalFx.find(e,(e=>e&&e.id===this.possibleFavorite().id));i&&this.possibleFavorite(i)},this.setFavorite=()=>{if(this.favoriteOnDismiss){this.updateFavorite=()=>{const e=this.possibleFavorite(),i=e.isFavorite();i!==!!a.get(f.FavoritesManager).favorites.value.find((i=>i.id===e.id))&&(e.isFavorite=ko.observable(!i),I({favorite:e,diContainer:a}))};const e=this.possibleFavorite();e.isFavorite(!e.isFavorite())}else I({favorite:this.possibleFavorite(),diContainer:a})},this.shouldShowExpandButton=e=>$(e.parentNode).findByClassName("fxs-hover-card-description")[0].scrollHeight>90,this._bladeManagement={openBlade:e=>a.get(l.BladeOpener).openBlade(e,{flags:8,telemetryName:"ServiceHoverCard"}),openContextPane:e=>a.get(l.BladeOpener).openBlade(e,{flags:9,telemetryName:"ServiceHoverCard"}),openBladeAsync:()=>Promise.resolve(!1),openContextPaneAsync:()=>Promise.resolve(!1)},(0,n.getAllServicesAdditionalData)().then((e=>{var i,t;this.additionalInfo(function(e,i,a,t){const s=e.id,r=i&&i[s]||{};let o,n,{assetTypeManifest:d}=e.assetType;e.kind&&e.assetType.kindMap&&(d=e.assetType.kindMap[e.kind.toLowerCase()]||d);"HubsExtension_BrowseAllResources"===s&&(d.marketplaceItemId="hub");d.marketplaceItemId?o=`#create/${d.marketplaceItemId}`:d.noPdlCreateBlade&&(n=new u.ProvisioningBladeReference(d.noPdlCreateBlade,d.noPdlCreateExtension||e.assetType.extension));const l=ko.observable();s.toLowerCase()===p.lowerCaseAllResourcesId?l((0,p.getBrowseAllDeeplink)()):(0,p.getBrowseBladeUri)(a,s.toLowerCase()).then((i=>l(i||e.uri)));const c=ko.observableArray();return Q.all([MsPortalFx.require("MsPortalImpl/UI/UI.DeepLink"),h.AssetTypes.getRecentResourcesEndPoint.invoke(a.get(FxImpl.Rpc.Client),MsPortalFx.Base.Constants.ExtensionNames.Hubs,{limit:3,assetTypeId:"HubsExtension_BrowseAllResources"===s?void 0:s})]).spread(((e,i)=>{c(i.map((i=>{const{resourceId:t,timeStamp:s,name:r}=i,{icon:o}=i.assetTypeInformation,n=new Date(s).toRelativeString("difference");return{resourceId:e.getResourceDeepLink(a,t),timeStamp:n,icon:o,name:r}})))})),{recentClick:i=>((0,g.logTelemetry)("BrowseRecentResourceLinkClicked",e.id,{resourceName:i.name,resourceId:i.resourceId,source:t}),!0),usefulClick:i=>((0,g.logTelemetry)("UsefulResourceLinkClicked",e.id,{linkDestination:i.link,displayTitle:i.linkTitle,source:t}),!0),trainingClick:i=>((0,g.logTelemetry)("TrainingLinkClicked",e.id,{linkDestination:i.link,displayTitle:i.title,source:t}),!0),freeClick:i=>((0,g.logTelemetry)("FreeOfferingLinkClicked",e.id,{linkDestination:i.createUri,displayTitle:i.title,source:t}),!0),createLink:o,createBladeReference:n,deepLink:l,description:d.description,freeOfferings:r.freeOfferings,recents:c,trainings:r.trainings,usefulLinks:r.usefulLinks}}(this.possibleFavorite(),e.assetTypesDataMap,a,this._hoverCardSource)),o.ArtBrowse.getBrowsePrereqsEndpoint.invoke(FxImpl.Rpc.client,"fxw",{resourceType:null===(t=null===(i=this.possibleFavorite())||void 0===i?void 0:i.assetType)||void 0===t?void 0:t.lowerCaseResourceType,includeColumnsVersion:2}).then((async e=>{var i,t,o,n,c,v,f,h,p,u,m;const k=e&&(0,d.createServiceHoverCardCommand)(`ServiceHoverCard-${this._hoverCardSource}`,null==e?void 0:e.browseQueryManifest,this.lifetime,(()=>{var e,i;return null===(i=null===(e=this.possibleFavorite())||void 0===e?void 0:e.assetType)||void 0===i?void 0:i.extension}),null===(i=this.possibleFavorite())||void 0===i?void 0:i.resourceType,this._bladeManagement,null===(t=this.possibleFavorite())||void 0===t?void 0:t.isDisabled,null===(c=null==e?void 0:e.assetTypes[null===(n=null===(o=this.possibleFavorite())||void 0===o?void 0:o.resourceType)||void 0===n?void 0:n.toLowerCase()])||void 0===c?void 0:c.hiddenCommands,null===(v=this.possibleFavorite())||void 0===v?void 0:v.kind),I=[];k?I.push(k):((null===(f=this.additionalInfo())||void 0===f?void 0:f.createLink)||(null===(h=this.additionalInfo())||void 0===h?void 0:h.createBladeReference))&&I.push(b(this.lifetime,{label:r.ActionBarButtons.create,icon:this.addIcon,tooltip:(null===(p=this.possibleFavorite())||void 0===p?void 0:p.isDisabled)&&x.SideBarFlyout.disabledMessage,onClick:()=>{(0,g.logTelemetry)("CreateResourceLinkClicked",this.possibleFavorite().id,{source:this._hoverCardSource}),this.additionalInfo().createLink?window.location.hash=this.additionalInfo().createLink:a.get(l.BladeOpener).openBlade(this.additionalInfo().createBladeReference,{flags:2,telemetryName:"ServiceHoverCard"}),this.widget.dispose()},disabled:null===(u=this.possibleFavorite())||void 0===u?void 0:u.isDisabled})),(null===(m=this.additionalInfo())||void 0===m?void 0:m.deepLink)&&I.push(b(this.lifetime,{label:r.ActionBarButtons.view,icon:this.viewIcon,onClick:()=>{(0,g.logTelemetry)("ViewResourceLinkClicked",this.possibleFavorite().id,{source:this._hoverCardSource}),window.location.hash=this.additionalInfo().deepLink()}})),this.toolbar(s.create(this.lifetime,{items:I,showLabels:!0}))}))})),async function(e){const i=await e.getAsync(c.Experimentation);return await i.getAssignments()}(a).then((e=>{this.tweakHoverCard(e.getBooleanValue("tweakservicehovercard"))}))}}i.ViewModel=C;const F=a(t.Root,null,a("div",{class:"fxs-hover-card-container fxs-portal-background fxs-portal-text"},a("div",{class:"fxs-hide-accessible-label",id:"hoverCardDescriptionId",title:r.ServicesInfo.showServiceCard,"aria-hidden":"true"},r.ServicesInfo.showServiceCard),a("div",{class:"fxs-hover-card-initial","data-bind":{css:{"fxs-hover-card-padbottom":"!additionalInfo()"}}},a("div",{class:"fxs-hover-card-header"},a("div",{class:"fxs-hover-card-icon","data-bind":{image:"possibleFavorite().icon || possibleFavorite().image"}}),a("div",null,a("header",{class:"fxs-hover-card-title","data-bind":{text:"possibleFavorite().label",attr:{title:"possibleFavorite().label"}}}),a(t.KoIf,{condition:"possibleFavorite().isDisabled"},a("div",{class:"msportalfx-preview-text fxs-hover-card-disabled-tag",title:x.SideBarFlyout.disabledMessage},x.SideBarFlyout.disabled)),a(t.KoIf,{condition:"tweakHoverCard() && possibleFavorite().isPreview"},a("div",{class:"msportalfx-preview-text fxs-hover-card-preview-tag",title:x.SideBarFlyout.preview},x.SideBarFlyout.preview))),a(t.KoIf,{condition:"additionalInfo()"},a("div",{class:"fxs-hover-card-favoriteicon",role:"button","aria-pressed":"false","aria-label":r.KeyboardShortcuts.Toggle.toggleFavoriteService,"data-bind":{fxclick:"setFavorite",image:"possibleFavorite().isFavorite() ? favoriteIcon : notFavoriteIcon"}}))),a("div",{class:"fxs-hover-card-commands"},a("div",{"data-bind":{pcControl:"toolbar"}}))),a(t.KoIf,{condition:"additionalInfo()"},a("div",{class:"fxs-hover-card-border"}),a("div",{class:"fxs-hover-card"},a("div",{class:"fxs-hover-card-additional","data-bind":{with:"additionalInfo"}},a(t.KoIf,{condition:"recents"},a(t.KoIf,{condition:"recents().length"},a("div",{class:"fxs-hover-card-padless-header"},a("header",{class:"fxs-hover-card-heading"},r.ServicesInfo.HoverCard.Header.recents)),a("ul",{class:"fxs-hover-card-training fxs-hover-card-list fxs-hover-card-padbottom","data-bind":{foreach:"recents"}},a("li",{class:"fxs-hover-card-list-item"},a("div",{class:"fxs-hover-card-training-item fxs-portal-hover"},a("div",{class:"fxs-hover-card-training-icon","data-bind":{image:"$data.icon"}}),a("div",{class:"fxs-hover-card-training-link"},a("a",{class:"fxs-hover-card-training-link",href:"","data-bind":{click:"$parent.recentClick",text:"$data.name",attr:{title:"$data.name",href:"$data.resourceId"}}}),a("div",{class:"fxs-hover-card-training-sub"},a("span",{"data-bind":{text:"$data.timeStamp"}}))))))),a(t.KoIfNot,{condition:"recents().length"},a(t.KoIf,{condition:"description"},a("div",{class:"fxs-hover-card-section"},a("header",{class:"fxs-hover-card-heading"},r.ServicesInfo.HoverCard.Header.description),a("div",{"data-bind":{text:"description",css:{"fxs-hover-card-description":"true","fxs-hover-card-expanded-description":"$parent.isDescriptionExpanded()"}}}),a(t.KoIf,{condition:"$parent.shouldShowExpandButton($element)"},a("a",{href:"#",class:"fxs-hover-card-seemore-link",tabindex:"0","data-bind":{click:"$parent.onClickToggleExpandedState",clickBubble:"false"}},a("div",{class:"fxs-hover-card-see-more-less","data-bind":{text:"$parent.seeMoreString",attr:{title:"$parent.seeMoreString",ariaLabel:"$parent.seeMoreString"}}}),a("div",{"data-bind":{image:"$parent.expandIcon",css:{"fxs-hover-card-expand-icon":"true","fxs-hover-card-icon-vertical-transform":"$parent.isDescriptionExpanded()"}}}))))))),a(t.KoIf,{condition:"trainings && trainings.length"},a("div",{class:"fxs-hover-card-padless-header"},a("header",{class:"fxs-hover-card-heading"},r.ServicesInfo.HoverCard.Header.training)),a("ul",{class:"fxs-hover-card-training fxs-hover-card-list fxs-hover-card-padbottom","data-bind":{foreach:"trainings"}},a("li",{class:"fxs-hover-card-list-item"},a("div",{class:"fxs-hover-card-training-item fxs-portal-hover"},a("div",{class:"fxs-hover-card-training-link"},a("a",{class:"msportalfx-ext-link",href:"",target:"_blank","data-bind":{click:"$parent.trainingClick",text:"$data.title",attr:{title:"$data.title",href:"$data.link"}}}),a("div",{class:"fxs-hover-card-training-sub"},a("span",{"data-bind":{text:"$data.units"}}),a(t.KoIf,{condition:"$data.units && $data.duration"},a("span",null," · ")),a("span",{"data-bind":{text:"$data.duration"}}))))))),a(t.KoIf,{condition:"usefulLinks && usefulLinks.length"},a("div",{class:"fxs-hover-card-section fxs-hover-card-padleftright"},a("header",{class:"fxs-hover-card-heading"},r.ServicesInfo.HoverCard.Header.usefulLinks),a("ul",{class:"fxs-hover-card-list","data-bind":{foreach:"usefulLinks"}},a("li",{class:"fxs-hover-card-list-item"},a("a",{target:"_blank","data-bind":{click:"$parent.usefulClick",text:"$data.title",attr:{href:"$data.link"},css:{"msportalfx-ext-link":"$data.isExternalLink"}}}))))),a(t.KoIf,{condition:"!$parent.tweakHoverCard() && freeOfferings && freeOfferings.length"},a("div",{class:"fxs-hover-card-padless-header"},a("header",{class:"fxs-hover-card-heading"},r.ServicesInfo.HoverCard.Header.freeOfferings)),a("ul",{class:"fxs-hover-card-training fxs-hover-card-list fxs-hover-card-padbottom","data-bind":{foreach:"freeOfferings"}},a("li",{class:"fxs-hover-card-list-item"},a("div",{class:"fxs-hover-card-training-item fxs-portal-hover"},a("div",{class:"fxs-hover-card-training-link"},a("a",{class:"fxs-hover-card-training-link",href:"","data-bind":{click:"$parent.freeClick",text:"$data.title",attr:{href:"$data.createUri"}}}),a("div",{class:"fxs-hover-card-training-sub"},a("span",{"data-bind":{text:"$data.subTitle"}}))))))))))))}));