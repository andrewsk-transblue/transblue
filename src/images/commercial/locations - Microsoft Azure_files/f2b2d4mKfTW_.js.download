define("_generated/Less/MsPortalImpl/Widgets/Widgets.GlobalNotificationBanner.css",["module"],(function(e){"use strict";return{css:".fxs-global-notification-banner-item{position:relative}.fxs-global-notification-banner-content{font-size:13px;padding:10px 20px}.fxs-global-notification-banner-title{font-size:14px;font-weight:600;margin-right:10px}.fxs-global-notification-banner-message{font-size:13px;display:block;display:-webkit-box;max-height:36px;overflow:hidden;text-overflow:ellipsis;-webkit-line-clamp:2;-webkit-box-orient:vertical;line-height:18px;position:relative;white-space:pre-wrap}.fxs-global-notification-banner-expandedmessage{max-height:100%;overflow-y:auto;-webkit-line-clamp:initial;-webkit-box-orient:vertical}.fxs-global-notification-banner-seemore-container{display:inline-block;width:100%}.fxs-notification-banner-seemore-link{display:flex;margin-top:2px;float:right}.fxs-global-notification-banner-see-more-less{padding-right:5px}.fxs-global-notification-banner-expandicon{cursor:pointer;background-color:transparent;border:0;margin:0;padding:0;height:10px;width:10px;opacity:.4}.fxs-global-notification-banner-dismissicon{cursor:pointer;background-color:transparent;border:0;margin:0;padding:0;height:14px;width:10px;opacity:.4;top:0;right:0;position:absolute;margin-left:auto}",moduleId:e.id}})),
define("MsPortalImpl/Widgets/Widgets.GlobalNotificationBanner.Component",["require","exports","MsPortalImpl/UI/UI.AuthStateManager","Weave/DirectMode","MsPortalImpl/Resources/ImplScriptResources","MsPortalImpl/Base/Base.KnockoutTemplateSanitizer","MsPortalImpl/Services/Services.PortalPollingManager","_generated/Less/MsPortalImpl/Widgets/Widgets.GlobalNotificationBanner.css","Weave","FxInternal/Weave/Util","MsPortalImpl/Weave/Components","MsPortalImpl/Base/Base.BrowserDetection","MsPortalImpl/Services/Services.BrowserTelemetry"],(function(e,i,t,n,o,a,r,s,l,c,d,f,m){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.DEV=i.GlobalNotificationBanner=void 0;var g=MsPortalFx.Base,p=g.Diagnostics.Telemetry,u=g.Images;const b=window,x={Edg:["chromiumedge","edgechromium","edge"],Edge:["legacyedge","edgelegacy","edge"],Chrome:["chrome"],Safari:["safari"],Firefox:["firefox"]};function v(e,i,t,n,o){return e.filter((e=>function(e,i){var t;return!(null===(t=null==e?void 0:e.affectedPortalDomains)||void 0===t?void 0:t.length)||e.affectedPortalDomains.includes(i)}(e,t))).filter((e=>function(e,i){var t;return!(null===(t=null==e?void 0:e.affectedTenants)||void 0===t?void 0:t.length)||e.affectedTenants.includes(i)}(e,n))).filter((e=>function(e,i,t){var n;const o=Object.keys(null!==(n=e.affectedBrowsers)&&void 0!==n?n:{}).length;if(!(null==e?void 0:e.affectedBrowsers)||!o)return!0;const a=x[i],r=e.affectedBrowsers[Object.keys(e.affectedBrowsers).find((e=>null==a?void 0:a.includes(e.toLowerCase())))];if(void 0===r&&o)return!1;if(!r||!t)return!0;if(r){const e=r.split(".").map((e=>"x"===e.toLowerCase()||isNaN(parseInt(e,10))?-1:parseInt(e,10))),i={major:e[0],minor:e[1],patch:e[2]};return i.major<0||t.major<0||i.major===t.major&&(i.minor<0||t.minor<0||i.minor===t.minor&&(i.patch<0||t.patch<0||i.patch===t.patch))}}(e,i,o)))}function h(e,i){p.trace({source:"GlobalNotificationBanner",action:e,data:i})}function w(i){const t=i.trackingId,n=(0,l.makeWritableComputation)(!1);return{expandIcon:n.compose((e=>e?u.CaretUp():u.CaretDown())),id:t,isExpanded:n,message:(0,l.makeWritableComputation)((0,a.sanitizeHTML)(i.message,e).sanitizedMarkup),onClickToggleExpandedState:()=>n(!n.value),seeMoreString:n.compose((e=>e?o.NotificationMenu.collapse:o.NotificationMenu.seeMore)),title:(0,l.makeWritableComputation)((0,a.sanitizeHTML)(i.title,e).sanitizedMarkup)}}i.GlobalNotificationBanner=function(i){var a,g,p;h("ReceiveNotifications",{notifications:i.notifications});const x=null===(a=i.container.get(t.AuthStateManager).getCurrentUser())||void 0===a?void 0:a.tenantId.toLowerCase(),M=null===(p=null===(g=null==b?void 0:b.location)||void 0===g?void 0:g.hostname)||void 0===p?void 0:p.toLowerCase(),N=f.isChrome?"Chrome":f.isEdge?"Edge":f.isChromiumEdge?"Edg":f.isFirefox?"Firefox":f.isSafari?"Safari":"Other",I=function(e,i){var t,n,o;if(i.includes(e)){const a=new RegExp(`\\s${e}/((\\d|\\.)+[\\s]|(\\d|\\.)+$)`).exec(i),r=a&&a[1]&&a[1].trim().split(".").map((e=>isNaN(parseInt(e,10))?-1:parseInt(e,10)));return(null==r?void 0:r.length)>=2?{major:null!==(t=r[0])&&void 0!==t?t:-1,minor:null!==(n=r[1])&&void 0!==n?n:-1,patch:null!==(o=r[2])&&void 0!==o?o:-1}:null}}(N,m.getBrowserInfo().UserAgent),k=(0,l.makeWritableComputation)(!1),C=(0,l.makeArrayComputation)(v(i.notifications,N,M,x,I).map(w)),B={},S={};return h("SetNotifications",{notifications:C.value}),C.value.forEach((e=>{S[e.id]=e})),n(l.GetContext,{fn:i=>n(l.LifetimeManagerScoped,{fn:t=>{const a=i.diContainer.get(r.PollingManager);return(0,l.subscribe)(t,[a.getPolledDataObservable()],(e=>{const i=function(e,i,t){if(!e||!e.length)return[];return e.reduce(((e,n)=>{const o=n.trackingId,a=i[o],r=w(n);if(a){const i=r.title.value,n=r.message.value;return a.title.value===i&&a.message.value===n||(a.title(i),a.message(n),t[o]=void 0),t[o]||e.push(a),e}return t[o]||(h("ShowGlobalNotification",{id:o}),e.push(r)),e}),[])}(v(e.outages,N,M,x,I),S,B);C.setAll(i)})),n(l.If,{condition:C.compose(c.isNonEmptyArray),concealmentBehavior:"remove",trueFn:()=>n(l.Fragment,null,n(l.Css,{css:s}),n("div",{className:"fxs-global-notification-banner-content fxs-portal-text",role:"banner"},n(l.ForEach,{collection:C,fn:({item:i})=>{const t=i.seeMoreString;return n("div",{className:"fxs-global-notification-banner-item",afterMount:e=>{const t=e.parentNode.querySelector(".fxs-global-notification-banner-message").scrollHeight>36||$(e).hasClass("fxs-global-notification-banner-expandedMessage");k(t),i.isExpanded(!t)}},n("div",{className:"fxs-global-notification-banner-title"},i.title),n("button",{className:"fxs-global-notification-banner-dismissicon",image:u.Close(),onClick:()=>function(e,i,t){i.removeIf((i=>i.id===e)),h("DismissNotification",{trackingId:e}),t[e]=!0}(i.id,C,B),tabindex:"0",title:o.NotificationMenu.dismissNotification,"aria-label":o.NotificationMenu.dismissNotification}),n("div",{className:["fxs-global-notification-banner-message msportalfx-tooltip-overflow",{"fxs-global-notification-banner-expandedmessage":i.isExpanded}]},n(d.ShellHtml,{content:i.message,require:e})),n(l.If,{condition:k,concealmentBehavior:"remove",trueFn:()=>n("div",{className:"fxs-global-notification-banner-seemore-container"},n("a",{href:"#",tabindex:"0",className:"fxs-notification-banner-seemore-link",onClick:i.onClickToggleExpandedState},n("div",{className:"fxs-global-notification-banner-see-more-less",title:t,"aria-label":t},t),n("div",{className:"fxs-global-notification-banner-expandicon",image:i.expandIcon})))}))}})))})}})})}}));