define("_generated/Less/Viva.Controls/Controls/Visualization/Viva.ChartBase.css",["module"],(function(e){"use strict";return{css:".azc-chartBase .azc-chart-axis{pointer-events:none}.azc-chartBase .azc-chart-axis .azc-chart-axis-x text,.azc-chartBase .azc-chart-axis .azc-chart-axis-y text,.azc-chartBase .azc-chart-axis .azc-chart-secondary-axis-x text,.azc-chartBase .azc-chart-axis .azc-chart-secondary-axis-y text{font-size:10px;stroke-width:0}.azc-chartBase .azc-chart-axis .azc-chart-axis-x .azc-chart-axis-caption{text-anchor:middle}.azc-chartBase .azc-chart-axis .azc-chart-axis-y .azc-chart-axis-caption{text-anchor:end}.azc-chartBase .azc-chart-axis .azc-chart-axis-x path,.azc-chartBase .azc-chart-axis .azc-chart-axis-x line{fill:none;shape-rendering:crispEdges;stroke-width:1px}.azc-chartBase .azc-chart-axis .azc-chart-axis-y path,.azc-chartBase .azc-chart-axis .azc-chart-axis-y line{fill:none;shape-rendering:crispEdges;stroke-width:1px}.azc-chartBase .azc-chart-axis .azc-chart-secondary-axis-x path,.azc-chartBase .azc-chart-axis .azc-chart-secondary-axis-x line{fill:none;shape-rendering:crispEdges;stroke-width:1px}.azc-chartBase .azc-chart-axis .azc-chart-secondary-axis-y path,.azc-chartBase .azc-chart-axis .azc-chart-secondary-axis-y line{fill:none;shape-rendering:crispEdges;stroke-width:1px}.azc-chartBase .azc-chart-axis .azc-chart-area-border-line{stroke-width:1px;stroke:#dcdfe2}.azc-chartBase .azc-chart-axis .azc-chart-axis-hidden-line path{stroke-width:0}.azc-chartBase .azc-chart-axis .azc-chart-axis-hidden-ticks .azc-chart-axis-tick-line{stroke-width:0}.azc-chartBase .azc-chart-axis .azc-chart-axis-ticks .azc-chart-axis-tick-line{stroke-width:1px}.azc-chartBase .azc-chart-background{stroke-width:0;fill-opacity:0}.azc-chartBase .azc-chart-axis-gridline{stroke-width:1px;pointer-events:none}.azc-chartBase .azc-chart-data:not(.azc-chart-noninteractive),.azc-chartBase .azc-chart-background:not(.azc-chart-noninteractive){pointer-events:all}.azc-chartBase.azc-chart-help-overlay{filter:grayscale(100%)}.azc-chartBase.azc-chart-help-overlay>*{opacity:.45}.azc-chartBase.azc-chart-help-overlay .azc-chart-help-container{opacity:.97}.azc-chartBase .azc-chart-help-content{padding:15px 10px;width:calc(100% - 40px);text-align:center;border-width:1px;border-style:solid}.azc-chartBase .azc-chart-help-content span{display:block}.azc-chartBase .azc-chart-help-container{position:absolute;z-index:100;height:100%;width:100%;display:flex;align-items:center;justify-content:center;top:0;left:0}",moduleId:e.id}})),
define("Viva.Controls/Controls/Visualization/Viva.ChartBase",["require","exports","_oss/d3","Viva.Controls/Util/Viva.ArrayUtil","Viva.Controls/Controls/Base/Viva.Base","Viva.Controls/Util/Viva.DateUtil","MsPortalFx/Globalization","MsPortalImpl/Base/Base.BrowserDetection","MsPortalImpl/Base/Base.Timers","FxInternal/Css","_generated/Less/Viva.Controls/Controls/Visualization/Viva.ChartBase.css","MsPortalImpl/Resources/ImplScriptResources"],(function(e,t,s,i,a,r,n,o,c,l,h,d){"use strict";var u;return(0,l.injectCss)(h),function(t){var l=MsPortalFx.isNullOrUndefined,h=MsPortalFx.Base.Diagnostics,u=MsPortalFx.UnitConversionUtil;const p=[],m="-0.32em",_="1.3em",x="0.8em",g="-0.8em",v="0.15em",w="-0.5em",f="azc-chartBase",S="azc-fill-default",C=".azc-chart-data",z="azc-chart-noninteractive",k=".azc-chart-axis",b="azc-chart-axis-gridline",y=".azc-chart-axis-gridline",I="azc-chart-axis-slider",V="azc-chart-axis-slider-line",A="azc-chart-axis-slider-text",M="azc-chart-help-container",D="translate({0},{1})",F=`<div role='dialog' tabindex='0' aria-label='${d.Chart.navigationHelp}' class='azc-chart-help-content fxs-popup fxs-portal-bg-txt-br msportalfx-shadow-level2'><span>${d.Chart.navigateChart}</span><span>${d.Chart.navigateSeries}</span><span>${d.Chart.navigateDatapoints}</span><span>${d.Chart.selectDatapoint}</span><span>${d.Chart.selectSeries}</span><span>${d.Chart.resetNavigation}</span><span>${d.Chart.dismissHelp}</span></div>`,L=1e3,H=60*L,B=60*H,T=24*B,P=30*T,N=365*T,U=1;let E,O,X,Y,R=0;const W=h.createLog(e);let G,j;!function(e){e[e.All=0]="All",e[e.XSlider_Off=1]="XSlider_Off",e[e.XSlider_noCallout=2]="XSlider_noCallout",e[e.ChartArea_Off=4]="ChartArea_Off",e[e.ChartArea_noClick=8]="ChartArea_noClick",e[e.ChartArea_noHover=16]="ChartArea_noHover"}(G=t.InteractionBehavior||(t.InteractionBehavior={}));class K{constructor(){this.context=ko.observable(0),this.style=ko.observable(0),this.formatter=ko.observable(null)}}t.DataLabel=K;t.CustomDataLabel=class extends K{constructor(){super(...arguments),this.chartItems=ko.observableArray(),this.context=ko.observable(5)}};class q{constructor(e,t){this.name=ko.observable(""),this.scale=ko.observable(0),this.reverseDomain=ko.observable(!1),this.ticks=ko.observable(0),this.position=ko.observable(3),this.positionIndex=ko.observable(0),this.showAxis=ko.observable(!0),this.autoScaleUnit=ko.observable(!0),this.showName=ko.observable(!1),this.showLabel=ko.observable(1),this.labelPadding=ko.observable(50),this.rotateLabel=ko.observable(0),this.showAxisLine=ko.observable(!1),this.showTickMarks=ko.observable(!1),this.showGridLines=ko.observable(!1),this.inputFormat=ko.observable(""),this.outputFormat=ko.observable(""),this.formatOptions=ko.observable(null),this.xSliderOutputFormat=ko.observable(null),this.xSliderFormatOptions=ko.observable(null),this.displayLabelFormatter=ko.observable(""),this.xSliderCalloutDisplayFormatter=ko.observable(""),this.min=ko.observable(null),this.max=ko.observable(null),this.unit=ko.observable(u.Unit.None),this.displaySIUnit=ko.observable(!1),this.defaultAxisPadding=ko.observable(null),this.customAxisPadding=ko.observable(null),this.hideAxisLabelsOnXSliderHover=ko.observable(!1),e&&this.position(e),t&&this.scale(t)}}t.Axis=q;t.DateSpan=class{constructor(e,t,s,i,a,r,n){this.years=e,this.months=t,this.days=s||0,this.hours=i||0,this.minutes=a||0,this.seconds=r||0,this.milliseconds=n||0}};t.NumberSpan=class{constructor(e){this.value=e}};class Q{constructor(){this.type=ko.observable(0),this.name=ko.observable(String(R=R+1&65535))}}t.SeriesBase=Q;t.Series=class extends Q{constructor(){super(...arguments),this.values=ko.observableArray(),this.xAxisName=ko.observable(""),this.yAxisName=ko.observable("")}};t.UniformSeries=class extends Q{constructor(){super(...arguments),this.type=ko.observable(3),this.startXValue=ko.observable(null),this.span=ko.observable(null),this.yValues=ko.observableArray(),this.xAxisName=ko.observable(""),this.yAxisName=ko.observable("")}};t.LineSeries=class extends Q{constructor(){super(...arguments),this.type=ko.observable(1),this.value=ko.observable(null),this.axisName=ko.observable("")}},function(e){function t(t,s){return new me(e.getNthXValueOfUniformSeries(t,s),t.yValues()[s])}function s(t){return e.getNthChartItemOfUniformSeries(t,t.yValues().length-1)}function i(t){return t.yValues().map(((s,i)=>e.getNthChartItemOfUniformSeries(t,i)))}function a(e,t,s,i,a){const r=new Date(e.getTime());let n=0;for(;r<=t;)r.setFullYear(r.getFullYear()+s),r.setMonth(r.getMonth()+i),r.setMilliseconds(r.getMilliseconds()+a),n++;return n}function r(e){return 1e3*(60*(60*(24*(e.days||0)+(e.hours||0))+(e.minutes||0))+(e.seconds||0))+(e.milliseconds||0)}function n(e,t){if(!e||0===e.length)return[];switch(t.context()){case 2:return[e.concat().sort(o)[0]];case 3:return[e.concat().sort(c)[0]];case 1:return[e.concat().sort(h)[0]];case 0:return[e.concat().sort(d)[0]];case 4:return e;case 5:return t.chartItems();default:return[]}}function o(e,t){const s=m(e.xValue,t.xValue);return s||m(e.yValue,t.yValue)}function c(e,t){const s=_(e.xValue,t.xValue);return s||m(e.yValue,t.yValue)}function h(e,t){const s=m(e.yValue,t.yValue);return s||m(e.xValue,t.xValue)}function d(e,t){const s=_(e.yValue,t.yValue);return s||m(e.xValue,t.xValue)}function u(e,t){return null===e&&null!==t?-1:null!==e&&null===t?1:0}function p(e,t){return e<t?-1:e>t?1:0}function m(e,t){const s=u(e,t);return s?-s:p(e,t)}function _(e,t){const s=u(e,t);return s?-s:-p(e,t)}e.getChartItemsByDataLabelAndSeries=function(e,a){switch(e.type()){case 0:return n(e.values(),a);case 3:return function(e,a){const r=e.yValues(),l=a.context();if(!r||0===r.length)return[];switch(l){case 2:case 3:return[[t(e,0),s(e)].concat().sort(2===l?o:c)[0]];default:return n(i(e),a)}}(e,a);default:return[]}},e.getNthXValueOfUniformSeries=function(e,t){const s=e.span(),i=e.startXValue();if(s){if(i instanceof Date){const e=new Date(i.getTime()),a=s;return e.setFullYear(e.getFullYear()+t*a.years),e.setMonth(e.getMonth()+t*a.months),e.setDate(e.getDate()+t*(a.days||0)),e.setHours(e.getHours()+t*(a.hours||0)),e.setMinutes(e.getMinutes()+t*(a.minutes||0)),e.setSeconds(e.getSeconds()+t*(a.seconds||0)),e.setMilliseconds(e.getMilliseconds()+t*(a.milliseconds||0)),e}if("number"==typeof i)return i+s.value*t}throw new Error("The span is not defined.")},e.createXValuesArray=function(t){const s=[];for(let i=0;i<t.yValues().length;i++)s.push(e.getNthXValueOfUniformSeries(t,i));return s},e.getLastXValueOfUniformSeries=function(t){return e.getNthXValueOfUniformSeries(t,t.yValues().length-1)},e.getNthChartItemOfUniformSeries=t,e.getLastChartItemOfUniformSeries=s,e.createChartItemArray=i,e.getCountOfValues=function(e,t){if(l(e.min)||l(e.min))return null;if("number"==typeof e.min){const s=t;if(s&&s.value)return Math.floor(Math.abs((e.max-e.min)/s.value))+1;throw new Error("NumberSpan either is not set or is set with zero value. Provide a non-zero number span.")}if(e.min instanceof Date&&e.max instanceof Date){const s=t,i=r(s);if(s){if(0===s.years&&0===s.months){if(0===i)throw new Error("DateSpan is set with zero value. Provide a non-zero date span.");return Math.floor(Math.abs((e.max.getTime()-e.min.getTime())/i))+1}if(s.years>=0&&s.months>=0&&i>=0)return a(e.min,e.max,s.years,s.months,i);if(s.years<=0&&s.months<=0&&i<=0)return a(e.max,e.min,s.years,s.months,i);throw new Error("Years, months and other parts of TimeSpan should be all non-negative or all non-positive.")}throw new Error("DateSpan is not set. Provide a non-zero date span.")}},e.areEqualSpans=function(e,t){if(l(e)&&l(t))return!0;if(!l(e))return e.value===t.value;if(!l(e)){const s=e,i=t;return r(s)===r(i)&&s.years===i.years&&s.months===i.months}throw new Error("Span Type is undefined. Cannot perform Spans comparison.")},e.isXValueSortable=function(e){if(0===e.type()){const t=e.values();return!(t&&t.length>0&&"string"==typeof t[0].xValue)}return!1},e.getChartItemArrayBySeriesBase=function(t,s=!1){switch(t.type()){case 0:{const i=t.values()||[],a=i[0]&&"string"==typeof i[0].xValue,r=i.slice();return a||s?r:MsPortalFx.stableSort(r,e._chartItemComparerByX)}case 3:{const s=t;return e.createChartItemArray(s)}}return[]},e.getAxisName=function(e,t){const s=("x"===t?"x":"y")+"AxisName",i=e.type();return e[1===i||2===i?"axisName":s]()},e._chartItemComparerByX=function(e,t){return e.xValue<t.xValue?-1:e.xValue>t.xValue?1:0}}(j=t.SeriesUtilities||(t.SeriesUtilities={}));class J{constructor(){this.chartViewIndex=ko.observable(null),this.seriesViewIndex=ko.observable(null)}}t.SeriesId=J;t.SeriesSubset=class extends J{constructor(){super(...arguments),this.seriesIndex=ko.observable(null),this.chartItems=ko.observableArray()}};class Z{}t.Events=Z;class ee{}t.SeriesChartEvents=ee;class te{}t.BarChartEvents=te;t.RenderingCondition=class{constructor(){this.seriesName=ko.observable(""),this.conditionOperator=ko.observable(null),this.interpolation=ko.observable(0)}};class se{constructor(){this.seriesName=ko.observable(""),this.displayName=ko.observable(""),this.cssClass=ko.observable(""),this.dataLabels=ko.observableArray(),this.showTooltip=ko.observable(!1),this.tooltipFormatter=ko.observable("Series: '{0}' Point: {1} Value: {2}"),this.renderingConditions=ko.observableArray(),this.selectable=ko.observable(!0),this.hoverable=ko.observable(!0),this.hideFromLegend=ko.observable(!1)}}t.SeriesView=se;class ie extends se{constructor(){super(...arguments),this.interpolation=ko.observable(0),this.lineStyle=ko.observable(0),this.showTooltip=ko.observable(!1),this.showDataPoints=ko.observable(!0)}}t.LineChartSeriesView=ie;class ae extends se{constructor(){super(...arguments),this.interpolation=ko.observable(0),this.areaHatchingPattern=ko.observable(0),this.showTooltip=ko.observable(!1)}}t.AreaChartSeriesView=ae;class re extends ae{}t.StackedAreaChartSeriesView=re;class ne extends se{constructor(){super(...arguments),this.radius=ko.observable(3),this.showTooltip=ko.observable(!1)}}t.ScatterChartSeriesView=ne;const oe={};function ce(e,t){oe[Number(e)]=t}function le(e){return function(t){const s=oe[Number(e.chartType())]();return t&&s.seriesName(t.name()),s}}class he{constructor(){this.chartType=ko.observable(0),this.seriesView=ko.observableArray(),this.createDefaultSeriesView=le(this)}}t.View=he;t.LineChartView=class extends he{constructor(){super(...arguments),this.seriesView=ko.observableArray(),this.events=new ee,this.createDefaultSeriesView=le(this)}},ce(0,(function(){return new ie}));t.AreaChartView=class extends he{constructor(){super(...arguments),this.chartType=ko.observable(1),this.seriesView=ko.observableArray(),this.events=new ee,this.createDefaultSeriesView=le(this)}},ce(1,(function(){return new ae}));t.ScatterChartView=class extends he{constructor(){super(...arguments),this.chartType=ko.observable(2),this.seriesView=ko.observableArray(),this.events=new ee,this.createDefaultSeriesView=le(this)}},ce(2,(function(){return new ne}));class de extends he{constructor(){super(...arguments),this.enableSparseSeries=ko.observable(!0)}}t.StackedChartView=de;function ue(e){const t=e&&e.getElementsByTagName("text")[0];if(t&&t instanceof SVGTextElement)return t}t.BarChartView=class extends de{constructor(e){switch(super(),this.barPaddingRatio=ko.observable(.3),this.barChartType=ko.observable(0),this.xAxisSpan=ko.observable(null),this.events=new te,this.createDefaultSeriesView=le(this),this.barChartType(e),e){case 0:this.chartType(3);break;case 1:this.chartType(4);break;case 2:this.chartType(5)}}},ce(3,(function(){return new se})),ce(4,(function(){return new se})),ce(5,(function(){return new se}));const pe=o.isIeOrEdgeNonChromium?e=>{let t=1;try{t=e&&e.getComputedTextLength()}catch(e){}return t}:e=>e&&e.getComputedTextLength()||1;t.StackedAreaChartView=class extends de{constructor(){super(...arguments),this.chartType=ko.observable(6),this.seriesView=ko.observableArray(),this.events=new ee,this.lineState=ko.observable(0),this.createDefaultSeriesView=le(this)}},ce(6,(function(){return new re}));class me{constructor(e,t){this.xValue=e,this.yValue=t}}t.ChartItem=me;t.StackedChartItem=class extends me{constructor(e,t,s){super(e,t),this.y0=s}};class _e extends a.ViewModel{constructor(e){super(e),this.title=ko.observable(""),this.showTitle=ko.observable(!1),this.width=ko.observable(0),this.height=ko.observable(0),this.noDataMessage="",this.noData=ko.observable(!1),this.series=ko.observableArray(),this.xAxis=new q,this.yAxis=new q(4,1),this.secondaryXAxes=ko.observableArray(),this.secondaryYAxes=ko.observableArray(),this.views=ko.observableArray(),this.legendPosition=ko.observable(0),this.interactionBehavior=ko.observable(G.All),this.autogenerateSeriesViews=ko.observable(!0),this.events=new Z,this.seriesSelections=ko.observableArray(),this.seriesHovers=ko.observableArray(),this.hoveredID=ko.observableArray(),this.enableTrackXSlider=ko.observable(),this.disableXSliderMouseout=ko.observable(),this.xSliderCoordinate=ko.observable(),this._xSliderTickColorClass=ko.observable(),this.xSliderFilterHoverThreshold=ko.observable(),this.ariaLabel=ko.observable(""),this.ariaDesc=ko.observable(""),this._seriesHelpers=ko.observable(),this.xAxis.showTickMarks(!0)}}t.ViewModel=_e,p[0]="none",p[1]="top",p[2]="right",p[3]="bottom",p[4]="left";class xe{constructor(){this.min=null,this.max=null}}t.Extent=xe;class ge{constructor(){this.tickCount=0,this.tickPadding=0,this.tickMarkSize=0,this.showAxisLabel=!1}}t.Ticks=ge;function ve(e){let t;const s=e.getAttribute("transform")||"",i=/translate\(\s*([^\s,)]+)/.exec(s);return i&&i.length>1&&(t=parseFloat(i[1])),t}t.ScreenCoordinates=class{},t.getSVGxCoordinateValue=ve;class we{constructor(e,t,i,a,r,n,o,c,l){this.internalMin=ko.observable(null),this.internalMax=ko.observable(null),this.xAxisTickAdjustmentFeatureFlag=ko.observable(!0),this._getAxisScreenCTM=MsPortalFx.memoize((()=>{const e=this.currentAxis();if(e){const t=e.node();if(t)return t.getScreenCTM()}})),this._lifetime=e.createChildLifetime(),this._element=t,this._axisElement=s.select(t[0]).select(k),this._axisType=c,this._translateHandler=r,this._dateParser=null,this._numericParser=null,this._sliderCoordinate=l||ko.observable(),this._initializeComputed2(i,a,n,o),this._sliderTickColorClass=ko.observable()}dispose(){this._lifetime.dispose(),this.currentAxis&&this.currentAxis()&&this.currentAxis().remove()}extractValue(e){let t;return t=this._dateParser?this._dateParser(e):this._numericParser?this._numericParser(e):e,t}getPointFormatter(e){const t=this.mappedAxis(),s=t.scale(),i=s.range()[1]-s.range()[0],a=s.domain()[1]-s.domain()[0],r=Math.abs(a/i);let o;const c=e||t.tickFormat()||s.tickFormat();return s.domain()[1]instanceof Date?e=>c(we._getDateRoundingFunction(20*r)(e)):e||(o=-Math.floor(Math.log(r)/Math.log(10)),o=o>0&&o!==1/0?o:0,e=>n.NumberFormat.create({minimumFractionDigits:0,maximumFractionDigits:o}).format(e))}checkForUpdate(){this._extent(),this._reverseDomain()}getAxisType(){return this._axisType}static _checkSeriesViewsReferSeries(e,t){return!!MsPortalFx.find(t,(t=>t.seriesName()===e))}static _getD3TimeRoundFunction(e){return t=>{const s=t.getTimezoneOffset()*H;return new Date(Math.floor((t.getTime()-s)/e)*e+s)}}static _getD3RoundFunctionObject(e){return{limit:e,func:we._getD3TimeRoundFunction(e)}}static get _d3DateIndexLookUp(){return O||(O=[function(e){return!!e.getMilliseconds()},function(e){return!!e.getSeconds()},function(e){return!!e.getMinutes()},function(e){return!!e.getHours()},function(e){return e.getDay()&&1!==e.getDate()},function(e){return 1!==e.getDate()},function(e){return!!e.getMonth()},function(e){return!0}]),O}static _getDateFormatingIndex(e){const t=we._d3DateIndexLookUp;let s=0;for(;s<t.length;){if(t[s](e))return s;s++}return s-1}static get _globalizedDateTimeFormatOptionsForD3DefaultFormat(){return X||(X=[{second:"2-digit"},{second:"2-digit"},{hour:"numeric",minute:"2-digit"},{hour:"numeric"},{month:"short",day:"numeric"},{month:"short",day:"numeric"},{month:"long"},{year:"numeric"}]),X}static get _globalizedDateTimeFormattersForD3DefaultFormat(){if(!Y){Y=[];for(let e=0;e<we._globalizedDateTimeFormatOptionsForD3DefaultFormat.length;e++)Y.push(n.DateTimeFormat.create(we._globalizedDateTimeFormatOptionsForD3DefaultFormat[e]))}return Y}static _getGlobalizedDateValueForD3Defaults(e){const t=we._getDateFormatingIndex(e);if(0===t)return s.time.format(".%L")(e);if(-1!==t){let i,a="";try{i=we._globalizedDateTimeFormattersForD3DefaultFormat[t],a=i.format(e)}catch(t){W.error("Intl failure. Given format: {0}; Date: {1}; Exception: {2}".format(i,e.toString(),t)),a=s.time.format(".%L")(e)}return a}return null}static _getDateRoundingFunction(e){E||(E=[{limit:N,func:function(e){return new Date(e.getFullYear(),1)}},{limit:P,func:function(e){return new Date(e.getFullYear(),e.getMonth())}}],[T,B,H,L,U].forEach((e=>{E.push(we._getD3RoundFunctionObject(e))})));let t=0;for(t=E.length-1;t>0;t--){if(e<E[t-1].limit)break}return E[t].func}_createGridLine(e){const t=this.axisPosition();if(4===t||2===t){const t=this._element[0].style.width,s=t&&parseInt(t)||this._element.width();return{class:b,x1:-e.x,y1:0,x2:s-e.x,y2:0}}if(1===t||3===t)return{class:b,x1:0,y1:0,x2:0,y2:-e.y}}_checkSeriesIsDisplayedByChartTypes(e,t,s){return!!MsPortalFx.find(s.views(),(s=>{const i=s.chartType(),a=s.seriesView();return t.indexOf(i)>=0&&(null===a||0===a.length||we._checkSeriesViewsReferSeries(e,a))}))}_hasBarChartViews(){return this._barChartViews().length>0}_hasScatterChartViews(){return this._scatterChartViews().length>0}_getPositionBaseTranslateString(e,t){return this._isHorizontal()?D.format(e,t):D.format(t,e)}static _getCurrentTicks(e){let t;return e?(t=e.selectAll("g.tick"),t):null}getAxisLabelValue(e){const t=this.getAxisValue(e);return{value:t,label:this._formatAxisValue(t)}}getAxisValue(e){const t=function(e,t,s){let i=null;return t&&(i=0===e||2===e?s/t.a-t.e:s/t.d-t.f),i}(this._axisType,this._getAxisScreenCTM(),e);return null===t?null:this._getAxisValue(t)}getScreenCoordinate(e){let t=null;if(0!==this.axisScaleType())t=this.mappedAxis().scale()(e);else{const s=i.binarySearch(this.mappedAxis().scale().domain(),e);t=this.mappedAxis().scale().range()[s]}return function(e,t,s){let i=null;return t&&(i=0===e||2===e?s*t.a+t.e:s*t.d+t.f),i}(this._axisType,this._getAxisScreenCTM(),t)}_getAxisValue(e){let t=null;if(0!==this.axisScaleType()){const s=this.mappedAxis&&this.mappedAxis(),i=s&&s.scale&&s.scale(),a=i&&i.invert;if(a)t=a(e);else{const e=this._lifetime&&this._lifetime.isDisposed();W.warning("Tracking invert is not a function error. MappedAxis initialized = {0}, MappedAxis = {1}, scale observable = {2}, scale value = {3}, invert function = {4}, Scale = {5}, isDisposed = {6}".format(!!this.mappedAxis,!!s,!!s.scale,!!i,!!a,this.axisScaleType(),e))}}else{const s=this.mappedAxis().scale(),a=s.range(),r=s.domain();let n=i.binarySearch(a,e);n<0&&(n=~n),0<n&&n<a.length&&Math.abs(e-a[n-1])<Math.abs(e-a[n])&&n--,r.length>0&&(t=0===n?r[0]:n===a.length?r[r.length-1]:r[n])}return"number"==typeof t&&(t=Number(s.format(".2f")(t))),t}_formatAxisValue(e){let t="";if(0!==this.axisScaleType()){const s=this._xSliderOutputFormatter();t=this.getPointFormatter(s)(e)}else t=e;return t}_sliderAxisValue(e){const t=this._getAxisValue(e);return this._formatAxisValue(t)}_initializeComputed2(e,t,a,o){const h=this._lifetime;this.axisPosition=ko.computed(h,(()=>o.position())),this._isHorizontal=ko.computed(h,(()=>this.axisPosition()%2==1)),this.axisScaleType=ko.computed(h,(()=>{switch(o.scale()){case 1:default:break;case 0:case 2:o.inputFormat()&&(this._dateParser=s.time.format(o.inputFormat()).parse)}return o.scale()})),this._translate=ko.computed(h,(()=>this._translateHandler(o))),this._barChartViews=ko.computed(h,(()=>a.views().filter((e=>{const t=e.chartType();return 4===t||5===t||3===t})))),this._scatterChartViews=ko.computed(h,(()=>a.views().filter((e=>2===e.chartType())))),this._lineChartViews=ko.computed(h,(()=>a.views().filter((e=>0===e.chartType())))),this._maxScatterChartRadius=ko.computed(h,(()=>this._hasScatterChartViews()?s.max(this._scatterChartViews(),(e=>e.seriesView().length>0?s.max(e.seriesView(),(e=>e.radius())):3)):0)),this.ticks=ko.computed(h,(()=>{const e=new ge;return e.tickCount=o.ticks(),e.tickMarkSize=o.showTickMarks()?4:0,e.showAxisLabel=!!o.showLabel(),e})),this.series=ko.computed(h,(()=>{const e=this._axisType,t=0===e||2===e?"x":"y",s=0===e||1===e;return(a.series()||[]).filter((e=>{const i=j.getAxisName(e,t);return!i&&s||i===o.name()}))})),this._domain=ko.computed(h,(()=>{const e=[];this.series();const t=this._axisType;return this.series().forEach((s=>{let i;switch(s.type()){case 0:{const e=s.values();e&&(i=e.map((e=>0===t||2===t?e.xValue:e.yValue)));break}case 3:{const e=s;i=0===t||2===t?j.createXValuesArray(e):e.yValues();break}case 1:1!==t&&3!==t||(i=[s.value()]);break;case 2:0!==t&&2!==t||(i=[s.value()])}$.merge(e,i||[])})),e})),this._extent=ko.computed(h,(()=>{const e=new xe;let t=!1,s=!1;const i=o.min(),r=o.max(),n=this._domain();return l(i)||(e.min=this.extractValue(i),t=!0),l(r)||(e.max=this.extractValue(r),s=!0),t&&s||(this.series().forEach((t=>{const s=t.type();0!==s&&3!==s||(1===this._axisType||3===this._axisType)&&(null===e.min||e.min>0)&&this._checkSeriesIsDisplayedByChartTypes(t.name(),[4,5,3],a)&&(e.min=0)})),n.forEach((i=>{const a=this.extractValue(i);null!==a&&(!t&&(null===e.min||e.min>a)&&(e.min=a),!s&&(null===e.max||e.max<a)&&(e.max=a))}))),e})),this._filteredDomain=ko.computed(h,(()=>{const e=this._extent();return this._domain().filter((t=>{const s=this.extractValue(t);return s>=e.min&&s<=e.max}))})),this.step=ko.computed(h,(()=>{if(1===this._axisType||3===this._axisType)return null;let i=null;if(0!==o.scale()){const e=this._barChartViews();if(e.length>0){const t=e.map((e=>e.xAxisSpan()));if(t.length>1){let e;for(e=1;e<t.length;e++)if(!j.areEqualSpans(t[0],t[e]))throw new Error("If multiple BarChartViews are assigned to an Axis, all BarChartViews must have the same xAxisSpan (null is the possible value).")}l(t[0])||(i=j.getCountOfValues(this._extent(),t[0])+1)}}return l(i)&&(i=Math.max(1,s.set(this._filteredDomain()).values().length)),i+=2,1===o.position()||3===o.position()?e()/i:t()/i})),this._internalExtent=ko.computed(h,(()=>{let e,t;const i=this._extent().min,r=this._extent().max,n=this.internalMin(),c=this.internalMax(),h=o.min(),d=o.max(),p=new xe;this._hasBarChartViews();const m=this.series().some((e=>this._checkSeriesIsDisplayedByChartTypes(e.name(),[3,6],a)));return t=l(d)&&m&&null!==c?s.max([c,r]):r,e=l(h)&&m&&null!==n?s.min([n,i]):i,1!==this._axisType&&3!==this._axisType||"number"!=typeof t||e===t&&(t>0?t<=100&&o.unit()===u.Unit.Percentage?(e=0,t=100):(e=0,t*=2):t<0?(e*=2,t=0):(e=0,t=100)),p.min=e,p.max=t,p})),this._defaultAxisPadding=ko.computed(h,(()=>{const e=this._hasBarChartViews(),t=this._hasScatterChartViews(),s=this._lineChartViews().length>0,i=this.step(),a=this._maxScatterChartRadius();let r=0;if(0===this._axisType||2===this._axisType){const n=e?1.2:.5,o=e?i*n/2:0,c=t?a+5:0,l=s?7:0;r=Math.max(o,c),r=Math.max(r,l)}return o.defaultAxisPadding(r),r})),this.padding=ko.computed(h,(()=>{const e=o.customAxisPadding();return MsPortalFx.notNullOrUndefined(e)?e:this._defaultAxisPadding()})),this._range=ko.computed(h,(()=>{let s;const i=o.position(),a=this.padding();return this._translate(),s=1===i||3===i?[a,e()-a]:[t()-a,15+a],s})),this.originalUnit=o.unit,this._convertedUnit=ko.computed(h,(()=>{const e=o.autoScaleUnit||!0,t=o.unit();if(ko.unwrap(e)){const e=this._internalExtent(),s=Math.max(Math.abs(e.min),Math.abs(e.max));return u.getAppropriateUnit(s,t)}return t})),this.conversionFactor=ko.computed(h,(()=>u.getConversionFactor(o.unit(),this._convertedUnit()))),this.multiFormatDateTimeFormatOptions=ko.computed(h,(()=>{if(2===o.scale()){const e=o.formatOptions();if(e&&Array.isArray(e)){const t=e;if(t.length>0&&MsPortalFx.findIndex(t,(e=>!!e))>=0)return t}}})),this._numberFormatter=ko.computed(h,(()=>{const e=o.scale(),t=(1===e||3===e)&&o.formatOptions()||{minimumFractionDigits:0,maximumFractionDigits:2};return n.NumberFormat.create(t)})),this._dateTimeFormatter=ko.computed(h,(()=>{if(2===o.scale()){const e=o.formatOptions();if(e&&!Array.isArray(e))return n.DateTimeFormat.create(e)}})),this._multiFormatDateFormatters=ko.computed(h,(()=>{if(this.multiFormatDateTimeFormatOptions())return this._getGlobalizedDateFormatterFunctions(this.multiFormatDateTimeFormatOptions())})),this._xSliderNumberFormatter=ko.computed(h,(()=>{const e=o.xSliderFormatOptions();return e&&1===o.scale()?n.NumberFormat.create(e):this._numberFormatter()})),this._axisLabelFormatter=ko.computed(h,(()=>e=>{let t=e;if(!l(e))if(e instanceof Date)if(this._multiFormatDateFormatters()){const s=we._getDateFormatingIndex(e);t=this._multiFormatDateFormatters()[s].format(e)}else t=this._dateTimeFormatter()?this._dateTimeFormatter().format(e):we._getGlobalizedDateValueForD3Defaults(e);else"number"==typeof e&&(t=this._numberFormatter().format(e));return t})),this._reverseDomain=ko.pureComputed((()=>!!o.reverseDomain&&o.reverseDomain())),this.valueScale=ko.computed(h,(()=>{let i,a=this._range();const r=this._internalExtent();let n=r.min,c=r.max;const l=o.position();let h;const d=this._hasBarChartViews()?1.2:.5;switch(this._reverseDomain()&&(n=r.max,c=r.min),o.scale()){case 0:a=1===l||3===l?[0,e()]:[t(),0],h=this._filteredDomain(),i=s.scale.ordinal().domain(h).rangePoints(a,d);break;case 2:i=s.time.scale().domain([n,c]).range(a);break;default:if(i=s.scale.linear(),1===this._axisType||3===this._axisType){const e=this.conversionFactor();let t=n/e;const a=c/e;3===o.scale()&&(t=Math.max(.1,t),i=s.scale.log().clamp(!0)),i.domain([t,a]).nice(o.ticks()||10)}else i.domain([n,c]);i.range(a)}return i})),this.mappedAxis=ko.computed(h,(()=>{const e=s.svg.axis().scale(this.valueScale()).orient(p[o.position()]);o.showTickMarks&&e.tickSize(this.ticks().tickMarkSize),this.ticks().tickCount>0&&(e.ticks(this.ticks().tickCount),0===o.scale()&&e.tickValues(this._domain().filter(((e,t)=>t%Math.max(1,Math.round(this._domain().length/this.ticks().tickCount))==0))));const t=ko.unwrap(o.displaySIUnit),i=u.toString(this._convertedUnit(),t),a=o.outputFormat(),n=o.displayLabelFormatter();return e.tickFormat((e=>{if(!l(e)){let t=a?e instanceof Date?r.toString(e,a):a.format(e):this._axisLabelFormatter()(e);return t+=i,n?n.format(t):t}})),e}));let d=null;this.currentAxis=ko.computed(h,(()=>{let e;const t=this._translate(),s=D.format(t.x,t.y);if(this._getAxisScreenCTM.clear(),o.showAxis()||o.hideAxisLabelsOnXSliderHover()){switch(this._axisType){case 0:e="azc-chart-axis-x";break;case 1:e="azc-chart-axis-y";break;case 2:e="azc-chart-secondary-axis-x";break;case 3:e="azc-chart-secondary-axis-y"}o.showAxisLine()||(e+=" azc-chart-axis-hidden-line"),e=e+" "+(o.showTickMarks()?"azc-chart-axis-ticks":"azc-chart-axis-hidden-ticks"),d||(d=this._axisElement.append("g")),d.attr({class:e,transform:s}).call(this.mappedAxis());const i=we._getCurrentTicks(d);if(i.length>0){i.selectAll("line:not(.azc-chart-axis-gridline)").attr("class","azc-chart-axis-tick-line");let e=i.selectAll("line"+y);o.showGridLines()?c.requestAnimationFrame((()=>{e=i.selectAll("line"+y);const s=this._createGridLine(t);e.data([0]).enter().append("line").attr(s),e.attr(s)})):e.remove(),!o.showAxis()&&o.hideAxisLabelsOnXSliderHover()?i.selectAll("text").style("display","none"):i.selectAll("text").style("display",null)}}else d&&(d.remove(),d=null);return d})),this.currentAxis.extend({rateLimit:30}),this.hasAxis=ko.computed(h,(()=>!!this.currentAxis())),this._xSliderOutputFormatter=ko.computed(h,(()=>{const e=o.xSliderOutputFormat(),t=o.xSliderFormatOptions();let i;const a=o.xSliderCalloutDisplayFormatter(),r=ko.unwrap(o.displaySIUnit),n=u.toString(this._convertedUnit(),r),c=this;let l,h,d;if(e&&e.length>0&&MsPortalFx.findIndex(e,(e=>!!e))>=0)d=e[0]&&s.format(e[0]),h=this._getDateFormatterFunctions(e,a,n),l=function(e){if(e instanceof Date){const t=e,s=we._getDateFormatingIndex(t);return h[s](e)}return d(e)};else if(t){if(Array.isArray(t)){const e=t;e.length>0&&MsPortalFx.findIndex(e,(e=>!!e))>=0&&(i=this._getGlobalizedDateFormatterFunctions(e))}l=function(e){let t;if(e instanceof Date){const s=we._getDateFormatingIndex(e);t=i?i[s].format(e):we._getGlobalizedDateValueForD3Defaults(e)}else t="number"==typeof e?c._xSliderNumberFormatter().format(e):e;return a?a.format(t):t+n}}return l}));let f,S,C=null;this.currentSlider=ko.computed(h,(()=>{let e=!1;const t=this.currentAxis();let s,i;const r=this.axisPosition()/2==0?1:-1,n=!(a.interactionBehavior()&G.XSlider_Off);if(null!==t&&this.ticks().showAxisLabel&&n){const e=this._sliderCoordinate();if(C||(C=t.append("g"),C.attr("class",[I].join(" "))),l(e))C.style("display","none");else{s=this.mappedAxis(),C.style("display",null).attr({transform:this._getPositionBaseTranslateString(e,0)}),f?f.attr("class",[V,"azc-chart-axis-tick-line",this._sliderTickColorClass()].join(" ")):f=C.append("line").attr({class:[V,"azc-chart-axis-tick-line",this._sliderTickColorClass()].join(" "),x1:0,y1:0});const t=this._sliderTickColorClass()?2:1,a=this.ticks().tickMarkSize,n=this._isHorizontal();if(f.attr({x2:n?0:r*a,y2:n?-1*r*a*t:0}),!S){const e=[0,r*(n?-1:1)*(a+s.tickPadding())];n||e.reverse(),S=C.append("text").attr({class:A,x:e[0],y:e[1]})}i=this._sliderAxisValue(e),S.text(i)}}else e=!0;return e&&(C&&C.remove(),C=null,f=null,S=null),C})),this._rotateAttributes=ko.computed(h,(()=>{let e="0",t="0",s="end";const i=o.rotateLabel(),a=o.position(),r=e=>"rotate({0})".format(o.rotateLabel());if(this.ticks.peek().showAxisLabel){switch(a){case 4:0===i?(s="end",e="-3px",t=m):-90===i||270===i?(s="middle",e="0.5em",t=g):(s="end",e=v,t=g);break;case 2:0===i?(s="start",e="0",t=m):-90===i||270===i?(s="middle",e=w,t="1.6em"):(s="start",t=x,e="-0.15em");break;case 3:0===i?(s="middle",e="0",t=_):-90===i||270===i?(e=g,t=w):(e=g,t=v);break;case 1:s="start",0===i?(s="middle",e="0",t="-0.32em"):-90===i||270===i?(e=x,t=_):(e=x,t=v)}return{attr:{dx:e,dy:t,transform:r},style:{textAnchor:s}}}return null})),this.currentTicks=ko.computed(h,[this.currentAxis,this.ticks],we._getCurrentTicks);const z=c.debounce(h,c.throttleByAnimationFrame((()=>{if(h.isDisposed())return;const t=this.currentTicks();we._adjustXAxisTicks(e()-this.padding(),o,t,this._axisElement[0][0])})),100);ko.reactor(h,(()=>{let e;const t=this._rotateAttributes();t&&(e=this.currentTicks(),e&&e.selectAll("text").style("text-anchor",t.style.textAnchor).attr(t.attr)),this.ticks.peek().showAxisLabel&&this.xAxisTickAdjustmentFeatureFlag()&&(e=e||this.currentTicks(),e&&e.selectAll("text").classed("fxs-display-none",!1),z())})),this.currentSliderText=ko.computed(h,(()=>{const e=this._rotateAttributes(),t=this.currentSlider();let s;e&&t&&(s=t.selectAll("."+A),s.style("text-anchor",e.style.textAnchor).attr(e.attr))})),this._ticksCoordinateMap=ko.computed(h,(()=>{const e=this.currentTicks();let t;const s=this.mappedAxis().scale();return e?(t=e.data(),t.map((function(t,i){return{coordinate:s(t),selection:e[0][i]}})).sort((function(e,t){return e.coordinate-t.coordinate}))):null}));let k=[];ko.computed(h,(()=>{const e=this._ticksCoordinateMap(),t=this._sliderCoordinate();if(!0===ko.unwrap(o.hideAxisLabelsOnXSliderHover))e&&e.forEach(((e,s)=>{const i=$(e.selection).find(">text")[0];l(t)?i.style.opacity=null:i.style.opacity="0"}));else if(l(t)||!e||0===e.length)k.length&&(k.forEach((e=>{e.style.opacity=null,e=null})),k=[]);else{let s=i.binarySearch(e,{coordinate:t,selection:null},((e,t)=>e.coordinate-t.coordinate));s<0&&(s=~s),this.mappedAxis();let a=1;e.forEach(((e,t)=>{const i=$(e.selection).find(">text")[0];t===s||s-1===t||s-2===t||s+1===t||s+2===t?(t===s?a=0:s-1===t||s+1===t?a=.2:s-2!==t&&s+2!==t||(a=.5),k.push(i),i.style.opacity=1!==a?a.toString():null):i.style.opacity=null}))}}))}_getDateFormatterFunctions(e,t,s){const i={};let a=MsPortalFx.findIndex(e,(e=>!!e)),n=null;return we._d3DateIndexLookUp.map(((o,c)=>{let l=a;for(;c>l&&n!==a;){const t=MsPortalFx.findIndex(e,(e=>!!e),a+1);l=t<0?n=a:a=t}const h=e[l];return i[h]||(i[h]=function(e){const i=r.toString(e,h);return t?t.format(i):i+s}),i[h]}))}_getGlobalizedDateFormatterFunctions(e){let t=MsPortalFx.findIndex(e,(e=>!!e)),s=null;return we._d3DateIndexLookUp.map(((i,a)=>{let r=t;for(;a>r&&s!==t;){const i=MsPortalFx.findIndex(e,(e=>!!e),t+1);r=i<0?s=t:t=i}const o=e[r];return n.DateTimeFormat.create(o)}))}static _adjustXAxisTicks(e,t,s,i){const a=[];if(null!==s&&0===t.rotateLabel.peek()&&(3===t.position.peek()||1===t.position.peek())&&(s[0].forEach(((e,t)=>{const s=ve(e);if($.contains(i,e)){const i=ue(e),r=pe(i),n=Math.ceil(s-r/2),o=Math.ceil(s+r/2);a.push({left:n,right:o,index:t})}return e})),a.length>1)){const t=2;let i=!1,r=0,n=1;for(a.sort(((e,t)=>e.left-t.left));n<a.length;){let o=!0;const c=a[r],l=a[n];if(l.left-c.right-t>0&&!i)if(l.right>e){const a=l.right-e;if(l.left-c.right-t>a){$(ue(s[0][l.index])).attr("x",-((l.right-l.left)/2+a)+"").css("text-anchor","start"),r=n,i=!0}else o=!1}else r=n;else o=!1;$(ue(s[0][l.index])).toggleClass("fxs-display-none",!o),++n}}}}t.AxisWrapper=we;class fe extends a.Widget{constructor(e,t,i){(i=i||{}).viewModelType=i.viewModelType||_e,super(e,t,i),this._sizeUpdateCounter=0,this._dataUpdateCounter=0,this._mappedXAxisIndex=[],this._mappedYAxisIndex=[],this._seriesLiveData=ko.observable(null),this._chartItemLiveData=ko.observable(null),this._ariaLabel=t.ariaLabel,this._descId=ko.observable(`${MsPortalFx.getUniqueId()}-chart`),this._showHelp=ko.observable(!1),this.element.addClass(f).addClass(S).html("<div class='fxs-hide-accessible-label' aria-hidden='true' data-bind='attr:{id: $ctl._descId}, text:$ctl._ariaDesc'></div><div class='azc-chart-series-live fxs-hide-accessible-label' role='status' aria-live='off' aria-relevant='additions' aria-atomic='true' data-bind='text: $ctl._seriesLiveData'></div><div class='azc-chart-item-live fxs-hide-accessible-label' role='status' aria-live='off' aria-relevant='additions' aria-atomic='true' data-bind='text: $ctl._chartItemLiveData'></div><svg focusable='false' xmlns='http://www.w3.org/2000/svg' class='azc-chart-canvas' aria-hidden='true' data-bind='attr: { width: data.width, height: data.height }'><g class='azc-chart-background'><rect class='azc-chart-background-full' data-bind='attr: { width: data.width, height: data.height }' /></g><g class='azc-chart-axis'></g><svg focusable='false' class='azc-chart-plotArea' data-bind='attr: { width: data.width, height: data.height }' preserveAspectRatio='none'><g class='azc-chart-data'></g></svg><line class='azc-chart-area-border-line' data-bind='attr: { x1: 0, y1: 0, x2: data.width, y2: 0 }' /><line class='azc-chart-area-border-line' data-bind='attr: { x1: 0, y1: $ctl._height, x2: data.width, y2: $ctl._height }' /></svg>"),this.options.width()&&this.options.height()||(this.options.width(this.element.width()),this.options.height(this.element.height())),ko.reactor(this.ltm,(()=>{if(this.element.toggleClass("azc-chart-help-overlay",this._showHelp()),this._showHelp()){this.element.findByClassName(M).remove();const e=$(FxImpl.createElement("div",{class:M,trustedInnerHTML:F}));this.element.prepend(e),setTimeout((()=>{this.element.findByClassName("azc-chart-help-content").focus()}),0)}else this.element.findByClassName(M).remove(),this.element.focus()})),this._initializeComputed2(),this._initializeSubscriptions(this.options),this._bindDescendants(),this.element.attr("aria-describedby",this._descId()),this._widgetSvg=s.select(this.element[0]).select(".azc-chart-canvas"),this._chartSvg=this._widgetSvg.select(C).attr("transform",this._chartDataClassTransform()).on("mouseover",(()=>{this._plotAreaMouseEnter()})).on("mouseout",(()=>{this._plotAreaMouseLeave()})).on("mousemove",(()=>{this._plotAreaMouseMove()})).on("click",(()=>{this._plotAreaClick()})),this._backgroundSvg=this._widgetSvg.select(".azc-chart-background").on("mousemove",(()=>{this._mouseMoveHandler()})).on("mouseleave",(()=>{const e=s.event;this._mouseOutHandler(e)})),this._axisElement=this._widgetSvg.select(k),ko.computed(this.ltm,(()=>{const e=this.options.interactionBehavior();this._chartSvg.classed(z,e&G.ChartArea_Off),this._backgroundSvg.classed(z,!this._xSliderOn())}))}dispose(){this._checkExistsOrRegisterDestroyId(super.dispose)||(super.dispose(),this._chartSvg=this._widgetSvg.select(C).on("mouseover",null).on("mouseout",null).on("click",null),this._cleanElement(f,S))}getAxisInfoProvider(e){let t=null;switch(e){case 0:t=this._xAxes()[0];break;case 2:t=this._xAxes()[1];break;case 1:t=this._yAxes()[0];break;case 3:t=this._yAxes()[1]}return t}get options(){return this._options}_mouseMoveHandler(){}_mouseOutHandler(e){}_initializeSubscriptions(e){super._initializeSubscriptions(e);const t=this.subLifetime;this._chartDataUpdated&&this._chartDataUpdated.subscribe(t,(e=>{this._onChartDataUpdated()})),this._chartSizeUpdated&&this._chartSizeUpdated.subscribe(t,(e=>{this._onChartSizeUpdated()}))}get _getXSliderCoordinate(){return this.options.xSliderCoordinate}_checkForChartUpdate(){const e=this.options.series(),t=e&&e.length||0;for(let s=0;s<t;s++){const t=e[s];switch(t.type()){case 0:t.values();break;case 3:t.yValues();break;case 1:case 2:t.value()}}return!0}_onChartDataUpdated(){}_onChartSizeUpdated(){}_plotAreaMouseEnter(){}_plotAreaMouseLeave(){}_plotAreaMouseMove(){}_plotAreaClick(){}_mapSeriesToAxis(){let e=0;const t=this.options.series()||[];for(this._mappedXAxisIndex=[],this._mappedYAxisIndex=[],e=0;e<t.length;e++){const s=t[e];switch(s.type()){case 0:{const e=s;this._mappedXAxisIndex.push(this._getMappedAxisIndex("xAxisName",e.xAxisName())),this._mappedYAxisIndex.push(this._getMappedAxisIndex("yAxisName",e.yAxisName()));break}case 3:{const e=s;this._mappedXAxisIndex.push(this._getMappedAxisIndex("xAxisName",e.xAxisName())),this._mappedYAxisIndex.push(this._getMappedAxisIndex("yAxisName",e.yAxisName()));break}case 1:this._mappedXAxisIndex.push(-1),this._mappedYAxisIndex.push(this._getMappedAxisIndex("yAxisName",s.axisName()));break;case 2:this._mappedXAxisIndex.push(this._getMappedAxisIndex("xAxisName",s.axisName())),this._mappedYAxisIndex.push(-1)}}}_getMappedAxisIndex(e,t){let s=0;if(!t)return 0;if("xAxisName"===e){if(this.options.xAxis.name()===t)return 0;this.options.secondaryXAxes().forEach(((e,i)=>{e.name()===t&&(s=i+1)}))}else if("yAxisName"===e){if(this.options.yAxis.name()===t)return 0;this.options.secondaryYAxes().forEach(((e,i)=>{e.name()===t&&(s=i+1)}))}return s}_isHorizontalChart(){return 4===this._xAxes()[0].axisPosition()}_initializeComputed2(){let e=[],t=[];const s=this._disposables;this._topMargin=ko.computed(s,(()=>this._computeMargin(1))),this._bottomMargin=ko.computed(s,(()=>{const e=this._computeMargin(3);return Math.max(e,0)})),this._leftMargin=ko.computed(s,(()=>this._computeMargin(4))),this._rightMargin=ko.computed(s,(()=>this._computeMargin(2))),this._width=ko.computed(s,(()=>{const e=this.options.width()-this._leftMargin()-this._rightMargin();return e>=0?e:0})),this._height=ko.computed(s,(()=>{const e=this.options.height()-this._topMargin()-this._bottomMargin();return e>=0?e:0})),this._chartDataClassTransform=ko.computed(s,(()=>D.format(this._leftMargin(),this._topMargin()))),this._transformChartArea=ko.computed(s,(()=>{this._chartSizeChanged()&&null!==this._chartSvg&&void 0!==this._chartSvg&&this._chartSvg.attr("transform",this._chartDataClassTransform())})),this._xAxes=ko.computed(s,(()=>(this._xAxesLifetimeManager&&this._xAxesLifetimeManager.dispose(),this._xAxesLifetimeManager=this.ltm.createChildLifetime(),e=[],e.push(new we(this._xAxesLifetimeManager,this.element,this._width,this._height,(e=>this._getAxisTranslate(e)),this.options,this.options.xAxis,0,this._getXSliderCoordinate)),this.options.secondaryXAxes().forEach((t=>{e.push(new we(this._xAxesLifetimeManager,this.element,this._width,this._height,(e=>this._getAxisTranslate(e)),this.options,t,2,this._getXSliderCoordinate))})),this._xAxesLifetimeManager.registerForDispose(e),e))),this._yAxes=ko.computed(s,(()=>(this._yAxesLifetimeManager&&this._yAxesLifetimeManager.dispose(),this._yAxesLifetimeManager=this.ltm.createChildLifetime(),t=[],t.push(new we(this._yAxesLifetimeManager,this.element,this._width,this._height,(e=>this._getAxisTranslate(e)),this.options,this.options.yAxis,1)),this.options.secondaryYAxes().forEach((e=>{t.push(new we(this._yAxesLifetimeManager,this.element,this._width,this._height,(e=>this._getAxisTranslate(e)),this.options,e,3))})),this._yAxesLifetimeManager.registerForDispose(t),t))),this._chartSizeUpdated=ko.computed(s,(()=>(this._chartSizeChanged(),this._sizeUpdateCounter++))),this._chartDataUpdated=ko.computed(s,(()=>(this._checkForChartUpdate(),this._dataUpdateCounter=(this._dataUpdateCounter+1)%4095))),ko.computed(s,(()=>{this.element.toggleClass("azc-chart-selected",this.options.seriesSelections().length>0)})),this._xSliderOn=ko.computed(s,(()=>!(this.options.interactionBehavior()&G.XSlider_Off))),ko.computed(s,(()=>{const e=this.options.seriesHovers().length>0;this.element.toggleClass("azc-chart-hovered",e)})),ko.computed(s,(()=>{const e=this._ariaLabel();if(e){const t=e.trim();this.element.attr("aria-label",t.length?t:null)}})),this._ariaDesc=ko.computed(s,(()=>{let e=ko.unwrap(this.options.noDataMessage)||d.noDataMessage;e=ko.unwrap(this.options.noData)?e:"";let t=ko.unwrap(this.options.ariaDesc);return t?t+=", ":t="",e&&(t=t+e+", "),t+=d.Chart.showHelp,t.trim()})),this._chartSizeUpdated.extend({rateLimit:30}),this._chartDataUpdated.extend({rateLimit:30}),this.options.series.subscribeArrayDeletes(this.ltm,(e=>{this.options.seriesSelections([]),this.options.seriesHovers([])}))}_chartSizeChanged(){let e=this._height()+this._width()+this.options.height()+this.options.width();return this._xAxes&&this._xAxes()&&this._xAxes().forEach((t=>{e+=t.padding()})),this._yAxes&&this._yAxes()&&this._yAxes().forEach((t=>{e+=t.padding()})),!0}_getAxisTranslate(e){const t={x:null,y:null};let s;switch(this._chartSizeChanged(),e.position()){case 1:s=this._computeAxisMargin(e,1,0),t.x=this._leftMargin.peek(),t.y=this._topMargin.peek()-s*e.positionIndex();break;case 2:s=this._computeAxisMargin(e,2,0),t.x=this.options.width.peek()-(this._rightMargin.peek()-s*e.positionIndex()),t.y=this._topMargin.peek();break;case 3:s=this._computeAxisMargin(e,3,0),t.x=this._leftMargin.peek(),t.y=this.options.height.peek()-(this._bottomMargin.peek()-s*e.positionIndex());break;case 4:s=this._computeAxisMargin(e,4,0),t.x=this._leftMargin.peek()-s*e.positionIndex(),t.y=this._topMargin.peek();break;case 0:t.x=0,t.y=0}return t}_computeAxisMargin(e,t,s){let i=0;return e.position()===t&&(e.showAxis()||e.hideAxisLabelsOnXSliderHover())&&(1===e.showLabel()&&(i+=e.labelPadding()),e.showName()&&(i+=30)),i*(e.positionIndex()+1)>=s?i:0}_computeMargin(e){let t=0;return t+=this._computeAxisMargin(this.options.xAxis,e,t),t+=this._computeAxisMargin(this.options.yAxis,e,t),this.options.secondaryXAxes().forEach((s=>{t+=this._computeAxisMargin(s,e,t)})),this.options.secondaryYAxes().forEach((s=>{t+=this._computeAxisMargin(s,e,t)})),t+=this._getDefaultPadding(e),t}_getDefaultPadding(e){let t;return t=fe._getDefaultMargin(e,this.options.xAxis),t||(t=fe._getDefaultMargin(e,this.options.yAxis),t||(this.options.secondaryXAxes().forEach((s=>{if(t=fe._getDefaultMargin(e,s),t)return t})),this.options.secondaryYAxes().forEach((s=>{if(t=fe._getDefaultMargin(e,s),t)return t})),0))}static _getDefaultMargin(e,t){if((t.showAxis()||t.hideAxisLabelsOnXSliderHover())&&t.position()===e){if(4===e||2===e)return 15;if(1===e||3===e)return-25}return 0}}t.Widget=fe}(u||(u={})),u})),
define("Viva.Controls/Controls/Visualization/Viva.ChartViewImpl",["require","exports","Viva.Controls/Controls/Visualization/Viva.ChartBase","Viva.Controls/Util/Viva.ArrayUtil","MsPortalImpl/Base/Base.KeyboardHelper","MsPortalImpl/Resources/ImplScriptResources","_oss/d3","Viva.Controls/Controls/Visualization/Viva.ChartUtil","FxInternal/Css","_generated/Less/MsPortalImpl.Controls/Controls/Visualization/ChartColor.css"],(function(e,t,s,i,a,r,n,o,c,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChartViewImpl=t.SeriesViewImpl=void 0,(0,c.injectCss)(l);var h=MsPortalFx.isNullOrUndefined;const d=r.Chart,u="azc-chart-view",p="visibility";let m=0;class _{get _chartItemsSortByCoordinate(){return this._chartItemsComputed||(this._chartItemsLifetimeManager||(this._chartItemsLifetimeManager=new FxImpl.TriggerableLifetimeManager),this._chartItemsComputed=ko.computed(this._chartItemsLifetimeManager,(()=>{const e=s.SeriesUtilities.getChartItemArrayBySeriesBase(this._seriesBase);let t,i;return e&&e.length>0?(0===this._xAxis.axisScaleType()||"string"==typeof e[0].xValue?(t=this._getScreenX,i=this):t=this._xAxis.mappedAxis().scale(),e.map((e=>({chartItem:e,xCoordinate:t.call(i,e.xValue)}))).sort(((e,t)=>e.xCoordinate-t.xCoordinate))):null})),this._chartItemsComputed.extend({rateLimit:25})),this._chartItemsComputed.peek()}constructor(e,t,s,i){this._noItemDataMessage="No data",this._inSetSliderTickColorClass=!1,this._viewImpl=e,this._seriesBase=t,this._seriesViewIndex=s,this._seriesIndex=i?this._viewImpl.seriesIndexDictionary(i.seriesName()):this._viewImpl.seriesIndexDictionary(t.name()),this._seriesIndex||0===this._seriesIndex||(this._seriesIndex=s),this._seriesName=e.options.series()[this._seriesIndex].name(),this._seriesName!==t.name()&&console.error("Series name from index does not match passed in name"),this._seriesView=i,this.ltm=e.ltm.createChildLifetime(),this.renderLifetimeManager=this.ltm.createChildLifetime(),this._touchPointRadiusAddition=1,this._hoveredPointRadiusAddition=5,this._selectedPointRadiusAddition=2,this._xAxis=this._viewImpl.xAxes[this._viewImpl.mappedXAxisIndex[this._seriesIndex]],this._yAxis=this._viewImpl.yAxes[this._viewImpl.mappedYAxisIndex[this._seriesIndex]],this._navigationStarted=!1,this._currentChartItemIndex=0}dispose(){this.ltm.dispose()}static _selectLastItem(e,t,s){const i=t||Number(!!t),a=-(s||0)/2,r=e.reduce(((e,t)=>t.xDistance<a?e:!e||t.xDistance<e.xDistance?t:e),null);return r&&(i<=0||Math.abs(r.xDistance)<=i)?r.chartItem:null}static _selectClosestItem(e,t,s){const i=t||Number(!!t),a=e.reduce(((e,t)=>Math.abs(t.xDistance)<Math.abs(e.xDistance)?t:e));return a&&(i<=0||Math.abs(a.xDistance)<=i)?a.chartItem:null}selectChartItemFromXCoordinate(e,t){const s=this._chartItemsSortByCoordinate;let a=s;const r=this._viewImpl.isHorizontalChart?-1:1,n=t&&t.selectFunction?t.selectFunction:_._selectClosestItem;if(s&&s.length>0){if(s.length>64){let t=i.binarySearch(s,{chartItem:null,xCoordinate:e},((e,t)=>e.xCoordinate-t.xCoordinate));t<0&&(t=~t),a=s.slice(Math.max(t-2,0),Math.min(t+2,s.length))}const o=a.map((t=>(t.xDistance=r*(e-t.xCoordinate),t)));if(o.length>0)return n(o,t?t.withinRange:null,t?t.rangeAdjustment:null)}return null}setSeriesHover(e,t){const i=this._viewImpl.options,a=this._viewImpl.chartViewIndex,r=this._seriesView,n=this._seriesIndex;if(a>=0&&a<i.views().length&&(!r||r.hoverable()))if(t&&n>=0){const t=new s.SeriesSubset;t.seriesViewIndex(this._seriesViewIndex),t.chartViewIndex(a),e?t.chartItems([e]):t.chartItems(this._getChartItems(n)),i.seriesHovers([t]),i.hoveredID([t])}else i.seriesHovers([]),i.hoveredID([])}updateSeriesLiveData(e){const t=(!this._seriesView||this._seriesView.selectable())&&this._viewImpl.options.seriesSelections().some((e=>e.chartViewIndex()===this._viewImpl.chartViewIndex&&e.seriesViewIndex()===this._seriesViewIndex));switch(this._seriesBase.type()){case 1:{let t=this._seriesBase.value();this._viewImpl.options.yAxis.autoScaleUnit()&&(t/=this._yAxis.conversionFactor()),e.seriesLiveData(d.seriesLiveHorizontalThresholdFormatter.format(this._seriesName,this._yAxis.mappedAxis().tickFormat()(t)));break}case 2:e.seriesLiveData(d.seriesLiveVerticalThresholdFormatter.format(this._seriesName,this._xAxis.mappedAxis().tickFormat()(this._seriesBase.value())));break;case 0:case 3:e.seriesLiveData(d.seriesLiveFormatter.format(this._seriesName,this._seriesIndex+1,this._viewImpl.options.series().length,t?d.selected:d.unselected,this._chartItemsSortByCoordinate?this._chartItemsSortByCoordinate.length:0))}}_disposeRenderDisposables(){this.renderLifetimeManager&&this.renderLifetimeManager.dispose(),this.renderLifetimeManager=this.ltm.createChildLifetime()}_getScreenX(e){return this._viewImpl._getScreenX(this._seriesIndex,this._xAxis.extractValue(e))}_getScreenY(e){return this._viewImpl._getScreenY(this._seriesIndex,this._yAxis.extractValue(e))}_toggleSeriesSelection(e){this._viewImpl.toggleSeriesSelection(this._seriesViewIndex,e)}_attachSeriesComputeds(e){const t=this.renderLifetimeManager;ko.computed(t,(()=>{this._createSelectedPlots(e)})),ko.computed(t,(()=>{this._createHover(e)})),this._viewImpl._attachSeriesComputeds(e,this._seriesViewIndex,this._seriesView)}_eventHandlerWrapper(e,t){const s=this._viewImpl._getEvents(),i={seriesName:this._seriesName,value:t};if(this._navigationStarted=!1,this._updateFocus(),s&&s.pointClick)switch(e){case"pointmouseover":s.pointMouseEnter&&s.pointMouseEnter(i);break;case"pointmouseleave":s.pointMouseLeave&&s.pointMouseLeave(i);break;case"pointclick":s.pointClick&&s.pointClick(i);break;case"seriesmouseover":s.seriesMouseEnter&&s.seriesMouseEnter(i);break;case"seriesmouseleave":s.seriesMouseLeave&&s.seriesMouseLeave(i);break;case"seriesclick":s.seriesClick&&s.seriesClick(i)}}_getChartItemArray(e=!1){return s.SeriesUtilities.getChartItemArrayBySeriesBase(this._seriesBase,e)}_isDataXValueSortable(){return s.SeriesUtilities.isXValueSortable(this._seriesBase)}_createArea(e,t=null,s=!1){switch(this._seriesBase.type()){case 1:return this._createHorizontalArea(e,s);case 2:return this._createVerticalArea(e,s);case 0:case 3:{t=t||this._getInterpolation();const i=this._getChartItemArray(),a=this._createGeneralArea(t,s);return e.append("path").attr("d",a(i))}}}_createGeneralLine(e){return n.svg.line().interpolate(_._getInterpolationString(e)).x((e=>this._getScreenX(e.xValue))).y((e=>this._getScreenY(e.yValue)))}_renderSeries(){}_createElement(e){return this._viewImpl.element.append("g").attr("class",e)}_renderTooltips(){if(this._seriesView&&this._seriesView.showTooltip()){const e=this._createElement("azc-chart-tooltip-circle"),t=this._createDataPlots(e,this._touchPointRadiusAddition);this._addTooltips(t)}}_createSelectedPlots(e){const t=this._viewImpl.options.seriesSelections().filter((e=>e.chartViewIndex()===this._viewImpl.chartViewIndex&&e.seriesViewIndex()===this._seriesViewIndex)),s=t.length>0?t[0].chartItems():[];return this._updatePlots(e,s,"azc-chart-selected-circle",this._selectedPointRadiusAddition,2,!0)}_createHover(e){if(!this._inSetSliderTickColorClass){const t=x._getCssClass(this._seriesViewIndex,this._seriesView);let s;const i=this._getHoveredChartItems();if(i&&(!this._seriesView||this._seriesView.hoverable())){this._createHoveredPlots(e,i);const a=this._viewImpl.options.seriesHovers.peek();1===a.length&&a[0].seriesViewIndex()===this._seriesViewIndex&&1===a[0].chartItems.peek().length&&(s=t)}if(this._xAxis)try{this._inSetSliderTickColorClass=!0,s?this._xAxis._sliderTickColorClass(s):this._xAxis._sliderTickColorClass.peek()===t&&this._xAxis._sliderTickColorClass("")}finally{this._inSetSliderTickColorClass=!1}}}_getHoveredChartItems(){return this._filterChartItems(this._viewImpl.options.seriesHovers())}_getSelectedChartItems(){return this._filterChartItems(this._viewImpl.options.seriesSelections())}_createHoveredPlots(e,t){this._updatePlots(e,t,"azc-chart-hovered-circle",this._hoveredPointRadiusAddition,2,!0)}_createDataPlots(e,t=0){const s=this._getChartItemArray(!1);return this._updatePlots(e,s,"azc-svg-style-fill",t,1)}_updatePlots(e,t,s,i=0,a=0,r){const n=this._seriesView,o=(n&&n.hasOwnProperty("radius")?n.radius():2)+i,c=m++;let l=!1;t=this._viewImpl._transformPlotValues(t,this._seriesViewIndex);const h=e.selectAll("circle."+s).data(t);return h.enter().append("circle"),h.attr({class:["circle"+c,s].join(" "),r:o,cx:e=>this._getScreenX(e.xValue),cy:e=>MsPortalFx.isNullOrUndefined(e.y0)?this._getScreenY(e.yValue):this._getScreenY(e.y0),"data-eventDataSeriesName":()=>this._seriesBase.name()}).style(p,"visible").on("click",(e=>{this._toggleSeriesSelection(e),this._eventHandlerWrapper("pointclick",e),this._eventHandlerWrapper("seriesclick",e),this._viewImpl._toggleSinglePlotSelection(this._seriesViewIndex)})).on("mousemove",(()=>{l&&this._viewImpl.mouseMoveHandler()})).on("mouseover",(e=>{let t=!1;l=this._viewImpl.isHoverHandled=!0,2!==a&&(t=!0,this.setSeriesHover(e,t),this._eventHandlerWrapper("pointmouseover",e),this._eventHandlerWrapper("seriesmouseover",e))})).on("mouseleave",(e=>{if(1!==a){const t=this._viewImpl.isHoverHandled=!1;this.setSeriesHover(e,t),this._eventHandlerWrapper("pointmouseleave",e),this._eventHandlerWrapper("seriesmouseleave",e)}l=this._viewImpl.isHoverHandled=!1})),r?h.exit().style(p,"hidden"):h.exit().remove(),h}_addTooltips(e){const t=this._seriesView?this._seriesView.tooltipFormatter():"Series: '{0}' xValue: {1} yValue: {2}";e.append("title").text((e=>t.format(this._seriesBase.name(),e.xValue?e.xValue.toString():this._noItemDataMessage,e.yValue?e.yValue.toString():this._noItemDataMessage)))}_applyRenderingConditions(e,t){const s=this._createClipPath(e);s&&t.attr("clip-path","url(#"+s+")")}_createSeriesElement(){return this._createElement(x._getCssClass(this._seriesIndex,this._seriesView))}_getInterpolation(){return this._seriesView&&this._seriesView.hasOwnProperty("interpolation")?this._seriesView.interpolation():null}_renderDataLabels(){const e=this._seriesView?this._seriesView.dataLabels():[];let t,i;e&&e.length>0&&(t=this._viewImpl.xAxes[this._viewImpl.mappedXAxisIndex[this._seriesIndex]],i=this._viewImpl.yAxes[this._viewImpl.mappedYAxisIndex[this._seriesIndex]],e.forEach((e=>{s.SeriesUtilities.getChartItemsByDataLabelAndSeries(this._seriesBase,e).forEach((s=>{this._renderDataLabel(s,e,t,i)}))})))}_createHorizontalLine(e,t=null){return n.svg.line().x(((e,s)=>0===s?0:h(t)?this._viewImpl.width:this._getScreenX(t))).y(this._getScreenY(e))}_createVerticalLine(e,t=null){return n.svg.line().x(this._getScreenX(e)).y((e=>0===e?h(t)?0:this._getScreenY(t):this._viewImpl.height))}_updateFocus(){}_handleKeyboardEvents(e,t){const s=a.getModifierKeys(e),i=this._chartItemsSortByCoordinate,r=i&&i.length,n=e=>{this._currentChartItemIndex>=e&&(this._currentChartItemIndex=0,this._navigationStarted=!0)};let o;if(!r)return this._navigationStarted=!1,this._currentChartItemIndex=0,void this._updateFocus();if(0===s)switch(e.which){case 27:this._navigationStarted=!1,this._currentChartItemIndex=0,this._updateFocus();break;case 32:n(r),o=i[this._currentChartItemIndex].chartItem,this._toggleSeriesSelection(o),this._updateChartItemLiveData(i.length,o,t);break;case 37:case 39:this._navigationStarted?37===e.which?this._currentChartItemIndex=--this._currentChartItemIndex<0?r-1:this._currentChartItemIndex%r:this._currentChartItemIndex=++this._currentChartItemIndex%r:this._navigationStarted=!0,n(r),o=i[this._currentChartItemIndex].chartItem,this.setSeriesHover(o,!0),this.updateSeriesLiveData(t),this._updateChartItemLiveData(i.length,o,t),this._updateFocus();break;default:return}}static _getInterpolationString(e){switch(e){case 1:return"monotone";case 2:return"step-after";default:return"linear"}}static _getUniqueId(){return u+"-uniqueid-"+m++}_isChartItemSelected(e){const t=this._viewImpl.options.seriesSelections().filter((e=>e.chartViewIndex()===this._viewImpl.chartViewIndex&&e.seriesViewIndex()===this._seriesViewIndex));let s=!1;if((!this._seriesView||this._seriesView.selectable())&&t.length>0&&e){s=t[0].chartItems().filter((t=>e.xValue===t.xValue&&e.yValue===t.yValue)).length>0}return s}_updateChartItemLiveData(e,t,s){const i=this._isChartItemSelected(t);let a=t.yValue;this._viewImpl.options.yAxis.autoScaleUnit()&&(a/=this._yAxis.conversionFactor()),s.chartItemLiveData(d.itemLiveFormatter.format(this._xAxis.mappedAxis().tickFormat()(t.xValue),this._yAxis.mappedAxis().tickFormat()(a),i?d.selected:d.unselected,this._currentChartItemIndex+1,e,this._seriesName))}_getChartItems(e){return s.SeriesUtilities.getChartItemArrayBySeriesBase(this._seriesBase,!0)}_createHorizontalArea(e,t=!1){const s=this._seriesBase,i=this._getScreenY(s.value()),a=e.append("rect");return t?a.attr({width:this._viewImpl.width,height:i}):a.attr({width:this._viewImpl.width,height:this._viewImpl.height-i,y:i})}_createGeneralArea(e,t=!1){const s=this._createGeneralLine(e),i=_._getInterpolationString(e),a=n.svg.area().interpolate(i).x(s.x());return t?a.y0(s.y()).y1(0):a.y0(this._viewImpl.height).y1(s.y())}_createVerticalArea(e,t=!1){const s=this._seriesBase,i=this._getScreenX(s.value()),a=e.append("rect");return t?a.attr({width:this._viewImpl.width-i,height:this._viewImpl.height,x:i}):a.attr({width:i,height:this._viewImpl.height})}_renderDataLabel(e,t,s,i){if(null!==e.xValue&&null!==e.yValue&&e.xValue>=s.valueScale().domain()[0]&&e.xValue<=s.valueScale().domain()[1]&&e.yValue>=i.valueScale().domain()[0]&&e.yValue<=i.valueScale().domain()[1]){let a=s.valueScale()(e.xValue),r=i.valueScale()(e.yValue)-5;const n=s.getPointFormatter()(e.xValue),o=i.getPointFormatter()(e.yValue),c=t.formatter()||"{2}",l=15,h=10;a=Math.max(a,s.valueScale().range()[0]+l),a=Math.min(a,s.valueScale().range()[1]-l),r=Math.max(r,i.valueScale().range()[1]+h),this._viewImpl.element.append("g").attr({class:"azc-chart-callout",transform:"translate("+a.toString()+", "+r.toString()+")"}).append("text").text(c.format(this._seriesBase.name(),null!==n?n:this._noItemDataMessage,null!==o?o:this._noItemDataMessage))}}_createClipPath(e){if(!this._seriesView)return null;const t=this._seriesView.renderingConditions();let s,i;return null===t||0===t.length?null:(t.forEach((t=>{s=_._getUniqueId();const a=e.append("clipPath").attr("id",s);this._viewImpl._createClipPathSelection(t,a)&&(i&&a.attr("clip-path","url(#"+i+")"),i=s)})),s)}_filterChartItems(e){let t=[];const s=MsPortalFx.find(e,(e=>e.chartViewIndex()===this._viewImpl.chartViewIndex&&e.seriesViewIndex()===this._seriesViewIndex));return s&&(t=s.chartItems()),t}}t.SeriesViewImpl=_;class x{constructor(){this.seriesViewImpls=new Array,this.chartViewIndex=null,this._reversed=ko.observable(!1),this._viewClass=u,this._currentSeriesIndex=0,this._navigationStarted=!1}get seriesViews(){return this._seriesViews?this._seriesViews():this._view.seriesView()}get series(){return this._series?this._series():this.options.series()}init(e){const t=this.ltm=e.createChildLifetime();this.renderLifetimeManager=t.createChildLifetime(),this._currentSeriesIndex=0,this._navigationStarted=!1,this._seriesViews=ko.computed(t,(()=>{const e=this._reversed(),t=this._view.seriesView();return e?t.slice().reverse():t})),this._series=ko.computed(t,(()=>{const e=this._reversed(),t=this.options.series();return e?t.slice().reverse():t})),this.element.attr("class",this._viewClass),this._render()}dispose(){this._disposeSeriesViewImpls(),this.ltm&&this.ltm.dispose(),this.element.selectAll("circle").on("click",null).on("mouseover",null).on("mouseleave",null),this.element.remove()}toggleSeriesSelection(e,t){let i;const a=this.options,r=this._getSeriesViewBySeriesViewIndex(e),n=this._getSeriesIndexBySeriesViewIndex(e),o=a.seriesSelections().filter((t=>t.chartViewIndex()===this.chartViewIndex&&t.seriesViewIndex()===e));let c;if(!r||r.selectable())if(o.length>0)if(t){const e=o[0].chartItems().filter((e=>t.xValue===e.xValue&&t.yValue===e.yValue));e.length>0?(o[0].chartItems.removeAll(e),0===o[0].chartItems().length&&a.seriesSelections.removeAll(o)):o[0].chartItems.push(t)}else i=this._getChartItems(n),o[0].chartItems().length!==i.length?o[0].chartItems(i):a.seriesSelections.removeAll(o);else c=new s.SeriesSubset,c.seriesViewIndex(e),c.chartViewIndex(this.chartViewIndex),t?c.chartItems.push(t):c.chartItems(this._getChartItems(n)),a.seriesSelections.push(c)}getXSliceSeriesSubset(e,t,i){const a=new Array;return this.seriesViewImpls.map(((r,n)=>{const o=r.selectChartItemFromXCoordinate(e,{rangeAdjustment:i,withinRange:t});if(o){const e=new s.SeriesSubset;e.seriesViewIndex(n),e.chartViewIndex(this.chartViewIndex),e.chartItems.push(o),a.push(e)}})),a}static _iterateOverSeriesView(e,t,s){const i=e.seriesViews,a=e.options.series();return i.map(((t,i)=>{const r=e.seriesIndexDictionary(t.seriesName());if(!h(r)&&a[r]){const n=e._getSeriesViewImpl(a[r],i,t);return s(n)}return[]}))}static _getCssClass(e,t){return t&&t.cssClass()||(0,o.getFxColorClass)(e)}_transformPlotValues(e,t){return e}_toggleSinglePlotSelection(e){}_disposeRenderDisposables(){this.renderLifetimeManager&&this.renderLifetimeManager.dispose(),this.renderLifetimeManager=this.ltm.createChildLifetime()}_disposeSeriesViewImpls(){this.seriesViewImpls.forEach((e=>{e.dispose()})),this.seriesViewImpls=[]}_attachSeriesComputeds(e,t,s,i=!0){const a=this.renderLifetimeManager;i&&ko.computed(a,(()=>{const i=this._getHoveredSeriesViewIndexes();e.classed("azc-chart-series-hovered",(!s||s.hoverable())&&1===i.length&&i[0]===t)})),ko.computed(a,(()=>{const i=(!s||s.selectable())&&this.options.seriesSelections().some((e=>e.chartViewIndex()===this.chartViewIndex&&e.seriesViewIndex()===t));e.classed("azc-chart-series-selected",i)}))}_getScreenX(e,t){let s=0;const i=this.mappedXAxisIndex[e];return h(i)||h(this.xAxes[i])||(s=this.xAxes[i].valueScale()(t),null==s)?0:s}_getScreenY(e,t){let s=0;const i=this.mappedYAxisIndex[e];return h(i)||h(this.yAxes[i])||(s=this.yAxes[i].valueScale()(t/this.yAxes[i].conversionFactor()),null==s)?0:s}_getEvents(){return this._view.hasOwnProperty("events")?this._view.events:null}_createClipPathSelection(e,t){const s=this.seriesIndexDictionary(e.seriesName());if(!h(s)){const i=this.options.series()[s],a=0===e.conditionOperator();return new _(this,i,s,null)._createArea(t,e.interpolation(),a),!0}return!1}_createSeriesViewImpl(e,t,s){return new _(this,e,t,s)}_updateFocus(e){}_render(){this._disposeRenderDisposables(),x._iterateOverSeriesView(this,this._view,(e=>{e._renderSeries(),e._renderTooltips()})),x._iterateOverSeriesView(this,this._view,(e=>{e._renderDataLabels()}))}_getHoveredSeriesViewIndexes(){return this.options.seriesHovers().filter((e=>e.chartViewIndex()===this.chartViewIndex)).map((e=>e.seriesViewIndex()))}_getSeriesViewBySeriesViewIndex(e){const t=this.seriesViews;return 0!==t.length&&e>=0&&e<this._view.seriesView().length?t[e]:null}_getSeriesIndexBySeriesViewIndex(e){const t=this.seriesViews;if(0===t.length)return this.seriesViewImpls[e]?this.seriesViewImpls[e]._seriesIndex:null;if(e>=0&&e<this._view.seriesView().length){const s=t[e].seriesName();return this.seriesIndexDictionary(s)}return null}_canNavigateSeries(e){const t=this.seriesViewImpls.length;if(!t)return!1;if(!this._navigationStarted)return!0;let s=this._currentSeriesIndex;if(38===e){if(++s>=t)return!1}else if(40===e&&--s<0)return!1;return!0}_handleKeyboardEvents(e,t){const s=a.getModifierKeys(e),i=a.isCtrlOrCommandOnly(e),r=this.seriesViewImpls.length;if(!r)return this._navigationStarted=!1,this._currentSeriesIndex=0,void this._updateFocus(-1);const n=e=>{this._currentSeriesIndex>=e&&(this._currentSeriesIndex=0,this._navigationStarted=!0)};if(0===s)switch(e.which){case 27:this._navigationStarted=!1,this._currentSeriesIndex=0;for(let s=0;s<r;s++)this.seriesViewImpls[s]._handleKeyboardEvents(e,t);break;case 32:case 37:case 39:this._navigationStarted=!0,n(r),this.seriesViewImpls[this._currentSeriesIndex]._handleKeyboardEvents(e,t);break;default:return}else if(!i||38!==e.which&&40!==e.which)i&&32===e.which&&(n(r),this.toggleSeriesSelection(this._currentSeriesIndex,null),this.seriesViewImpls[this._currentSeriesIndex].updateSeriesLiveData(t));else{this._navigationStarted?38===e.which?this._currentSeriesIndex=++this._currentSeriesIndex%r:this._currentSeriesIndex=--this._currentSeriesIndex<0?r-1:this._currentSeriesIndex%r:this._navigationStarted=!0,n(r);const s=this.seriesViewImpls[this._currentSeriesIndex];s.setSeriesHover(null,!0),s.updateSeriesLiveData(t),this._updateFocus(-1)}}_getChartItems(e){return s.SeriesUtilities.getChartItemArrayBySeriesBase(this.options.series()[e],!0)}_getSeriesViewImpl(e,t,s){return this.seriesViewImpls[t]||(this.seriesViewImpls[t]=this._createSeriesViewImpl(e,t,s)),this.seriesViewImpls[t]}}t.ChartViewImpl=x})),
define("Viva.Controls/Controls/Visualization/Viva.AreaChartViewImpl",["require","exports","Viva.Controls/Util/Viva.Hatching","Viva.Controls/Controls/Visualization/Viva.ChartBase","Viva.Controls/Controls/Visualization/Viva.ChartViewImpl","Viva.Controls/Util/Viva.Util","FxInternal/Css","_generated/Less/Viva.Controls/Controls/Visualization/Viva.SvgBase.css","_generated/Less/MsPortalImpl.Controls/Controls/Visualization/ChartColor.css"],(function(e,t,s,i,a,r,n,o,c){"use strict";var l;return(0,n.injectCss)(o,c),function(e){MsPortalFx.ViewModels.Controls.Visualization.Chart;const t="azc-svg-style-fill";class i extends a.SeriesViewImpl{_renderSeries(){const e=this._seriesView,i=this._createSeriesElement();let r=!1;const n=this._createArea(i);if(n){n.attr("class",t).on("click",(()=>{this._toggleSeriesSelection(null),this._eventHandlerWrapper("seriesclick",null)})).on("mousemove",(()=>{r&&this._viewImpl.mouseMoveHandler()})).on("mouseenter",(()=>{const e=this._viewImpl.isHoverHandled=r=!0;this.setSeriesHover(null,e),this._eventHandlerWrapper("seriesmouseover",null)})).on("mouseleave",(()=>{const e=this._viewImpl.isHoverHandled=r=!1;this.setSeriesHover(null,e),this._eventHandlerWrapper("seriesmouseleave",null)})),i.classed("azc-areaChart-series",!0),this._attachSeriesComputeds(i);const o=e&&ko.unwrap(e.areaHatchingPattern);o&&s.renderHatching(o,a.ChartViewImpl._getCssClass(this._seriesIndex,e),t,n,this._viewImpl.element),this._applyRenderingConditions(i,n)}}_createSelectedPlots(e){return null}_createHoveredPlots(e,t){return null}}e.AreaChartSeriesViewImpl=i;class r extends a.ChartViewImpl{constructor(e){super(),this._viewClass="azc-chart-view-area",this._view=e}dispose(){this.element.selectAll("path").on("click",null).on("mouseover",null).on("mouseleave",null),super.dispose()}_createSeriesViewImpl(e,t,s){return new i(this,e,t,s)}}e.AreaChartViewImpl=r}(l||(l={})),l})),
define("Viva.Controls/Controls/Visualization/Viva.StackedChartViewImpl",["require","exports","_oss/d3","Viva.Controls/Controls/Visualization/Viva.ChartViewImpl","Viva.Controls/Controls/Visualization/Viva.ChartBase","Viva.Controls/Util/Viva.Util"],(function(e,t,s,i,a,r){"use strict";var n;return function(e){MsPortalFx.ViewModels.Controls.Visualization.Chart;class t extends i.SeriesViewImpl{}e.StackedChartSeriesViewImpl=t;class a extends i.ChartViewImpl{constructor(e){super(),this._view=e,this._viewClass="azc-chart-view-stacked",this._reversed(!0)}dispose(){super.dispose()}_createSeriesViewImpl(e,s,i){return new t(this,e,s,i)}static _allocArray(e,t){let s=0;const i=new Array(t+1);for(i[0]=e,s=1;s<t+1;s++)i[s]={value:0,originalValue:null};return i}_getNumberOfSeriesView(){return this._view.seriesView().length}_getStringValue(e){return e instanceof Date?Number(e).toString():e.toString()}_getSparseSeriesStackLayer(){const e=new Object;let t,s,r=0;const n=this._getNumberOfSeriesView();let o,c=0;const l=this.xAxes[0],h=this.yAxes[0];let d,u=!0;return i.ChartViewImpl._iterateOverSeriesView(this,this._view,(i=>{for(o=i._getChartItemArray(!0),u=u&&i._isDataXValueSortable(),c=o.length,r=0;r<c;r++)t=l.extractValue(o[r].xValue),s=this._getStringValue(t),e[s]=e[s]||a._allocArray(t,n+1),e[s].originalValue=o[r].xValue,e[s][i._seriesViewIndex+1]={value:h.extractValue(o[r].yValue),originalValue:o[r].yValue}})),d=Object.keys(e)||[],u&&(d=MsPortalFx.stableSort(d,((t,s)=>{const i=e[t],a=e[s],r=i&&i.originalValue,n=a&&a.originalValue;return Number(r)-Number(n)}))),i.ChartViewImpl._iterateOverSeriesView(this,this._view,(t=>{const s=[],a=t._seriesIndex,r=t._seriesView,n=r?r.seriesName():null;d.forEach((i=>{e.hasOwnProperty(i)&&void 0!==e[i]&&s.push({x:e[i][0],y:e[i][t._seriesViewIndex+1].value,originalX:e[i].originalValue,originalY:e[i][t._seriesViewIndex+1].originalValue,seriesViewIndex:t._seriesViewIndex,seriesIndex:a})}));const o=s;return o.seriesViewIndex=t._seriesViewIndex,o.seriesName=n?r.seriesName():"Series"+a,o.cssClass=i.ChartViewImpl._getCssClass(a,r),s})).filter((e=>0!==e.length))}_getDenseSeriesStackLayer(){const e=this.xAxes[0],t=this.yAxes[0];return i.ChartViewImpl._iterateOverSeriesView(this,this._view,(s=>{const a=s._seriesView,r=s._seriesIndex;let n=[];const o=s._getChartItemArray();o.length>0&&(n=o.map(((i,a)=>({x:e.extractValue(i.xValue),y:t.extractValue(i.yValue),originalX:i.xValue,originalY:i.yValue,seriesViewIndex:s._seriesViewIndex,seriesIndex:s._seriesIndex}))));const c=n;return c.seriesViewIndex=s._seriesViewIndex,c.seriesName=a?a.seriesName():"Series"+r,c.cssClass=i.ChartViewImpl._getCssClass(r,a),n})).filter((e=>0!==e.length))}_getStackLayer(){const e=1!==this._getNumberOfSeriesView()&&this._view.enableSparseSeries()?this._getSparseSeriesStackLayer():this._getDenseSeriesStackLayer();if(e&&e.length>0){const t=e[0].length;for(let s=0;s<t;s++){let t=0,i=0;e.forEach((e=>{const a=e[s],r=Math.abs(a.y);a.y<0?(a.y0=i,i-=r):(t+=r,a.y0=t)}))}return e}return[]}_initializeChartData(){this._layers=this._getStackLayer(),this._yStackMax=s.max(this._layers,(e=>s.max(e,(e=>e.y0)))),this._yStackMin=s.min(this._layers,(e=>s.min(e,(e=>e.y0+e.y))))}}e.StackedChartViewImpl=a}(n||(n={})),n})),
define("Viva.Controls/Controls/Visualization/Viva.BarChartViewImpl",["require","exports","_oss/d3","Viva.Controls/Controls/Visualization/Viva.ChartBase","Viva.Controls/Controls/Visualization/Viva.StackedChartViewImpl","Viva.Controls/Util/Viva.Util"],(function(e,t,s,i,a,r){"use strict";var n;return function(e){MsPortalFx.ViewModels.Controls.Visualization.Chart;const t="azc-svg-style-fill",r="azc-barChart-data-column",n="azc-barChart-series",o=".azc-barChart-series",c=".azc-barChart-bar-focus-outer",l=".azc-barChart-bar-focus-inner",h="azc-chart-item-selected";MsPortalFx.isDevelopmentMode;class d extends a.StackedChartSeriesViewImpl{_attachItemsComputeds(e){const t=this.renderLifetimeManager;ko.computed(t,(()=>{const t=this._getHoveredChartItems(),s=this._checkElementBelongsToChartItems(e,t);e.classed("azc-chart-item-hovered",s)})),ko.computed(t,(()=>{const t=this._getSelectedChartItems(),s=this._checkElementBelongsToChartItems(e,t);e.classed(h,s)}))}_attachSeriesComputeds(e){ko.computed(this.renderLifetimeManager,(()=>{this._getHoveredChartItems(),e.classed(h,!1)}))}_updateFocus(){this._viewImpl._updateFocus(this._navigationStarted?this._currentChartItemIndex:-1)}_checkElementBelongsToChartItems(e,t){const s=e.datum(),i=s.x&&s.x.toString();return t&&t.some((e=>this._xAxis.extractValue(e.xValue).toString()===i))}}e.BarChartSeriesViewImpl=d;class u extends a.StackedChartViewImpl{constructor(e){super(e),this._view=e,this._viewClass="azc-chart-view-bar"}init(e){super.init(e),this._initializeChartData(),this._render()}dispose(){this.element.selectAll("rect").on("click",null).on("mouseover",null).on("mouseleave",null),super.dispose()}getXSliceSeriesSubset(e,t,s){return super.getXSliceSeriesSubset(e,t,this._step)}_updateFocus(e){const t=!this._navigationStarted||e<0;if(t)this.element.selectAll(c).classed("azc-barChart-bar-focusHide",t),this.element.selectAll(l).classed("azc-barChart-bar-focusHide",t);else{const s=$.extend(this._getExtendedBarChartD3Settings(1).attr,{rx:3,ry:3});this.element.selectAll(c).data([this._layers[this._currentSeriesIndex][e]]).attr(s).classed("azc-barChart-bar-focusHide",t);const i=$.extend(this._getExtendedBarChartD3Settings(3).attr,{rx:3,ry:3});this.element.selectAll(l).data([this._layers[this._currentSeriesIndex][e]]).attr(i).classed("azc-barChart-bar-focusHide",t)}}_render(){const e=this;let t=!1;if(!this._layers||0===this._layers.length)return void this.element.selectAll(o).remove();this._initializeBarSize(),this.element.selectAll(o).remove(),this.element.selectAll(c).remove(),this.element.selectAll(l).remove(),this._disposeRenderDisposables();const a=this._getBarChartD3Settings(),r=this.element.selectAll(o).data(this._layers).enter().append("g").attr("class",((e,t)=>[n,e.cssClass].join(" ")));r.each((function(t,i){e.seriesViewImpls[t.seriesViewIndex]._attachSeriesComputeds(s.select(this))})),this._bars=r.selectAll("rect").data((e=>e)).enter().append("rect").attr(a.attr).classed(a.classed).on("mousemove",(()=>{t&&this.mouseMoveHandler()})).on("mouseenter",((e,s)=>{const a=this.isHoverHandled=t=!0,r=new i.ChartItem(e.originalX,e.originalY);this.seriesViewImpls[e.seriesViewIndex].setSeriesHover(r,a),this._eventHandlerWrapper("mouseenter",e,s)})).on("mouseleave",((e,s)=>{const a=this.isHoverHandled=t=!1,r=new i.ChartItem(e.originalX,e.originalY);this.seriesViewImpls[e.seriesViewIndex].setSeriesHover(r,a),this._eventHandlerWrapper("mouseleave",e,s)})).on("click",((e,t)=>{const s=new i.ChartItem(e.originalX,e.originalY);this.toggleSeriesSelection(e.seriesViewIndex,s),this._eventHandlerWrapper("click",e,t)})),this._bars.each((function(t,i){e.seriesViewImpls[t.seriesViewIndex]._attachItemsComputeds(s.select(this))})),this.element.append("rect").attr({x:1,y:1,height:1,width:1}).attr("class","azc-barChart-bar-focus-outer azc-barChart-bar-focusHide"),this.element.append("rect").attr({x:1,y:1,height:1,width:1}).attr("class","azc-barChart-bar-focus-inner azc-barChart-bar-focusHide")}_createSeriesViewImpl(e,t,s){return new d(this,e,t,s)}_barMouseEnter(e,t){this._view.events&&this._view.events.barMouseEnter&&this._view.events.barMouseEnter(e,t)}_barMouseLeave(e,t){this._view.events&&this._view.events.barMouseLeave&&this._view.events.barMouseLeave(e,t)}_barMouseClick(e,t){this._view.events&&this._view.events.barClick&&this._view.events.barClick(e,t)}_eventHandlerWrapper(e,t,s){let i;const a=this._getSeriesIndexBySeriesViewIndex(t.seriesViewIndex),r={seriesName:this.options.series()[a].name(),value:{xValue:t.x,yValue:t.y}};switch(this._getNumberOfSeriesView()>1&&(0===this._view.barChartType()||1===this._view.barChartType())&&(i=this._getEventData(t,s)),e){case"mouseenter":this._barMouseEnter(r,i);break;case"mouseleave":this._barMouseLeave(r,i);break;case"click":this._barMouseClick(r,i)}}_initializeChartData(){if(this._getNumberOfSeriesView()<=0)return this.element.selectAll(o).remove(),void(this._layers=null);super._initializeChartData()}_getXOffset(e,t){return!0===t?this._getScreenX(e.seriesIndex,e.x)+this._barWidthOffset:this._getScreenX(e.seriesIndex,e.x)-this._barWidthOffset}_getEventData(e,t){const s=[],i=this._layers;if(i){let e=0;for(e=0;e<this._getNumberOfSeriesView();e++){const a=i[e];if(a){const i=a[t];i&&i.y>0&&s.push({seriesName:this.seriesViewImpls[e]._seriesName,value:{xValue:i.x,yValue:i.y}})}}}return s}_initializeBarSize(){const e=this._view.barPaddingRatio(),t=this.xAxes[0];this._step=t.step(),this._barWidth=this._step*(1-e),this._barWidthOffset=this._barWidth/2,this._groupedBarWidth=this._getNumberOfSeriesView()>0?this._barWidth/this._getNumberOfSeriesView():this._barWidth}_getBarChartD3Settings(){return[this._getDefaultBarChartD3Setting(),this._getExtendedBarChartD3Settings()].reduce(((e,t)=>({attr:$.extend(e.attr,t.attr),classed:$.extend(e.classed,t.classed)})))}_getDefaultBarChartD3Setting(){const e={x:e=>this._getXOffset(e),y:this.height,width:this._barWidth,height:0},s={};return[r,t].forEach((e=>{s[e]=!0})),{attr:e,classed:s}}_getExtendedBarChartD3Settings(e=0){let t;switch(this._view.barChartType()){case 1:t=this._getGroupedBarChartD3Settings(e);break;case 2:t=this._getSplitBarChartSettings(e);break;default:t=this._getStackedBarChartD3Setting(e)}return t}_getStackedBarChartD3Setting(e=0){const t=this.isHorizontalChart,s=this.yAxes[0];s.internalMin(Math.min(0,this._yStackMin)),s.internalMax(this._yStackMax);return{attr:t?{x:(e,t,s)=>this._getScreenY(0,e.y0-Math.abs(e.y)),width:(e,t,s)=>Math.abs(this._getScreenY(0,e.y0+e.y)-this._getScreenY(0,e.y0)),y:(e,t,s)=>this._getXOffset(e),height:this._barWidth}:{x:(t,s,i)=>this._getXOffset(t)-e,width:this._barWidth+2*e,y:(t,s,i)=>this._getScreenY(0,t.y0)-e,height:(t,s,i)=>this._getScreenY(0,0)-this._getScreenY(0,Math.abs(t.y))+2*e}}}_getGroupedBarChartD3Settings(e=0){return{attr:this.isHorizontalChart?{x:(e,t,s)=>e.y>=0?this._getScreenY(s,0):this._getScreenY(s,e.y),width:(e,t,s)=>Math.abs(this._getScreenY(s,0)-this._getScreenY(s,Math.abs(e.y))),y:(e,t,s)=>this._getScreenX(s,e.x)+this._groupedBarWidth*(this._getNumberOfSeriesView()-s)-this._barWidth,height:this._groupedBarWidth}:{x:(t,s,i)=>this._getScreenX(t.seriesViewIndex,t.x)+this._groupedBarWidth*t.seriesViewIndex-this._barWidthOffset-e,width:this._groupedBarWidth+2*e,y:(t,s,i)=>t.y>=0?this._getScreenY(t.seriesViewIndex,t.y)-e:this._getScreenY(t.seriesViewIndex,0)-e,height:(t,s,i)=>this._getScreenY(t.seriesViewIndex,0)-this._getScreenY(i,Math.abs(t.y))+2*e}}}_getSplitBarChartSettings(e=0){const t={},s=this.isHorizontalChart?{x:e=>this._getScreenY(e.seriesIndex,Math.min(0,e.y)),width:e=>Math.abs(this._getScreenY(e.seriesIndex,e.y)-this._getScreenY(e.seriesIndex,0)),y:e=>this._getXOffset(e,!0),height:this._groupedBarWidth}:{x:t=>this._getXOffset(t)-e,width:this._groupedBarWidth+2*e,y:t=>this._getScreenY(t.seriesIndex,Math.max(0,t.y))-e,height:t=>Math.abs(this._getScreenY(t.seriesIndex,t.y)-this._getScreenY(t.seriesIndex,0))+2*e};return t["azc-barChart-bar-positive"]=e=>e.y>0,t["azc-barChart-bar-negative"]=e=>e.y<0,{attr:s,classed:t}}}e.BarChartViewImpl=u}(n||(n={})),n})),
define("Viva.Controls/Controls/Visualization/Viva.LineChartViewImpl",["require","exports","Viva.Controls/Controls/Visualization/Viva.ChartBase","Viva.Controls/Controls/Visualization/Viva.ChartViewImpl","Viva.Controls/Util/Viva.Util"],(function(e,t,s,i,a){"use strict";var r;return function(e){MsPortalFx.ViewModels.Controls.Visualization.Chart;const t="azc-svg-style-stroke";class s extends i.SeriesViewImpl{_renderSeries(){const e=this._seriesView;let i;const a=s._getLineStyleString(e?ko.unwrap(e.lineStyle):null);let r=!1;const n=this._createLineString(this._getInterpolation());n&&(i=this._createSeriesElement(),i.classed("azc-lineChart-series",!0).append("path").attr({d:n,class:[t,a].join(" ")}).on("click",(()=>{this._toggleSeriesSelection(null),this._eventHandlerWrapper("seriesclick",null)})).on("mousemove",(()=>{r&&this._viewImpl.mouseMoveHandler()})).on("mouseenter",(()=>{const e=this._viewImpl.isHoverHandled=r=!0;this.setSeriesHover(null,e),this._eventHandlerWrapper("seriesmouseover",null)})).on("mouseleave",(()=>{const e=this._viewImpl.isHoverHandled=r=!1;this.setSeriesHover(null,e),this._eventHandlerWrapper("seriesmouseleave",null)})),this._attachSeriesComputeds(i),this._applyRenderingConditions(i,i),e&&!ko.unwrap(e.showDataPoints)||this._createDataPlots(i))}static _getLineStyleString(e){switch(e){case 1:return"azc-chart-lineStyleDotted";case 2:return"azc-chart-lineStyleDashed";case 3:return"azc-chart-lineStyleTrendline";case 4:return"azc-chart-lineStyleUsageThreshold";case 5:return"azc-chart-lineStyleWarningThreshold";default:return"azc-chart-lineStyleSolid"}}_createLineString(e){let t,s=[];switch(this._seriesBase.type()){case 1:s=[0,1],t=this._createHorizontalLine(this._seriesBase.value());break;case 2:s=[0,1],t=this._createVerticalLine(this._seriesBase.value());break;case 0:case 3:t=this._createGeneralLine(e),s=this._getChartItemArray()}return t?t(s):null}}e.LineChartSeriesViewImpl=s;class a extends i.ChartViewImpl{constructor(e){super(),this._viewClass="azc-chart-view-line",this._view=e}dispose(){this.element.selectAll("path").on("click",null).on("mouseover",null).on("mouseleave",null),super.dispose()}_createSeriesViewImpl(e,t,i){return new s(this,e,t,i)}}e.LineChartViewImpl=a}(r||(r={})),r})),
define("Viva.Controls/Controls/Visualization/Viva.ScatterChartViewImpl",["require","exports","Viva.Controls/Controls/Visualization/Viva.ChartBase","Viva.Controls/Controls/Visualization/Viva.ChartViewImpl","Viva.Controls/Util/Viva.Util"],(function(e,t,s,i,a){"use strict";var r;return function(e){MsPortalFx.ViewModels.Controls.Visualization.Chart;class t extends i.SeriesViewImpl{constructor(e,t,s,i){super(e,t,s,i),this._touchPointRadiusAddition=1,this._hoveredPointRadiusAddition=7,this._selectedPointRadiusAddition=4}_renderSeries(){const e=this._createSeriesElement(),t=this._createDataPlots(e);t&&(this._seriesView&&this._seriesView.showTooltip()&&this._addTooltips(t),e.classed("azc-scatterChart-series",!0),this._attachSeriesComputeds(e),this._applyRenderingConditions(e,e))}_renderTooltips(){}}e.ScatterChartSeriesViewImpl=t;class s extends i.ChartViewImpl{constructor(e){super(),this._viewClass="azc-chart-view-scatter",this._view=e}_createSeriesViewImpl(e,s,i){return new t(this,e,s,i)}}e.ScatterChartViewImpl=s}(r||(r={})),r})),
define("Viva.Controls/Controls/Visualization/Viva.StackedAreaChartViewImpl",["require","exports","_oss/d3","Viva.Controls/Controls/Visualization/Viva.ChartBase","Viva.Controls/Util/Viva.Hatching","Viva.Controls/Controls/Visualization/Viva.StackedChartViewImpl","Viva.Controls/Controls/Visualization/Viva.ChartViewImpl","Viva.Controls/Util/Viva.Util","FxInternal/Css","_generated/Less/Viva.Controls/Controls/Visualization/Viva.SvgBase.css","_generated/Less/MsPortalImpl.Controls/Controls/Visualization/ChartColor.css"],(function(e,t,s,i,a,r,n,o,c,l,h){"use strict";var d;return(0,c.injectCss)(l,h),function(e){MsPortalFx.ViewModels.Controls.Visualization.Chart;const t="azc-svg-style-fill",o="azc-chart-series-selected",c="azc-stackedAreaChart-not-selected",l="azc-stackedAreaChart-series",h="."+l,d="azc-stackedAreaChart-series-group",u=".azc-stackedAreaChart-series-group",p="azc-stackedLineChart-series",m="."+p,_="azc-stackedLineChart-series-group",x=".azc-stackedLineChart-series-group";class g extends r.StackedChartSeriesViewImpl{_attachAreaSeriesComputeds(e){this._viewImpl._attachSeriesComputeds(e,this._seriesViewIndex,this._seriesView,!1)}_attachLineSeriesComputeds(e){const t=this.renderLifetimeManager;ko.computed(t,(()=>{1!==this._viewImpl._view.lineState()&&this._createSelectedPlots(e)})),ko.computed(t,(()=>{1!==this._viewImpl._view.lineState()&&this._createHover(e)})),this._viewImpl._attachSeriesComputeds(e,this._seriesViewIndex,this._seriesView)}}e.StackedAreaChartSeriesViewImpl=g;class v extends r.StackedChartViewImpl{constructor(e){super(e),this._view=e,this._viewClass="azc-chart-view-stackedArea"}init(e){super.init(e),this._initializeChartData(),this._render()}dispose(){this.element.selectAll(h).selectAll("."+t).on("click",null).on("mouseover",null).on("mouseleave",null),this.element.selectAll(m).selectAll("."+t).on("click",null).on("mouseover",null).on("mouseleave",null),super.dispose()}_initializeChartData(){if(this._getNumberOfSeriesView()<=0)return this.element.selectAll(h).remove(),void(this._layers=null);super._initializeChartData()}_render(){const e=this.yAxes[0];this._disposeRenderDisposables(),e.internalMin(0),e.internalMax(this._yStackMax),this._createStackedAreas(0,e),ko.computed(this.renderLifetimeManager,(()=>{this.element.selectAll(m).remove();const t=this._view.lineState();1!==t&&this._createStackedLines(0,e,t)}))}_createStackedAreas(e,i){const r=this._getStackedAreaShape(e),p=this;let m=!1;this._layers?(this.element.selectAll(h).remove(),this.element.selectAll(h).data(this._layers).enter().append("g").attr("class",((e,t)=>[l,e.cssClass,d+t].join(" "))).append("path").attr("d",(e=>r(e))).attr("class",t).on("mousemove",(()=>{m&&this.mouseMoveHandler()})).on("mouseenter",((e,t)=>{const s=p.isHoverHandled=m=!0;p.isHoverHandled=!1,p.seriesViewImpls[t]._eventHandlerWrapper("seriesmouseover",null),p._setStackedAreaSeriesHover(p.element.select(u+t),t,s),p._setStackedLineSeriesHover(p.element.select(x+t),s)})).on("mouseleave",((e,t)=>{const s=p.isHoverHandled=m=!1;p.seriesViewImpls[t]._eventHandlerWrapper("seriesmouseleave",null),p._setStackedAreaSeriesHover(p.element.select(u+t),t,s),p._setStackedLineSeriesHover(p.element.select(x+t),s)})).on("click",(function(e,t){const i=p.element.select(x+t);p.seriesViewImpls[t]._toggleSeriesSelection(null),p.seriesViewImpls[t]._eventHandlerWrapper("seriesclick",null),-1!==this.parentNode.getAttribute("class").indexOf(o)?(p._setStackedLineSeriesHover(i,!0),p._setStackedLineSeriesSelected(i,!0),s.select(this.parentNode).classed(c,!1),i.classed(c,!1)):(p._setStackedLineSeriesHover(i,!1),p._setStackedLineSeriesSelected(i,!1)),p._markNotSelected()})).each((function(e,i){const r=p.seriesViewImpls[i],o=r&&r._seriesView,c=o&&ko.unwrap(o.areaHatchingPattern);r&&(r._attachAreaSeriesComputeds(s.select(this.parentNode)),c&&a.renderHatching(c,n.ChartViewImpl._getCssClass(r._seriesIndex,o),t,s.select(this),p.element))}))):this.element.selectAll(h).remove()}_getStackedAreaShape(e){return s.svg.area().x((t=>this._getScreenX(e,t.x))).y0((t=>this._getScreenY(e,t.y0-t.y))).y1((t=>this._getScreenY(e,t.y0)))}_createStackedLines(e,i,a){const r=this,n=this._getStackedLinesShape(e);let l=!1;this._layers?(this.element.selectAll(m).remove(),this.element.selectAll(m).data(this._layers).enter().append("g").attr("class",((e,t)=>[p,e.cssClass,_+t].join(" "))).append("path").attr("d",(e=>n(e))).attr("class",t).on("mousemove",((e,t)=>{l&&this.mouseMoveHandler()})).on("mouseenter",(function(e,t){const i=r.isHoverHandled=l=!0;r.isHoverHandled=!1,r._setStackedLineSeriesHover(s.select(this.parentNode),i),r._setStackedAreaSeriesHover(r.element.select(u+t),t,i)})).on("mouseleave",(function(e,t){const i=r.isHoverHandled=l=!1;-1===this.parentNode.getAttribute("class").indexOf(o)&&(r._setStackedLineSeriesHover(s.select(this.parentNode),i),r._setStackedAreaSeriesHover(r.element.select(u+t),t,i))})).on("click",(function(e,t){const i=r.element.select(u+t);r.seriesViewImpls[t]._toggleSeriesSelection(null),r.seriesViewImpls[t]._eventHandlerWrapper("seriesclick",null),-1!==this.parentNode.getAttribute("class").indexOf(o)?(r._setStackedLineSeriesHover(i,!0),r._setStackedLineSeriesSelected(i,!0),s.select(this.parentNode).classed(c,!1),i.classed(c,!1)):(r._setStackedLineSeriesHover(i,!1),r._setStackedLineSeriesSelected(i,!1)),r._markNotSelected()})).each((function(e,t){const i=r.seriesViewImpls[t];i&&i._attachLineSeriesComputeds(s.select(this.parentNode))})),0===a&&this._createStackedLinePlots(e,i)):this.element.selectAll(m).remove()}_getStackedLinesShape(e){return s.svg.line().x((t=>this._getScreenX(e,t.x))).y((t=>this._getScreenY(e,t.y0)))}_setStackedAreaSeriesHover(e,t,s){const a=this.seriesViewImpls[t]._seriesView;let r;a&&!a.hoverable()||(e.classed("azc-chart-series-hovered",s),s?(r=new i.SeriesId,r.chartViewIndex(this.seriesViewImpls[t]._viewImpl.chartViewIndex),r.seriesViewIndex(this.seriesViewImpls[t]._seriesViewIndex),this.options.hoveredID([r])):this.options.hoveredID([]))}_setStackedLineSeriesHover(e,t){e.classed("azc-stackedLineChart-series-hover",t)}_setStackedLineSeriesSelected(e,t){e.classed(o,t)}_createStackedLinePlots(e,t){const i=this;this.element.selectAll(m).each((function(e,t){const a=i.seriesViewImpls[t];a&&a._createDataPlots(s.select(this))}))}_transformPlotValues(e,t){let s;const a=[];let r,n,o,c;return e&&e.length>0&&(this._layers&&(n=MsPortalFx.find(this._layers,(e=>e.seriesViewIndex===t))),n&&(o=MsPortalFx.find(e,(e=>!!e.xValue)).xValue instanceof Date,c=o?function(e){return s.yValue===e.originalY&&Number(s.xValue)===Number(e.originalX)}:function(e){return s.yValue===e.originalY&&s.xValue===e.originalX},e.forEach(((e,t)=>{s=e;const o=MsPortalFx.find(n,c);o&&(r=new i.StackedChartItem(o.originalX,o.originalY,o.y0),a.push(r))})))),a}_toggleSinglePlotSelection(e){const t=this.element.select(".azc-stackedLineChart-series-group"+e),s=this.element.select(".azc-stackedAreaChart-series-group"+e);let i=!1;this.options.seriesSelections().forEach((t=>{e===t.seriesViewIndex()&&(i=!0)})),s&&t&&(i&&(t.classed(c,!1),t.classed(o,!0),s.classed(c,!1),s.classed(o,!0)),this._markNotSelected())}_markNotSelected(){this.element.selectAll("."+o)[0].length>0?this.element.selectAll(":not(."+o+")").classed(c,!0):this.element.selectAll("."+c).classed(c,!1)}_createSeriesViewImpl(e,t,s){return new g(this,e,t,s)}}e.StackedAreaChartViewImpl=v}(d||(d={})),d})),
define("_generated/Less/Viva.Controls/Controls/Visualization/Viva.Chart.css",["module"],(function(e){"use strict";return{css:".azc-chartBase .azc-chart-axis{pointer-events:none}.azc-chartBase .azc-chart-axis .azc-chart-axis-x text,.azc-chartBase .azc-chart-axis .azc-chart-axis-y text,.azc-chartBase .azc-chart-axis .azc-chart-secondary-axis-x text,.azc-chartBase .azc-chart-axis .azc-chart-secondary-axis-y text{font-size:10px;stroke-width:0}.azc-chartBase .azc-chart-axis .azc-chart-axis-x .azc-chart-axis-caption{text-anchor:middle}.azc-chartBase .azc-chart-axis .azc-chart-axis-y .azc-chart-axis-caption{text-anchor:end}.azc-chartBase .azc-chart-axis .azc-chart-axis-x path,.azc-chartBase .azc-chart-axis .azc-chart-axis-x line{fill:none;shape-rendering:crispEdges;stroke-width:1px}.azc-chartBase .azc-chart-axis .azc-chart-axis-y path,.azc-chartBase .azc-chart-axis .azc-chart-axis-y line{fill:none;shape-rendering:crispEdges;stroke-width:1px}.azc-chartBase .azc-chart-axis .azc-chart-secondary-axis-x path,.azc-chartBase .azc-chart-axis .azc-chart-secondary-axis-x line{fill:none;shape-rendering:crispEdges;stroke-width:1px}.azc-chartBase .azc-chart-axis .azc-chart-secondary-axis-y path,.azc-chartBase .azc-chart-axis .azc-chart-secondary-axis-y line{fill:none;shape-rendering:crispEdges;stroke-width:1px}.azc-chartBase .azc-chart-axis .azc-chart-area-border-line{stroke-width:1px;stroke:#dcdfe2}.azc-chartBase .azc-chart-axis .azc-chart-axis-hidden-line path{stroke-width:0}.azc-chartBase .azc-chart-axis .azc-chart-axis-hidden-ticks .azc-chart-axis-tick-line{stroke-width:0}.azc-chartBase .azc-chart-axis .azc-chart-axis-ticks .azc-chart-axis-tick-line{stroke-width:1px}.azc-chartBase .azc-chart-background{stroke-width:0;fill-opacity:0}.azc-chartBase .azc-chart-axis-gridline{stroke-width:1px;pointer-events:none}.azc-chartBase .azc-chart-data:not(.azc-chart-noninteractive),.azc-chartBase .azc-chart-background:not(.azc-chart-noninteractive){pointer-events:all}.azc-chartBase.azc-chart-help-overlay{filter:grayscale(100%)}.azc-chartBase.azc-chart-help-overlay>*{opacity:.45}.azc-chartBase.azc-chart-help-overlay .azc-chart-help-container{opacity:.97}.azc-chartBase .azc-chart-help-content{padding:15px 10px;width:calc(100% - 40px);text-align:center;border-width:1px;border-style:solid}.azc-chartBase .azc-chart-help-content span{display:block}.azc-chartBase .azc-chart-help-container{position:absolute;z-index:100;height:100%;width:100%;display:flex;align-items:center;justify-content:center;top:0;left:0}.azc-chart{text-rendering:optimizeLegibility}.azc-chart path{stroke-width:2}.azc-chart svg g.azc-lineChart-series path{fill:none !important}.azc-chart .azc-chart-noDataMessage{text-anchor:middle}.azc-chart .azc-chart-view-line .azc-chart-lineStyleSolid{fill:none;stroke-dasharray:none;transition:opacity .2s ease-in-out}.azc-chart .azc-chart-view-line .azc-chart-lineStyleDotted{stroke-dasharray:3,3}.azc-chart .azc-chart-view-line .azc-chart-lineStyleDashed{stroke-dasharray:10,5}.azc-chart .azc-chart-view-line .azc-chart-lineStyleWarningThreshold{stroke-width:1px;stroke-dasharray:3,3}.azc-chart .azc-chart-view-line .azc-chart-lineStyleUsageThreshold{stroke-width:1px}.azc-chart .azc-chart-view-line .azc-chart-lineStyleTrendline{stroke-width:2px;opacity:.7;stroke-dasharray:4,4}.azc-chart .azc-chart-view-line .azc-chart-callout{text-anchor:middle}.azc-chart .azc-chart-view-line .azc-chart-tooltip-circle{fill:none;stroke:none}.azc-chart .azc-chart-view-area{fill-opacity:.6}.azc-chart .azc-chart-view-area path{stroke-width:0;transition:opacity .2s ease-in-out}.azc-chart .azc-chart-view-area pattern.azc-hatchingPatternStyle rect.azc-hatching-pattern-bg{stroke:#fff !important;fill:#fff !important;stroke-width:0}.azc-chart .azc-chart-view-area pattern.azc-hatchingPatternStyle rect.azc-hatching-pattern-top{stroke-width:1}.azc-chart .azc-chart-view-area pattern.azc-hatchingPatternStyle line{stroke:#fff !important;fill:#fff !important;stroke-width:1px;opacity:.3}.azc-chart .azc-chart-view-area .azc-chart-callout{text-anchor:middle}.azc-chart .azc-chart-view-area .azc-chart-tooltip-circle{fill:none;stroke:none}.azc-chart .azc-chart-view-scatter .azc-chart-tooltip-circle{fill:none;stroke:none}.azc-chart .azc-chart-view-scatter .azc-chart-callout{text-anchor:middle}.azc-chart .azc-chart-view-scatter .azc-chart-hovered-circle{fill:none;stroke-width:2px}.azc-chart .azc-chart-view-scatter .azc-chart-selected-circle{opacity:.8}.azc-chart .azc-chart-view-bar .azc-barChart-series .azc-barChart-bar-positive{fill:#4682b4 !important;stroke:#4682b4 !important}.azc-chart .azc-chart-view-bar .azc-barChart-series .azc-barChart-bar-negative{fill:#f00 !important;stroke:#f00 !important}.azc-chart .azc-chart-view-bar .azc-barChart-series rect{transition:opacity .2s ease-in-out}.azc-chart .azc-chart-view-bar .azc-barChart-bar-focus-outer{stroke:#fff;stroke-width:3px;fill:none;pointer-events:none}.azc-chart .azc-chart-view-bar .azc-barChart-bar-focus-inner{stroke:#000;stroke-width:2px;fill:none;pointer-events:none}.azc-chart .azc-chart-view-bar .azc-barChart-bar-focusHide{visibility:hidden}.azc-chart .azc-chart-view-stackedArea pattern.azc-hatchingPatternStyle rect.azc-hatching-pattern-bg{stroke:#fff !important;fill:#fff !important;stroke-width:0}.azc-chart .azc-chart-view-stackedArea pattern.azc-hatchingPatternStyle rect.azc-hatching-pattern-top{stroke-width:1}.azc-chart .azc-chart-view-stackedArea pattern.azc-hatchingPatternStyle line{stroke:#fff !important;fill:#fff !important;stroke-width:1px;opacity:.3}.azc-chart .azc-chart-view-stackedArea .azc-stackedAreaChart-series .azc-svg-style-fill{opacity:1}.azc-chart .azc-chart-view-stackedArea .azc-stackedAreaChart-series path{stroke-width:0}.azc-chart .azc-chart-view-stackedArea .azc-stackedAreaChart-series.azc-stackedAreaChart-not-selected .azc-svg-style-fill{opacity:.15;transition:opacity .2s ease-in-out}.azc-chart .azc-chart-view-stackedArea .azc-stackedAreaChart-series.azc-stackedAreaChart-not-selected.azc-chart-series-selected .azc-svg-style-fill,.azc-chart .azc-chart-view-stackedArea .azc-stackedAreaChart-series.azc-stackedAreaChart-not-selected.azc-chart-series-hovered .azc-svg-style-fill{opacity:.8}.azc-chart .azc-chart-view-stackedArea .azc-stackedLineChart-series path.azc-svg-style-fill{stroke-width:2px;fill:none;opacity:1}.azc-chart .azc-chart-view-stackedArea .azc-stackedLineChart-series circle.azc-chart-hovered-circle{fill:none;stroke-width:2px}.azc-chart .azc-chart-view-stackedArea .azc-stackedLineChart-series.azc-chart-series-hovered .azc-svg-style-fill,.azc-chart .azc-chart-view-stackedArea .azc-stackedLineChart-series.azc-chart-series-selected .azc-svg-style-fill{stroke-width:3px}.azc-chart .azc-chart-view-stackedArea .azc-stackedLineChart-series.azc-stackedAreaChart-not-selected path.azc-svg-style-fill,.azc-chart .azc-chart-view-stackedArea .azc-stackedLineChart-series.azc-stackedAreaChart-not-selected circle,.azc-chart .azc-chart-view-stackedArea .azc-stackedLineChart-series.azc-stackedAreaChart-not-selected circle.azc-chart-hovered-circle{opacity:.3;transition:opacity .2s ease-in-out}.azc-chart .azc-chart-view-stackedArea .azc-stackedLineChart-series.azc-stackedAreaChart-not-selected.azc-chart-series-selected .azc-svg-style-fill,.azc-chart .azc-chart-view-stackedArea .azc-stackedLineChart-series.azc-stackedAreaChart-not-selected.azc-chart-series-hovered .azc-svg-style-fill{opacity:.8}.azc-chart .azc-chart-view-stackedArea .azc-chart-series-selected .azc-svg-style-fill{opacity:1}.azc-chart .azc-chart-view-stackedArea .azc-chart-series-hovered .azc-svg-style-fill{opacity:.8}.azc-chart.azc-chart-hovered .azc-chart-view-bar .azc-barChart-series:not(.azc-chart-series-selected,.azc-chart-series-hovered) rect,.azc-chart.azc-chart-selected .azc-chart-view-bar .azc-barChart-series:not(.azc-chart-series-selected,.azc-chart-series-hovered) rect{opacity:.3}.azc-chart.azc-chart-hovered .azc-chart-view-bar .azc-barChart-series:not(.azc-chart-series-selected,.azc-chart-series-hovered) rect.azc-chart-item-hovered,.azc-chart.azc-chart-selected .azc-chart-view-bar .azc-barChart-series:not(.azc-chart-series-selected,.azc-chart-series-hovered) rect.azc-chart-item-hovered,.azc-chart.azc-chart-hovered .azc-chart-view-bar .azc-barChart-series:not(.azc-chart-series-selected,.azc-chart-series-hovered) rect.azc-chart-item-selected,.azc-chart.azc-chart-selected .azc-chart-view-bar .azc-barChart-series:not(.azc-chart-series-selected,.azc-chart-series-hovered) rect.azc-chart-item-selected{opacity:1}.azc-chart.azc-chart-hovered .azc-chart-view-area .azc-areaChart-series:not(.azc-chart-series-selected,.azc-chart-series-hovered) .azc-svg-style-fill,.azc-chart.azc-chart-selected .azc-chart-view-area .azc-areaChart-series:not(.azc-chart-series-selected,.azc-chart-series-hovered) .azc-svg-style-fill{fill-opacity:.3}.azc-chart.azc-chart-hovered .azc-chart-view-area .azc-areaChart-series.azc-chart-series-selected .azc-svg-style-fill,.azc-chart.azc-chart-selected .azc-chart-view-area .azc-areaChart-series.azc-chart-series-selected .azc-svg-style-fill,.azc-chart.azc-chart-hovered .azc-chart-view-area .azc-areaChart-series.azc-chart-series-hovered .azc-svg-style-fill,.azc-chart.azc-chart-selected .azc-chart-view-area .azc-areaChart-series.azc-chart-series-hovered .azc-svg-style-fill{fill-opacity:1}.azc-chart.azc-chart-hovered .azc-chart-view-line{transition:opacity .3s}.azc-chart.azc-chart-hovered .azc-chart-view-line .azc-lineChart-series.azc-chart-series-hovered path{stroke-width:3px}.azc-chart.azc-chart-hovered .azc-chart-view-line .azc-lineChart-series.azc-chart-series-hovered .azc-chart-series-hovered-projection{pointer-events:none;stroke-width:2px;opacity:.4}.azc-chart.azc-chart-hovered .azc-chart-view-line .azc-lineChart-series.azc-chart-series-hovered .azc-svg-style-stroke{opacity:1}.azc-chart.azc-chart-selected .azc-chart-view-line{transition:opacity .3s}.azc-chart.azc-chart-selected .azc-chart-view-line .azc-lineChart-series:not(.azc-chart-series-selected,.azc-chart-series-hovered) circle,.azc-chart.azc-chart-selected .azc-chart-view-line .azc-lineChart-series:not(.azc-chart-series-selected,.azc-chart-series-hovered) .azc-svg-style-stroke{opacity:.3}.azc-chart .azc-chart-y-axis-slice{stroke-width:2px;pointer-events:none;opacity:.2}.azc-chart.azc-chart-noninteractive,.azc-chart .azc-chart-noninteractive{pointer-events:none !important}.azc-chart .azc-chart-data:not(.azc-chart-noninteractive) .azc-chart-view-line path{pointer-events:stroke}.azc-chart .azc-chart-data:not(.azc-chart-noninteractive) .azc-chart-view-line .azc-chart-selected-circle,.azc-chart .azc-chart-data:not(.azc-chart-noninteractive) .azc-chart-view-line .azc-chart-hovered-circle{pointer-events:all}.azc-chart .azc-chart-data:not(.azc-chart-noninteractive) .azc-chart-view-line .azc-chart-hovered-circle{fill:none;stroke-width:2px}.azc-chart .azc-chart-data:not(.azc-chart-noninteractive) .azc-chart-view-area path{pointer-events:fill}.azc-chart .azc-chart-data:not(.azc-chart-noninteractive) .azc-chart-view-scatter .azc-chart-hovered-circle{pointer-events:all}.azc-chart .azc-chart-data:not(.azc-chart-noninteractive) .azc-chart-view-scatter .azc-chart-selected-circle{pointer-events:all}.azc-chart .azc-chart-data:not(.azc-chart-noninteractive) .azc-chart-view-stackedArea .azc-stackedAreaChart-series path{pointer-events:fill}.azc-chart .azc-chart-data:not(.azc-chart-noninteractive) .azc-chart-view-stackedArea .azc-stackedLineChart-series path.azc-svg-style-fill{pointer-events:stroke}.azc-chart .azc-chart-data:not(.azc-chart-noninteractive) .azc-chart-view-stackedArea .azc-stackedLineChart-series .azc-chart-selected-circle,.azc-chart .azc-chart-data:not(.azc-chart-noninteractive) .azc-chart-view-stackedArea .azc-stackedLineChart-series .azc-chart-hovered-circle{pointer-events:all}.fxs-mode-dark .azc-chart-view-bar .azc-barChart-bar-focus-outer,.fxs-highcontrast-dark .azc-chart-view-bar .azc-barChart-bar-focus-outer{stroke:#000}.fxs-mode-dark .azc-chart-view-bar .azc-barChart-bar-focus-inner,.fxs-highcontrast-dark .azc-chart-view-bar .azc-barChart-bar-focus-inner{stroke:#fff}",moduleId:e.id}})),
define("Viva.Controls/Controls/Visualization/Viva.Chart",["require","exports","_oss/d3","Viva.Controls/Controls/Visualization/Viva.ChartBase","Viva.Controls/Controls/Visualization/Viva.StackedAreaChartViewImpl","Viva.Controls/Controls/Visualization/Viva.ScatterChartViewImpl","Viva.Controls/Controls/Visualization/Viva.LineChartViewImpl","Viva.Controls/Controls/Visualization/Viva.AreaChartViewImpl","Viva.Controls/Controls/Visualization/Viva.BarChartViewImpl","MsPortalImpl/Base/Base.KeyboardHelper","FxInternal/Css","_generated/Less/Viva.Controls/Controls/Visualization/Viva.Chart.css"],(function(e,t,s,i,a,r,n,o,c,l,h,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Widget=void 0,(0,h.injectCss)(d);var u=MsPortalFx;const p="azc-chart",m="azc-chart-y-axis-slice",_="azc-stroke-heavy";class x extends i.Widget{constructor(e,t,s){let a;(s=s||{}).viewModelType=s.viewModelType||i.ViewModel,super(e,t,s),this._currentViewIndex=0,this._navigationStarted=!1,this._chartDataImmediateUpdatedCounter=0,this._internalViewImplsArray=[],this.options._seriesHelpers&&this.options._seriesHelpers({getSeriesName:(e,t)=>this.getSeriesName(e,t),getSeriesviewIndex:(e,t)=>this.getSeriesviewIndex(e,t)}),this.element.attr("role","figure").attr("tabindex",0).addClass(p),this.ltm.registerForDispose(this.element.setEvents(["focusin",e=>{this.element.find(".azc-chart-series-live").attr("aria-live","polite"),this.element.find(".azc-chart-item-live").attr("aria-live","polite")}],["focusout",e=>{this.element.find(".azc-chart-series-live").attr("aria-live","off"),this.element.find(".azc-chart-item-live").attr("aria-live","off"),this._updateFocus()}],["keydown",e=>{this._handleKeyboardEvents(e,{seriesLiveData:this._seriesLiveData,chartItemLiveData:this._chartItemLiveData})}]));const r=this._disposables;let n;this.options.enableTrackXSlider.subscribe(r,a=e=>{n&&n.dispose();const t=this.options.seriesHovers;e?(t.hoversDelayed||(t.hoversDelayed=!0,t.extend({rateLimit:100,method:"notifyWhenChangesStop"})),n=r.createChildLifetime(),this._xSliceHoverTrackComputed=ko.computed(n,(()=>{this.options.xSliderCoordinate(this._getXSliderCoordinate())})),this._xSliderCoordinateSubscription=this.options.xSliderCoordinate.subscribe(n,(e=>{const t=this._getXSliderCoordinate();null!==e&&e!==t&&this._renderXSliceHover(e),null===e&&e!==t&&(this._cleanXSliceHover(),this._getXSliderCoordinate(null))}))):(this.options.xSliderCoordinate(null),t.hoversDelayed&&(t.hoversDelayed=!1,t.extend({rateLimit:0})))}),this._chartDataImmediateUpdated=ko.computed(r,(()=>(this._checkForChartUpdate(),this._chartDataImmediateUpdatedCounter=this._chartDataImmediateUpdatedCounter+1&4095))),this._chartDataImmediateUpdated.subscribe(r,(()=>{this._internalSeriesIndexDictionary=null,this._internalViewImplsArrayIsCurrent=!1})),ko.computed(r,(()=>{this._xSliderOn()||(this._cleanXSliceHover(),this._getXSliderCoordinate(null))})),a(this.options.enableTrackXSlider()),this._init()}dispose(){this._checkExistsOrRegisterDestroyId(super.dispose)||(super.dispose(),this._internalViewImplsArray&&this._internalViewImplsArray.length>0&&(this._internalViewImplsArray.forEach((e=>{e.dispose()})),this._internalViewImplsArray=[]),this._xSliceHoverTrackComputed&&(this._xSliceHoverTrackComputed.dispose(),this._xSliceHoverTrackComputed=null,this._xSliderCoordinateSubscription.dispose(),this._xSliderCoordinateSubscription=null),this._cleanup(),this._internalSeriesIndexDictionary=null,this._cleanElement(p))}get options(){return this._options}toggleSeriesSelection(e,t,s){this._viewImplsArray[e].toggleSeriesSelection(t,s)}getSeriesName(e,t){const s=this._viewImplsArray[e];return s&&s.seriesViewImpls[t]?s.seriesViewImpls[t]._seriesName:null}getSeriesviewIndex(e,t){const s=this._viewImplsArray[e];let i=0;if(s&&s.seriesViewImpls.length){for(let e=0;e<s.seriesViewImpls.length;e++)if(s.seriesViewImpls[e]._seriesName===t){i=e;break}return i}return 0}getSeriesIndexForSeriesViewIndex(e,t){const s=this._viewImplsArray[e];return s&&s.seriesViewImpls[t]?s.seriesViewImpls[t]._seriesIndex:null}_getSeriesViewsForSeriesIndex(e,t){return this._viewImplsArray[e].seriesViewImpls.filter((e=>e._seriesIndex===t))}setSeriesHover(e,t,s,i){const a=this._viewImplsArray[e];if(a){const e=a.seriesViewImpls[t];e&&e.setSeriesHover(s,i)}}getSeriesIndexBySeriesName(e){return this._seriesIndexDictionary[e]}getXAxisIndexBySeriesIndex(e){return this._mappedXAxisIndex[e]}getYAxisIndexBySeriesIndex(e){return this._mappedYAxisIndex[e]}_renderXSliceHover(e){if(this._xSliderOn()&&!this._inRenderXSliceHover){this._inRenderXSliceHover=!0;const t=this._viewImplsArray.some((e=>e.isHoverHandled));this._getXSliderCoordinate(e),this._renderXSlice(e,t),t||this._createXAxisSliceHover(e),this._inRenderXSliceHover=!1}}_cleanXSliceHover(e){this._xSliderSvg&&this._xSliderSvg.style("display","none"),e||this.options.seriesHovers([])}_init(){this._render()}_render(){this._checkForNoData(),this._internalSeriesIndexDictionary||this._immediateSeriesUpdated(),this._internalViewImplsArrayIsCurrent||this._reInitViewImplArray()}_onChartDataUpdated(){super._onChartDataUpdated(),this._render()}_onChartSizeUpdated(){this._internalViewImplsArrayIsCurrent=!1,this._render()}_plotAreaMouseEnter(){this.options.events&&this.options.events.plotAreaMouseEnter&&this._applyWithCoordinates(this.options.events.plotAreaMouseEnter)}_plotAreaMouseMove(){if(this._xSliderOn()&&this.options.disableXSliderMouseout&&this.options.disableXSliderMouseout()){const e=this._getCoordinates()[0];this._getXSliderCoordinate(e),this._renderXSlice(e,!0)}}_plotAreaMouseLeave(){this.options.events&&this.options.events.plotAreaMouseLeave&&this._applyWithCoordinates(this.options.events.plotAreaMouseLeave)}_plotAreaClick(){this.options.events&&this.options.events.plotAreaClick&&this._applyWithCoordinates(this.options.events.plotAreaClick)}_cleanup(){this._chartSvg.selectAll(".azc-chart-callout").remove(),this._chartSvg.selectAll(".azc-chart-viewBox").remove(),this._internalViewImplsArray&&this._internalViewImplsArray.forEach((e=>{e.element.remove(),e.dispose()})),this._internalViewImplsArray=[],this._internalViewImplsArrayIsCurrent=!1}_checkForChartUpdate(){const e=this._options.views();return super._checkForChartUpdate(),this._yAxes().forEach((e=>{e.checkForUpdate()})),this._xAxes().forEach((e=>{e.checkForUpdate()})),e&&e.length>0&&e.forEach((e=>{switch(e.chartType()){case 0:e.seriesView().forEach((e=>{ko.unwrap(e.interpolation),ko.unwrap(e.lineStyle),ko.unwrap(e.showDataPoints),x._checkForUpdateSeriesView(e)}));break;case 4:case 3:case 5:e.seriesView().forEach((e=>{x._checkForUpdateSeriesView(e)}));break;case 1:e.seriesView().forEach((e=>{ko.unwrap(e.interpolation),ko.unwrap(e.areaHatchingPattern),x._checkForUpdateSeriesView(e)}));break;case 6:e.seriesView().forEach((e=>{ko.unwrap(e.interpolation),ko.unwrap(e.areaHatchingPattern),x._checkForUpdateSeriesView(e)}));break;case 2:e.seriesView().forEach((e=>{ko.unwrap(e.radius),x._checkForUpdateSeriesView(e)}));break}})),!0}get _getXSliderCoordinate(){let e=this._xSliceHoverCoordinate;return e||(this._xSliceHoverCoordinate=e=ko.observable(null)),e}_mouseMoveHandler(){this._renderXSliceHover(this._getCoordinates()[0])}_mouseOutHandler(e){if(this._xSliderOn()){let t,s=!this.options.disableXSliderMouseout||!this.options.disableXSliderMouseout();const i=$(e.target).closest(".azc-chart-canvas");i.length>0&&(t=$.contains(i[0],e.relatedTarget),t&&(s=!0)),s&&(t?this._getXSliderCoordinate(this._getCoordinates()[0]):(this._cleanXSliceHover(),this._getXSliderCoordinate(null)))}}_updateFocus(){const e=this._internalViewImplsArray.length;if(!e)return this._navigationStarted=!1,void(this._currentViewIndex=0);for(let t=0;t<e;t++)this._internalViewImplsArray[t]._updateFocus(-1)}_handleKeyboardEvents(e,t){const s=l.getModifierKeys(e),i=l.isCtrlOrCommandOnly(e),a=this._internalViewImplsArray.length,r=e=>{this._currentViewIndex>=e&&(this._currentViewIndex=0,this._navigationStarted=!0)},n=e=>{e.preventDefault(),e.stopPropagation()};if(!a)return this._navigationStarted=!1,void(this._currentViewIndex=0);if(0===s){switch(e.which){case 27:this._showHelp(!1),this._navigationStarted=!1,this._currentViewIndex=0;for(let s=0;s<a;s++)this._internalViewImplsArray[s]._handleKeyboardEvents(e,t);this.options.hoveredID([]),this.options.seriesHovers([]),this.options.seriesSelections([]);break;case 32:case 37:case 39:this._navigationStarted=!0,r(a),this._internalViewImplsArray[this._currentViewIndex]._handleKeyboardEvents(e,t);break;case 112:this._showHelp(!0);break;default:return}n(e)}else!i||38!==e.which&&40!==e.which?i&&32===e.which&&(r(a),this._internalViewImplsArray[this._currentViewIndex]._handleKeyboardEvents(e,t),n(e)):(this._navigationStarted?38===e.which?this._viewImplsArray[this._currentViewIndex]._canNavigateSeries(38)||(this._viewImplsArray[this._currentViewIndex]._updateFocus(-1),this._currentViewIndex=++this._currentViewIndex%a):this._viewImplsArray[this._currentViewIndex]._canNavigateSeries(40)||(this._viewImplsArray[this._currentViewIndex]._updateFocus(-1),this._currentViewIndex=--this._currentViewIndex<0?a-1:this._currentViewIndex%a):this._navigationStarted=!0,r(a),this._internalViewImplsArray[this._currentViewIndex]._handleKeyboardEvents(e,t),n(e))}get _seriesIndexDictionary(){return this._internalSeriesIndexDictionary||this._immediateSeriesUpdated(),this._internalSeriesIndexDictionary}get _viewImplsArray(){return this._internalViewImplsArrayIsCurrent||this._reInitViewImplArray(),this._internalViewImplsArray}_immediateSeriesUpdated(){this._internalSeriesIndexDictionary=x._createSeriesDictionary(this.options.series())}_reInitViewImplArray(){let e;const t=this._options,s=t.views();if(this._cleanup(),this._mapSeriesToAxis(),this._internalViewImplsArrayIsCurrent=!0,s&&s.length>0){const i=this._width(),l=this._height(),h=this._chartSvg.append("svg").attr({top:0,left:0,width:i,height:l,viewBox:"0 0 "+i+" "+l,class:"azc-chart-viewBox"});s.forEach(((s,d)=>{switch(s.chartType()){case 0:e=new n.LineChartViewImpl(s);break;case 1:e=new o.AreaChartViewImpl(s);break;case 6:e=new a.StackedAreaChartViewImpl(s);break;case 3:case 4:case 5:e=new c.BarChartViewImpl(s);break;case 2:e=new r.ScatterChartViewImpl(s);break;default:throw new Error("The view type is not specified.")}this._internalViewImplsArray.push(e),e.chartViewIndex=d,e.options=t,e.height=l,e.width=i,e.xAxes=this._xAxes(),e.yAxes=this._yAxes(),e.mappedXAxisIndex=this._mappedXAxisIndex,e.mappedYAxisIndex=this._mappedYAxisIndex,e.seriesIndexDictionary=e=>this.getSeriesIndexBySeriesName(e),e.isHorizontalChart=this._isHorizontalChart(),e.element=h.append("g").attr("class","azc-chart-view"),e.mouseOutHandler=()=>{this._mouseOutHandler()},e.mouseMoveHandler=()=>{this._mouseMoveHandler()},e.init(this.ltm)}))}}static _checkForUpdateSeriesView(e){e.cssClass(),e.tooltipFormatter(),e.showTooltip(),x._checkForUpdateDataLabels(e.dataLabels()),x._checkForUpdateRenderingConditions(e.renderingConditions())}static _checkForUpdateDataLabels(e){e.forEach((e=>{e.context(),e.formatter(),e.style()}))}static _checkForUpdateRenderingConditions(e){e.forEach((e=>{e.seriesName(),e.conditionOperator(),e.interpolation()}))}_applyWithCoordinates(e){const t=this._getCoordinates(),s=this.getAxisInfoProvider(0),i=this.getAxisInfoProvider(1);e(t[0],t[1],s._getAxisValue(t[0]),i._getAxisValue(t[1]))}_getCoordinates(e){const t=e||this._chartSvg.node(),i=s.mouse(t);return this._isHorizontalChart()?i.reverse():i}_checkForNoData(){const e=this._options.series();e&&0!==e.length?this._axisElement.attr("display",null):this._axisElement.attr("display","none")}static _createSeriesDictionary(e){const t={};return(e||[]).forEach(((e,s)=>{e.name()&&(t[e.name()]=s)})),t}_renderXSlice(e,t){if(this._xSliderOn()){this._cleanXSliceHover(t);const i=[0,1],a=s.svg.line().x((t=>this._isHorizontalChart()?t?this._width():0:e)).y((t=>this._isHorizontalChart()?e:t?this._height():0));this._xSliderSvg||(this._xSliderSvg=this._chartSvg.append("path"),this._xSliderSvg.attr({class:[m,_].join(" ")})),this._xSliderSvg.attr({d:a(i)}).style("display",null)}}_createXAxisSliceHover(e){if(!u.isNullOrUndefined(e)){let t,s=new Array;const i=this.options.xSliderFilterHoverThreshold&&this.options.xSliderFilterHoverThreshold();i&&i<.5&&i>0&&(t=this._width()*i),this._viewImplsArray.forEach((i=>{s=s.concat(i.getXSliceSeriesSubset(e,t))})),this.options.seriesHovers(s)}}}t.Widget=x})),
define("_generated/Less/MsPortalImpl.Controls/Controls/Visualization/Chart.css",["module"],(function(e){"use strict";return{css:'.fxc-chart{position:relative}.fxc-chart .fxc-chart-graph-and-legend{width:100%;white-space:nowrap}.fxc-chart .fxc-chart-graph-and-legend text{font-family:az_ea_font,"Segoe UI",az_font,system-ui,-apple-system,BlinkMacSystemFont,Roboto,Oxygen,Ubuntu,Cantarell,"Open Sans","Helvetica Neue",sans-serif;font-weight:400}.fxc-chart .fxc-chart-graph-area{display:inline-block;vertical-align:top}.fxc-chart .fxc-chart-graph-area.fxc-chart-hasOverlay:focus{outline-color:#000}.fxc-chart .fxc-chart-legend-area-container{height:100%;min-width:100px;display:inline-block;vertical-align:top}.fxc-chart .fxc-chart-legend-area{width:calc(100% - 12px);height:calc(100% - 2px);padding:0 2px 0 10px;margin-top:-4px;display:inline-block;vertical-align:top}.fxc-chart .azc-metrics{padding:5px 10px 0}',moduleId:e.id}})),
define("MsPortalImpl.Controls/Controls/Visualization/Chart",["require","exports","_oss/d3","Fx/Controls/Legend","Viva.Controls/Controls/Visualization/Viva.ChartBase","MsPortalImpl.Controls/Controls/Visualization/ChartViewModelConversionHelper","MsPortalFx/Globalization","MsPortalImpl.Controls/Controls/Base/Loadable","MsPortalImpl/Resources/ImplScriptResources","Viva.Controls/Controls/Visualization/Viva.Chart","Viva.Controls/Util/Viva.Resize","Viva.Controls/Util/Viva.Util","MsPortalImpl/Controls/Helpers/LoadingAndNoData","MsPortalImpl/Base/Base.Timers","Viva.Controls/Controls/Visualization/Viva.ChartUtil","FxInternal/Css","_generated/Less/Viva.Controls/Controls/Visualization/Viva.SvgBase.css","_generated/Less/MsPortalImpl.Controls/Controls/Visualization/Chart.css","_generated/Less/MsPortalImpl.Controls/Controls/Visualization/ChartColor.css","MsPortalImpl/Interactions/Interactions.PortalReader"],(function(e,t,s,i,a,r,n,o,c,l,h,d,u,p,m,_,x,g,v,w){"use strict";var f;return(0,_.injectCss)(x,g,v),function(e){var t=FxImpl.TriggerableLifetimeManager,_=MsPortalFx.ViewModels.Controls,x=_.DockedBalloon,g=_.Visualization,v=g.Chart.ViewModel,f=g.Metrics,S=MsPortalFx.isNullOrUndefined,C=MsPortalFx.UnitConversionUtil;const z=c.Chart,k="fxc-chart";MsPortalFx.isDevelopmentMode;function b(e,t){return S(e)?null:parseInt(e.split("_")[t])}function y(e){return b(e,1)}function I(e){return b(e,0)}function V(e){return e.yValue}function A(e){return e.xValue}function M(e,t){return MsPortalFx.find(t,(t=>!e||t.name()===e))}const D=(()=>{const e=function(e,t){return function(s){return e(s,t)}},t=function(e,t){const s=MsPortalFx.last(e);return s&&t?t(s):s};return[e(t,A),e(t,V),e(s.min,V),e(s.max,V),e(s.mean,V),e(s.sum,V),function(e){return e.length}]})();function F(e){return C.Unit[MsPortalFx.UnitConversion.Unit[e]]}class L extends o.Widget{constructor(e,s,i){if(97===s.controlType){const a=new t,n=new v(a);super(e,n,$.extend({fillBehavior:3},i)),this._convertedChartLtm=a,new r.ChartViewModelConversionHelper(s,n,this.ltm)}else super(e,s,$.extend({fillBehavior:3},i));this._announce=new w.PortalReader(this.ltm,{idPrefix:"chart"}),this._nestedLegendViewModel=ko.observable(),this._isResizing=!1,this._defaultNumberFormatter=n.NumberFormat.create({minimumFractionDigits:0,maximumFractionDigits:2}),this._initializeWidgets()}get options(){return this._options}dispose(){this._checkExistsOrRegisterDestroyId(super.dispose)||(this._convertedChartLtm&&this._convertedChartLtm.dispose(),super.dispose(),this._cleanElement(k))}_initializeWidgets(){this._sizeAllowMetricsToShow=ko.observable(!0),this._sizeAllowLegendToShow=ko.observable(!1),this._sizeBasedXTicks=ko.observable(0),this._sizeBasedYTicks=ko.observable(0);const e=this.element,t=this.options,s=this.ltm,r=this._nestedChartGraphViewModel=new a.ViewModel(this.vmBasicOption);r.populateFromObject(t),r.height=ko.observable(0),r.width=ko.observable(0),r.ariaLabel=t.ariaLabel,r.ariaDesc=t.ariaDesc,r._seriesHelpers=t._seriesHelpers||ko.observable();const n=(e,t)=>e+"_"+t;ko.computed(s,(()=>{r.views().forEach((e=>{e.seriesView().forEach((e=>{e.cssClass()||e.cssClass(this._generateCssClassNameFromSeriesName(e.seriesName()))}))}))}));let o,c;(this._showLegend=ko.computed(s,(()=>this._sizeAllowLegendToShow()&&0!==t.legendPosition()))).subscribeAndRun(s,(e=>{if(e){if(!o||o.isDisposed()){o=s.createChildLifetime();const e=r.seriesSelections.map(o,((e,t)=>n(t.chartViewIndex(),t.seriesViewIndex()))),t=ko.computed(o,(()=>{const e=[];return r.views().forEach(((t,s)=>{const i=t.chartType(),a=1===i||6===i,r=3===i||4===i||5===i||6===i,o=t.seriesView();if(o){const t=o.length-1,i=r?e=>t-e:e=>e;o.forEach(((t,r)=>{t.hideFromLegend()||e.push({cssClass:t.cssClass,selected:ko.observable(!1),seriesName:ko.pureComputed((()=>t.displayName()||t.seriesName())),identity:n(s,i(r)),hatchingPattern:ko.pureComputed((()=>a?ko.unwrap(t.areaHatchingPattern):0))})}))}})),e})),a=MsPortalFx.thunkArray(o,t);a.map(o,((t,s)=>{const i=s;ko.ignoreDependencies((()=>{e.subscribeAndRun(t,(e=>{i.selected(e.indexOf(i.identity)>=0)})),i.selected.subscribeAndRun(t,(t=>{const s=i.identity,a=e().indexOf(s)>=0;if((a&&!t||!a&&t)&&this._savedChartGraphInstance){const e=y(s),a=I(s);this._savedChartGraphInstance.toggleSeriesSelection(a,e,null),this._announce.read(t?z.chartSeriesSelectedUpdated.format(i.seriesName()):z.chartSeriesUnselectedUpdated.format(i.seriesName()))}}))}))}));const c=i.create(o,{itemSetting:{colorKey:"cssClass",indexKey:"identity",selectedKey:"selected",labelKey:"seriesName",hatchingKey:"hatchingPattern"},items:a,hoveredIndex:ko.observable(null)});this._nestedLegendViewModel(c),ko.computed(o,(()=>{const e=c.hoveredIndex();let t,s;this._protectFromCircularHoverUpdate?this._protectFromCircularHoverUpdate=!1:S(e)?r.seriesHovers([]):(t=y(e),s=I(e),this._savedChartGraphInstance.setSeriesHover(s,t,null,!0),this._announce.read(z.chartSeriesHoverUpdated))})),ko.computed(o,(()=>{const e=r.seriesHovers(),t=r.hoveredID();let s,i,a=null;1===e.length?(s=e[0].seriesViewIndex.peek(),i=e[0].chartViewIndex.peek(),a=n(i,s)):1===t.length&&(s=t[0].seriesViewIndex.peek(),i=t[0].chartViewIndex.peek(),a=n(i,s)),c.hoveredIndex.peek()!==a&&(this._protectFromCircularHoverUpdate=!0,c.hoveredIndex(a))}))}}else o&&o.dispose(),this._nestedLegendViewModel(null)})),ko.computed(s,(()=>{this._seriesIndexes={},(r.series()||[]).forEach(((e,t)=>{this._seriesIndexes[e.name()]=t}))})),this._showMetrics=ko.computed(s,(()=>this._sizeAllowMetricsToShow()&&t.metrics.visible()&&t.showMetrics())),r.xAxis.ticks=ko.computed(s,(()=>t.xAxis.ticks()||this._sizeBasedXTicks())),r.yAxis.ticks=ko.computed(s,(()=>t.yAxis.ticks()||this._sizeBasedYTicks())),r.xAxis.unit=ko.computed(s,(()=>F(t.xAxis.unit()))),r.yAxis.unit=ko.computed(s,(()=>F(t.yAxis.unit()))),e.addClass(k).html("<div class='fxc-chart-graph-and-legend' data-bind='visible: !data.loading()'><div class='fxc-chart-graph-area' data-bind='css: { \"fxc-chart-hasOverlay\": data.noData && data.noData()}'></div>\x3c!-- ko if: $ctl._showLegend --\x3e<div class='fxc-chart-legend-area-container'><div class='fxc-chart-legend-area' data-bind='pcLegend: $ctl._nestedLegendViewModel'></div></div>\x3c!-- /ko --\x3e</div>\x3c!-- ko if: $ctl._showMetrics() && !data.loading() --\x3e<div data-bind='pcMetrics: data.metrics'></div>\x3c!-- /ko --\x3e"),this._bindDescendants(),this._graphArea=e.find(".fxc-chart-graph-area"),this._graphAndLegendArea=e.find(".fxc-chart-graph-and-legend");const l=()=>{this._isResizing||this._calculateAndRenderGraph()};this.ltm.registerForDispose(this.element.setEvents(["focusin",e=>{this.options.metrics._msPortalFxAriaLive(!0)}],["focusout",e=>{this.options.metrics._msPortalFxAriaLive(!1)}])),this._showMetrics.subscribe(s,l),t.metrics.size.subscribe(s,l),this._showLegend.subscribe(s,l),t.legendWidth.subscribe(s,l),t.metrics.layout(1);let d,m,_=!0;const x=p.throttleByAnimationFrame(((e,t)=>{s.isDisposed()||this._adjustLayoutBasedOnSize(e||d,t||m)}));ko.computed(s,[t.width,t.height],((e,t)=>{_||x(e,t)})).extend({deferred:!0});const g=(e,t)=>{_=!1,x(d=e,m=t)};h.track(s,e,g),Q.delay(300).then((()=>{_&&g(0,0)}));const v=()=>{s.isDisposed()||(c&&c.dispose(),c=s.createChildLifetime(),this._createMetricsComputed(c))},w=p.throttle(s,v,50);t.series.subscribe(s,w),t.metricsRules.subscribe(s,w),v(),u.setup(this,this.options)}_getSelectedSeriesIndexes(){return this._nestedChartGraphViewModel.seriesSelections().map((e=>this._getSeriesIndexFromSeriesName(this._getSeriesNameFromSeriesId(e)))).filter((e=>null!==e))}_getSeriesSelections(){const e=this.options.seriesSelections();return e&&0!==e.length?e:this.options.seriesHovers()}_createMetricsComputed(e){ko.computed(e,(()=>{const t=this.options;let s=[];const i=t.metricsRules()||[];let a;t.seriesHovers(),t.hoveredID();const r=t.metrics.items.peek();i.length>0?(a=i.filter((e=>this._checkRuleMatch(e,!0))),0===a.length&&(a=i.filter((e=>0===ko.unwrap(e.scope)))),a.forEach((t=>{(ko.unwrap(t.metrics)||[]).forEach((i=>{s=s.concat(this._createMetrics(e,t,i))}))}))):s=r||[],this._updateMetricsViewModelData(e,s)})).extend({rateLimit:30})}_updateMetricsViewModelData(e,t){const s=this.options.metrics.items.peek();let i,a,r;t.length>s.length?this.options.metrics.items(t):s.forEach((function(s,n){r=!1,n>=t.length?s.hide(!0):(s.hide(!1),d.fillObserableFields(t[n],s,["value","unit","caption","barCssClass","showBarColor","hatchingPattern","prioritized","unitAlignment"]),i=ko.unwrap(t[n].infoBalloon),i?(s.hideInfoBalloon(!1),a=ko.unwrap(s.infoBalloon),i!==a&&(a||(a=new x.ViewModel(e),a.type=i.type,r=!0),d.fillObserableFields(i,a,["balloonVisible","content","disabled","link","position"]),(r||a.type!==i.type)&&s.infoBalloon(a))):s.hideInfoBalloon(!0))}))}_createMetrics(e,t,i){const a=[];let r;const n=this.options.hoveredID().map((e=>this._getSeriesNameFromSeriesId(e))),o=ko.unwrap(i.aggregationScope);switch(o){case 2:case 0:{const s=ko.unwrap(t.scope);let c=this._getMetricsRuleActionSeriesIndex(t,i);S(c)&&0===o&&0===s&&(c=this.options.series().length>0?0:null),r=this._createMetric(e,t,i,c,n),r&&a.push(r);break}case 1:{let o=this._getSelectedSeriesIndexes();0===o.length&&(o=s.range(this.options.series().length)),o.forEach((s=>{r=this._createMetric(e,t,i,s,n),r&&a.push(r)}));break}}return a}_createMetric(e,t,s,i,a){const r=this.options.series(),n=ko.unwrap(s.colorCode)||null;let o,c,l,h,u,p,_,g,v=ko.unwrap(s.hatchingPattern),w=null;if(S(i)||0===r.length||i>=r.length)return null;let k=n;n&&!(0,m.isFxChartColorClass)(n)&&(k="azc-color-"+n);const b=new f.SingleMetric(e);b.showBarColor(!1!==ko.unwrap(s.showBarColor));const y=r[i].name();o=ko.unwrap(s.title),g=ko.unwrap(s.defaultInfoBalloon),g&&(w=new x.ViewModel(e),w.type=g.type,d.fillObserableFields(g,w,["balloonVisible","content","disabled","link","position"]));const I=this._getFirstSeriesView(y);k=k||I&&I.cssClass()||this._generateCssClassNameFromSeriesName(y),o=o||I&&I.displayName()||y,v=v||function(e){let t=0;if(e){const s=e;s&&s.hasOwnProperty("areaHatchingPattern")&&(t=s.areaHatchingPattern())}return t}(I),a.indexOf(y)>=0&&b.prioritized(!0),b.caption(o),b.barCssClass(k),b.infoBalloon(w);const V=v;b.hatchingPattern(V),b.ariaLivePrefix(z.metricAriaLivePrefix),c=ko.unwrap(s.unit),u=this._calculateMetricsValue(i,t,s);const A=$.isNumeric(u);if(!c){const e=this._getOriginalUnit(i,s);l=e.unit,h=e.autoScale&&A?C.getAppropriateUnit(u,l):l,_=C.getConversionFactor(l,h),c=C.toString(h,e.displaySIUnit),_&&1!==_&&(u/=_)}return 7===ko.unwrap(s.aggregationType)&&A&&(p=parseFloat(u),u=p),b.unit(c),b.value(this._formatMetricsValue(u,s)),b}_xAxes(){return[this._nestedChartGraphViewModel.xAxis].concat(this._nestedChartGraphViewModel.secondaryXAxes())}_yAxes(){return[this._nestedChartGraphViewModel.yAxis].concat(this._nestedChartGraphViewModel.secondaryYAxes())}_getAxisByIndex(e,t){const s=a.SeriesUtilities.getAxisName(this._nestedChartGraphViewModel.series()[e],"x");switch(t){case"x":return M(s,this._xAxes());case"y":return M(s,this._yAxes())}return null}_getOriginalUnit(e,t){let s;let i;const a={unit:C.Unit.None,autoScale:!0,displaySIUnit:!1};switch(ko.unwrap(t.aggregationType)){case 0:i="x";break;case 6:i=null,a.unit=C.Unit.Count;break;default:i="y"}return i&&(s=this._getAxisByIndex(e,i),s&&(a.unit=ko.unwrap(s.unit),a.displaySIUnit=ko.unwrap(s.displaySIUnit),s.autoScaleUnit&&(a.autoScale=s.autoScaleUnit()))),a}_checkRuleMatch(e,t){const s=this._getSeriesSelections(),i=ko.unwrap(e.scopeSeriesName);switch(ko.unwrap(e.scope)){case 4:return s.length>1&&this._checkAnyDataPointsSelected()&&this._matchSeriesSelection(i);case 3:return 1===s.length&&s[0].chartItems().length>1&&this._matchSeriesSelection(i);case 2:return 1===s.length&&1===s[0].chartItems().length&&this._matchSeriesSelection(i);default:return!t}}_getSeriesNameFromSeriesId(e){const t=e.chartViewIndex(),s=e.seriesViewIndex();return this._getSeriesName(t,s)}_matchSeriesSelection(e){return!!S(e)||this._getSeriesSelections().some((t=>this._getSeriesNameFromSeriesId(t)===e))}_checkAnyDataPointsSelected(){return this._getSeriesSelections().some((e=>!S(e.chartItems())&&e.chartItems().length>0))}_getMetricsRuleActionSeriesIndex(e,t){const s=ko.unwrap(t.aggregationSeriesName)||ko.unwrap(e.scopeSeriesName);if(s)return this._getSeriesIndexFromSeriesName(s);{const e=this._getSeriesSelections();return!S(e)&&e.length>0?this._getSeriesIndexFromSeriesName(this._getSeriesNameFromSeriesId(e[0])):null}}_calculateMetricsValue(e,t,s){const i=ko.unwrap(s.aggregationType);let a;if(7===i)return ko.unwrap(s.customValue);if(0===ko.unwrap(s.aggregationScope)){a=0===ko.unwrap(t.scope)?this._getAllChartItems():this._getAllChartItems(!0)}else{const t=this._getSeriesSelections().filter((t=>this._getSeriesIndexFromSeriesName(this._getSeriesNameFromSeriesId(t))===e));a=t&&t.length>0?this._getChartItemsSelected(t[0]):this._getAllChartItemsForSeriesName(e)}if(a.length>0){const e=D[i];if(e)return e(a)}return z.noValueString}_formatMetricsValue(e,t){if(S(e))return z.noValueString;const s=ko.unwrap(t.outputFormat),i=ko.unwrap(t.formatOptions);return!ko.unwrap(t.unit)||s||i?"number"!=typeof e?isFinite(e)&&s?e.toString(s):e instanceof Date?i?n.DateTimeFormat.create(i).format(e):a.AxisWrapper._getGlobalizedDateValueForD3Defaults(e):e.toString():i?n.NumberFormat.create(i).format(e):this._defaultNumberFormatter.format(e):e.toString()}_getChartItemsSelected(e){const t=e.chartItems();return t&&0!==t.length?t:this._getAllChartItemsForSeriesName(this._getSeriesIndexFromSeriesName(this._getSeriesNameFromSeriesId(e)))}_getAllChartItemsForSeriesName(e){const t=this._nestedChartGraphViewModel.series()[e];return t?a.SeriesUtilities.getChartItemArrayBySeriesBase(t,!0):[]}_getAllChartItems(e=!1){const t=[];if(e)this._getSeriesSelections().forEach((e=>{Array.prototype.push.apply(t,this._getChartItemsSelected(e))}));else{s.range(this.options.series().length).forEach((e=>{Array.prototype.push.apply(t,this._getAllChartItemsForSeriesName(e))}))}return t}_getFirstSeriesView(e){let t=null;return this.options.views().some((s=>s.seriesView().some((s=>s.seriesName()===e&&(t=s,!0))))),t}_getSeriesIndexFromSeriesName(e){let t;if(this._savedChartGraphInstance&&(t=this._savedChartGraphInstance.getSeriesIndexBySeriesName(e)),S(t)){const t=this._nestedChartGraphViewModel.series();let s;const i=t.length;for(s=0;s<i;s++)if(t[s].name()===e)return s;return null}return t}_getSeriesName(e,t){let s;if(this._savedChartGraphInstance&&(s=this._savedChartGraphInstance.getSeriesName(e,t)),!S(s))return s;{const s=this._nestedChartGraphViewModel.views()[e];if(s){const e=s.seriesView()[t];if(e)return e.seriesName()}}return null}_generateCssClassNameFromSeriesName(e){const t=this._getSeriesIndexFromSeriesName(e);return S(t)?"":(0,m.getFxColorClass)(t)}_calculateAndRenderGraph(){const e=ko.unwrap(this.options.legendWidth),t=this._showLegend()?e||105:0,s=this._graphArea,i=this._width-t,a=this._height-(this._showMetrics()?65:0);
//!!important force-render. JQuery height, width function. or css width and height.
s.css({width:i,height:a}),this._graphAndLegendArea.css({height:a}),this._showLegend()&&(this._legendArea||(this._legendArea=this.element.find(".fxc-chart-legend-area-container")),this._legendArea.css({width:t}));const r=this._nestedChartGraphViewModel;r.width(i),r.height(a),this._savedChartGraphInstance||this.widgets.push(this._savedChartGraphInstance=new l.Widget(s,r))}_adjustLayoutBasedOnSize(e,t){this._isResizing=!0;const s=this.options;this._height=s.height()||t||this.element.height(),this._width=s.width()||e||this.element.width();let i=!0,a=!0,r=2,n=5,o=10;this._isUnderHeight(85)?(i=!1,r=null):this._isUnderHeight(175)?(r=0,i=!1,o=3):this._isUnderHeight(355)&&(o=5),this._isUnderWidth(175)?(n=2,a=!1):this._isUnderWidth(355)?(n=3,a=!1):n=Math.floor(this._width/95),S(r)||(s.metrics.size(r),this._sizeBasedXTicks(n),this._sizeBasedYTicks(o)),this._sizeAllowMetricsToShow(i),this._sizeAllowLegendToShow(a),this._calculateAndRenderGraph(),this._isResizing=!1;const c=s.sizeChanged();c.width===this._width&&c.height===this._height||s.sizeChanged({width:this._width,height:this._height})}_isUnderHeight(e){return this._height<=e}_isUnderWidth(e){return this._width<=e}}e.Widget=L}(f||(f={})),f}));